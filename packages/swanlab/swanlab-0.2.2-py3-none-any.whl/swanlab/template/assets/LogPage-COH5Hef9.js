import{_ as e,M as l,k as a,c as t,l as n,h as s,$ as r,o,a as u,g as i,f as c,b as v,j as d,F as g,q as p,e as m,d as f,a3 as h,B as x,n as y,t as b,U as w,Z as S,s as k,v as N}from"./index-DdDMmZ4g.js";import{_ as T}from"./SLLoading-CJAmM2Mj.js";import{F as j}from"./FuncBar-B2Fm3SgE.js";const q={class:"w-full h-full px-7 py-6 relative overflow-hidden"},L={key:0},_={key:1,class:"text-negative-default"},H={key:0,class:"w-full py-10 flex flex-col items-center text-lg font-semibold"},O=(e=>(k("data-v-7cfda2e4"),e=e(),N(),e))((()=>v("span",null,"No Logs",-1))),C={key:1,class:"flex h-full items-center justify-center"},F=e({__name:"LogPage",setup(e){const k=l().id,N=a(),F=t((()=>{var e;const l=null==(e=N.value)?void 0:e.map((e=>{const l=isNaN(e.substring(0,e.indexOf(" "))),a=l?null:e.substring(0,e.indexOf(" ")),t=l?e:e.substring(e.indexOf(" ")).trimStart(),n=""!==E.value&&t.toLowerCase().includes(E.value);return{isTarget:n,index:a,value:n?I(t,E.value):t}})),a=M(l);return P.value.map(((e,t)=>l.push({index:a+t+1,value:e,error:!0}))),l})),$=t((()=>{var e;let l=1;const a=null==(e=F.value)?void 0:e.length;return a&&(l=""===F.value[a-1].index?F.value[a-2].index:F.value[a-1].index),8*l.length+"px"})),M=e=>{const l=null==e?void 0:e.reduce(((e,l)=>l.index&&Number(l.index)>Number(e)?l.index:e),0);return Number(l)},B=t((()=>{var e;const l=null==(e=N.value)?void 0:e.map((e=>isNaN(e.substring(0,e.indexOf(" ")))?e:e.substring(e.indexOf(" ")).trimStart()));return(null==l?void 0:l.join("\n"))+P.value.join("\n")})),I=(e,l)=>{let a=e.split(new RegExp(`(${l})`,"i"));return a=a.filter((e=>""!==e)),a},P=a([]),E=a("");a(1);const R=e=>{E.value=e.toLowerCase()};t((()=>F.value.filter((e=>e.isTarget))));const U=a([0,0]),V=a(16),Z=t((()=>{var e;return(null==(e=F.value)?void 0:e.length)*V.value})),z=h((e=>{const l=e.target;A(l)}),100),A=e=>{const l=V.value,a=Math.ceil(e.clientHeight/l),t=Math.floor(e.scrollTop/l),n=t+a;e.scrollTop<=30*l?U.value[0]=0:U.value[0]=t-30,e.scrollTop+e.clientHeight>=e.scrollHeight-30*l?U.value[1]=F.value.length-1:U.value[1]=n+30},D=t((()=>U.value[0]*V.value));return n((async()=>{const{data:e}=await s.get(`/experiment/${k}/recent_log`).catch((e=>{3404===e.data.code&&(N.value=[])}));N.value=e.logs||[],e.error&&(P.value=e.error),r((()=>{A(document.querySelector(".log-container")),(()=>{const e=window.getComputedStyle(document.querySelector(".log-line"));V.value=parseFloat(e.getPropertyValue("line-height"))})(),document.querySelector(".log-container").scrollHeight>document.querySelector(".log-container").clientHeight&&(document.querySelector(".log-container").scrollTop=document.querySelector(".log-container").scrollHeight)}))})),(e,l)=>{const a=x;return o(),u("div",q,[N.value?(o(),i(j,{key:0,class:"pb-6",onInput:R,content:B.value,placeholder:e.$t("experiment.func-bar.placeholder.log"),filename:"print.log"},null,8,["content","placeholder"])):c("",!0),v("section",{class:"log-container",onScroll:l[0]||(l[0]=(...e)=>f(z)&&f(z)(...e))},[N.value?(o(),u("div",{key:0,class:"log-area",style:d({height:Z.value+"px"})},[v("div",{class:"log-board",style:d({top:D.value+"px"})},[(o(!0),u(g,null,p(F.value.slice(U.value[0],U.value[1]+1),((e,l)=>(o(),u("div",{class:"log-line",key:e.value+U.value[0]+l},[v("span",{class:y(["w-8 text-right flex-shrink-0 text-dimmest select-none",{"text-negative-default":e.error}]),style:d({width:$.value})},b(e.index),7),e.error?(o(),u("div",_,b(e.value),1)):(o(),u("div",L,[w(v("span",null,b(e.value),513),[[S,!e.isTarget]]),w(v("span",null,[(o(!0),u(g,null,p(e.value,(e=>(o(),u("span",{key:e,class:y({"bg-warning-dimmest":e.toLowerCase()===E.value})},b(e),3)))),128))],512),[[S,e.isTarget]])]))])))),128))],4),0===N.value.length&&0===P.value.length?(o(),u("div",H,[m(a,{class:"magnifier",icon:"search"}),O])):c("",!0)],4)):(o(),u("div",C,[m(T)]))],32)])}}},[["__scopeId","data-v-7cfda2e4"]]);export{F as default};
