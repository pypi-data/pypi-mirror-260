import{u as e,J as a,K as s,o as t,a as r,q as n,g as l,F as o,h as c,k as u,b as i,t as h,d as p,n as m,f as d,i as f}from"./index-DdDMmZ4g.js";import{C as g}from"./ChartsContainer-BvOYFy5L.js";import"./SLLoading-CJAmM2Mj.js";const v={__name:"ChartsPage",props:{groups:{type:Array,required:!0},charts:{type:Array,required:!0}},setup(u){const i=u,h=e(),p=new Map;a((()=>{p.forEach((e=>{clearInterval(e)}))})),s("$on",((e,a,s)=>{e.map((e=>{if(0===h.experiments.find((a=>a.name===e)).show)return s(e,null,null);m(e,a,s),0===h.experiments.find((a=>a.name===e)).status&&((e,a,s)=>{const t=setInterval((()=>{m(e,a,s)}),5e3);p.set(e+"-"+a,t)})(e,a,s)}))})),s("$off",(()=>{}));const m=(e,a,s)=>{const t=h.experiments.find((a=>a.name===e)).id,r=i.charts.find((e=>e.id===a)).name;c.get(`/experiment/${t}/tag/${r}`).then((a=>{s(e,a.data,null)})).catch((()=>{s(e,null,null)}))};return(e,a)=>(t(!0),r(o,null,n(u.groups,(e=>(t(),l(g,{key:e.name,label:e.name,charts:e.charts},null,8,["label","charts"])))),128))}},x={class:"flex flex-col min-h-full bg-higher"},y={class:"flex items-center gap-3"},C={class:"text-2xl items-center gap-1 font-semibold max-w-md truncate"},w={key:1,class:"font-semibold pt-5 text-center"},b={__name:"ChartsView",setup(n){const o=e();c.get("/project/charts").then((({data:e})=>{S.value=e.charts,j.value=e.namespaces,k.value=M(),b.value=!0}));const g=f("isSideBarShow"),b=u(!1),k=u([]),S=u([]),j=u([]),E=u(0),M=()=>{const e=[];return j.value.forEach((a=>{const s={name:a.name,charts:[]};a.charts.forEach((e=>{const a=S.value.find((a=>a.id===e));if(a.source.every((e=>!o.showMap[e])))return;a.source.filter((e=>!a.error[e])).every((e=>!o.showMap[e]))||s.charts.push(a)})),s.charts.length&&e.push(s)})),e};o.registerChangeShowCallback((()=>{E.value++,k.value=M()})),a((()=>{o.destoryChangeShowCallback()}));const $=[...o.colors];return $.getSeriesColor=(()=>{const e=o.colorMap;return a=>e[a]})(),s("colors",$),(e,a)=>(t(),r("div",x,[i("div",{class:m(["project-title transition-marging duration-300 mt-5 pl-6",{"ml-8":!p(g)}])},[i("div",y,[i("h1",C,h(p(o).name),1)])],2),k.value.length?(t(),l(v,{groups:k.value,charts:S.value,key:E.value},null,8,["groups","charts"])):b.value?(t(),r("p",w,"Empty Charts")):d("",!0)]))}};export{b as default};
