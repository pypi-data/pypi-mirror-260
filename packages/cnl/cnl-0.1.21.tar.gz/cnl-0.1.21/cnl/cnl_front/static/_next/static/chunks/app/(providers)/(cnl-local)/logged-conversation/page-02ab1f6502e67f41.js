(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[753],{7569:function(e,s,t){Promise.resolve().then(t.bind(t,2691))},2691:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return H}});var a=t(7514),l=t(8803),n=t(5893);let r=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",t),...l})});r.displayName="Card";let o=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("flex flex-col space-y-1.5 p-6",t),...l})});o.displayName="CardHeader";let c=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("h3",{ref:s,className:(0,n.cn)("text-2xl font-semibold leading-none tracking-tight",t),...l})});c.displayName="CardTitle";let i=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("p",{ref:s,className:(0,n.cn)("text-sm text-muted-foreground",t),...l})});i.displayName="CardDescription";let d=l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("p-6 pt-0",t),...l})});d.displayName="CardContent",l.forwardRef((e,s)=>{let{className:t,...l}=e;return(0,a.jsx)("div",{ref:s,className:(0,n.cn)("flex items-center p-6 pt-0",t),...l})}).displayName="CardFooter";var u=t(8904),m=t(5310),x=t(1319);/**
 * @license lucide-react v0.314.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,x.Z)("FileStack",[["path",{d:"M21 7h-3a2 2 0 0 1-2-2V2",key:"9rb54x"}],["path",{d:"M21 6v6.5c0 .8-.7 1.5-1.5 1.5h-7c-.8 0-1.5-.7-1.5-1.5v-9c0-.8.7-1.5 1.5-1.5H17Z",key:"1059l0"}],["path",{d:"M7 8v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H15",key:"16874u"}],["path",{d:"M3 12v8.8c0 .3.2.6.4.8.2.2.5.4.8.4H11",key:"k2ox98"}]]),h=(0,x.Z)("MessageCircleWarning",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);var g=t(4164),p=t(406),v=t(5228),j=t(5037),y=t(541),b=t(2471),N=t(4802),w=t(2514),C=t(5982),k=t(6838),Z=t(783);function _(e){let{sample:s}=e,[t,n]=(0,l.useState)(!1),{data:r,isLoading:o,error:c}=(0,N.a)({queryKey:["datasets"],queryFn:p.Q}),i=(0,w.D)({mutationFn:g.a}),{toast:d}=(0,b.pm)();return(0,C.NL)(),(0,a.jsxs)(y.Vq,{open:t,onOpenChange:n,children:[(0,a.jsx)(y.hg,{asChild:!0,children:(0,a.jsx)(j.z,{size:"sm",children:"View"})}),(0,a.jsxs)(y.cZ,{className:"overflow-y-scroll max-h-screen max-w-[800px]",children:[(0,a.jsx)(y.fK,{}),(0,a.jsx)(v.at,{initialMessages:(null==s?void 0:s.messages)||[],datasets:r||[],onClose:e=>{let{status:s,datasetId:t,content:l}=e;if("cancel"===s&&n(!1),"save"===s){let e=(0,Z.Z)();i.mutate({newSample:{dataset_id:t,sample_id:e,sample_name:"",last_activity:new Date().toISOString(),messages:l}},{onSuccess(e){n(!1),d({description:(0,a.jsxs)("span",{className:"flex",children:[(0,a.jsx)(k.Z,{className:"size-5 mr-2 text-green-500"}),"Saved!"]})})},onError(e){}})}}})]})]})}function M(e){let{historyItem:s}=e,[t,n]=(0,l.useState)([]);return(0,l.useEffect)(()=>{n((null==s?void 0:s.dataset_samples)||[])},[s]),(0,a.jsxs)("div",{className:(0,m.Z)((null==s?void 0:s.dataset_samples.length)===0&&"opacity-40"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(f,{className:"size-5"}),(0,a.jsx)("h4",{className:"font-medium  gap-2 text-lg",children:"Dataset samples"})]}),(0,a.jsx)("div",{className:"flex flex-col gap-2 mt-2",children:null==t?void 0:t.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("p",{className:"grow",children:e.sample_name}),(0,a.jsx)(_,{sample:e})]},s))})]})}function S(e){let{historyItem:s}=e;return(0,a.jsxs)("div",{className:(0,m.Z)(!s.feedback&&"opacity-40"),children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(h,{className:"size-5"}),(0,a.jsx)("h4",{className:"font-medium  gap-2 text-lg",children:"User feedback"})]}),(0,a.jsx)("div",{className:" mt-2",children:(0,a.jsx)(u.g,{readOnly:!0,value:s.feedback,onChange:()=>{}})})]})}function E(e){let{historyItem:s}=e;return s?(0,a.jsxs)(r,{className:"border-none shadow-none h-full",children:[(0,a.jsx)(o,{children:(0,a.jsx)(c,{children:"Message meta"})}),(0,a.jsx)(d,{children:(0,a.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,a.jsx)(M,{historyItem:s}),(0,a.jsx)(S,{historyItem:s})]})})]}):(0,a.jsx)(r,{className:"border-none shadow-none h-full",children:(0,a.jsxs)(o,{children:[(0,a.jsx)(c,{children:"Message meta"}),(0,a.jsx)(i,{children:"No message selected. Click on a chat message on the left to see more details."})]})})}var z=t(1118),F=t(40),B=t(9546);let R=async e=>{let{queryKey:s}=e,[t,{conversationId:a}]=s,{data:l}=await B.Z.get("".concat("http://localhost:5009","/logged_conversation"),{params:{conversation_id:a}});return l};function T(e){let{conversationId:s}=e,{data:t,isLoading:n,error:r}=(0,N.a)({queryKey:["logged-conversation",{conversationId:s}],queryFn:R}),[o,c]=(0,l.useState)(null);return(0,a.jsx)("div",{className:"h-full flex justify-center gap-8",children:n?(0,a.jsx)("div",{className:"flex flex-col justify-center",children:(0,a.jsx)(F.Z,{className:"size-8 animate-spin"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"h-full flex flex-col w-[400px] border rounded-lg",children:(0,a.jsx)(z.Z,{history:(null==t?void 0:t.conversation_history)||[],allowMessageClick:!0,onMessageClick:e=>{let{message_id:s}=e;return c((null==t?void 0:t.conversation_history.find(e=>e.message_id===s))||null)}})}),(0,a.jsx)("div",{className:"w-[400px] border rounded-lg",children:(0,a.jsx)(E,{historyItem:o})})]})})}var I=t(2600);function H(){let e=(0,I.useSearchParams)().get("conversationId"),[s,t]=(0,l.useState)("auto"),n=(0,l.useRef)(null);return(0,l.useEffect)(()=>{let e=()=>{if(n.current){let e=n.current.getBoundingClientRect().top,s=window.innerHeight;t("".concat(s-e,"px"))}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,a.jsx)("div",{ref:n,className:"container py-4",style:{height:s},children:(0,a.jsx)(T,{conversationId:e||""})})}},406:function(e,s,t){"use strict";t.d(s,{Q:function(){return l}});var a=t(9546);let l=async e=>{let{queryKey:s}=e,{data:t}=await a.Z.get("".concat("http://localhost:5009","/datasets"));return t.sort((e,s)=>s.last_activity.localeCompare(e.last_activity)),t}},1118:function(e,s,t){"use strict";t.d(s,{Z:function(){return M}});var a=t(7514),l=t(4358),n=t(5310),r=t(8803),o=t(9805),c=t(4524),i=t(9680),d=t(6244),u=t.n(d);let m=(0,r.createContext)({});var x=t(48),f=t(3146),h=t.n(f);function g(){let e;let s=(0,r.useContext)(m),t=(0,n.Z)("rounded-2xl px-7 py-3 shadow mx-1 w-min",u().className),l=(0,n.Z)("bg-white rounded-bl-none mr-2");return e=(0,n.Z)(t,l),(0,a.jsx)("div",{className:(0,n.Z)(e),style:{backgroundColor:s.botMessageBgColor,color:s.botMessageTextColor},children:(0,a.jsx)("div",{className:h()["dot-flashing"]})})}function p(e){let{content:s,allowFeedback:t,onFeedback:l}=e,o=(0,r.useContext)(m),c=(0,n.Z)("rounded-2xl px-3 py-2 shadow  mx-1 max-w-max whitespace-pre-wrap",u().className),i=(0,n.Z)("rounded-bl-none mr-2"),d=(0,n.Z)(c,i),[f,h]=(0,r.useState)(!1);return(0,a.jsx)("div",{className:"flex w-full",children:(0,a.jsxs)("div",{className:"group flex w-full",children:[(0,a.jsx)("div",{className:(0,n.Z)(d),style:{backgroundColor:o.botMessageBgColor,color:o.botMessageTextColor},children:s}),t&&(0,a.jsx)("div",{className:"self-center opacity-0 transition-opacity group-hover:opacity-100",children:(0,a.jsx)("button",{className:"rounded-sm p-1 hover:bg-gray-200",onClick:()=>{l()},children:(0,a.jsx)(x.Z,{className:"size-4"})})})]})})}function v(e){let{content:s}=e,t=(0,r.useContext)(m),l=(0,n.Z)("rounded-2xl px-3 py-2 shadow mx-1 max-w-max whitespace-pre-wrap",u().className),o=(0,n.Z)("rounded-br-none ml-2"),c=(0,n.Z)(l,o);return(0,a.jsx)("div",{className:"flex w-full justify-end",children:(0,a.jsx)("div",{className:(0,n.Z)(c),style:{backgroundColor:t.userMessageBgColor,color:t.userMessageTextColor},children:s})})}var j=t(4456),y=t.n(j);function b(e){let{children:s,type:t}=e;return"first"===t?(0,a.jsx)("div",{className:"mt-2",children:s}):"middle"===t?(0,a.jsx)("div",{className:"mt-1",children:s}):void 0}function N(e){let{children:s,show:t=!0}=e;return(0,a.jsx)(i.u,{appear:!0,show:t,enter:"transition ease-in duration-75",enterFrom:"opacity-0 translate-y-2",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-75",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-2",children:s})}function w(e){let{blocks:s,paddingBottom:t=0,showTypingAnimation:l=!1,allowMessageClick:r=!1,onMessageClick:o=()=>{},allowFeedback:c=!1,onFeedback:i=()=>{}}=e;return(0,a.jsxs)("div",{className:(0,n.Z)("h-full max-h-full gap-2 overflow-auto px-4",y()["no-scrollbar"]),style:{paddingBottom:"".concat(t+5,"px")},children:[s.map((e,t)=>{let l=(0,a.jsx)("div",{onClick:()=>{o({message_id:e.message_id})},className:(0,n.Z)(r&&"hover:cursor-pointer"),children:"bot"===e.from_?(0,a.jsx)(p,{content:e.content,onFeedback:()=>i(e.message_id),allowFeedback:c},e.message_id):"user"===e.from_?(0,a.jsx)(v,{content:e.content},e.message_id):void 0});return l=t>0&&s[t-1].from_===e.from_?(0,a.jsx)(b,{type:"middle",children:l}):(0,a.jsx)(b,{type:"first",children:l}),t===s.length-1&&(l=(0,a.jsx)(N,{children:l})),l=(0,a.jsx)("div",{children:l},e.message_id)}),(0,a.jsx)(N,{show:l,children:(0,a.jsx)(g,{})})]})}var C=t(7525),k=t(8974);function Z(e){let{className:s,...t}=e;return(0,a.jsx)("button",{className:(0,n.Z)("rounded-md border bg-gray-100 text-gray-600 hover:bg-gray-200 px-3 py-2 text-sm font-semibold",s),...t})}function _(e){let{onClose:s}=e,[t,l]=(0,r.useState)("");return(0,a.jsx)("div",{className:"absolute bottom-0 end-0 start-0 top-0 z-10 flex flex-col justify-center overflow-y-auto bg-gray-50 bg-opacity-10 backdrop-blur-sm",onClick:()=>s({status:"cancel",content:""}),children:(0,a.jsxs)("div",{className:"shadow my-2 w-11/12 max-w-4xl shrink -translate-y-12 rounded-lg bg-white p-5",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("div",{className:"px-0.5",children:[(0,a.jsx)("button",{onClick:()=>s({status:"cancel",content:""}),className:"float-right -m-1 rounded-md p-2 text-xl font-semibold hover:bg-slate-100",children:(0,a.jsx)(k.Z,{className:"h-5 w-5"})}),(0,a.jsx)("h2",{className:"text-xl font-medium text-gray-900",children:"Feedback"})]}),(0,a.jsxs)("div",{className:"no-scrollbar  overflow-scroll px-0.5",children:[(0,a.jsx)("textarea",{placeholder:"Share additional feedback",className:"mt-3.5 w-full rounded-md focus:border-gray-700 focus:outline-none focus:ring-gray-200",value:t,onChange:e=>l(e.target.value)}),(0,a.jsx)("div",{className:"mt-1.5",children:(0,a.jsx)(Z,{onClick:()=>s({status:"success",content:t}),children:"Submit"})})]})]})})}function M(e){let{history:s,showTypingAnimation:t=!1,allowMessageSend:i=!1,onMessageSend:d=()=>{},allowMessageClick:u=!1,onMessageClick:x=()=>{},allowFeedback:f=!1,theme:h=C.u}=e,[g,p]=(0,r.useState)([]),[v,j]=(0,r.useState)(i?100:0),[y,b]=(0,r.useState)(""),[N,k]=(0,r.useState)(0);(0,r.useEffect)(()=>{let e=document.getElementById("cnl-chat-ui").offsetHeight;k(e),p(s),console.log("Chat UI height: ".concat(e,"px"))},[]),(0,r.useEffect)(()=>{p(s)},[s]);let Z=()=>{d(y),b("")};(0,r.useEffect)(()=>{document.documentElement.style.setProperty("--cnl-typing-animation-dots-color",h.botMessageTextColor),document.documentElement.style.setProperty("--cnl-bg-color",h.bgColor)},[h]);let[M,S]=(0,r.useState)(!1),[E,z]=(0,r.useState)("");return(0,a.jsx)(m.Provider,{value:h,children:(0,a.jsxs)("div",{id:"cnl-chat-ui",className:(0,n.Z)("relative mx-auto h-full w-full max-w-screen-md flex-col items-center "),style:{backgroundColor:h.bgColor,...0!==N?{maxHeight:"".concat(N,"px")}:{}},children:[(0,a.jsx)(w,{blocks:g,paddingBottom:v,showTypingAnimation:t,onMessageClick:x,allowMessageClick:u,allowFeedback:f,onFeedback:e=>{z(e),S(!0)}}),i&&(0,a.jsxs)("div",{className:(0,n.Z)("absolute bottom-0 flex w-full  rounded-3xl bg-gradient-to-t from-[var(--cnl-bg-color)] from-60% pb-3 pl-3 pt-3 "),children:[(0,a.jsx)(c.Z,{maxRows:2,className:"flex-grow resize-none  rounded-3xl p-3 shadow focus:border-none focus:outline-none  focus:ring-0",onHeightChange:e=>{j(e+16)},onChange:e=>b(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(Z(),e.preventDefault())},value:y}),(0,a.jsx)("button",{className:"my-1 ml-2 mr-3 max-h-full",onClick:()=>Z(),children:(0,a.jsx)(l.Z,{className:"size-7 opacity-80"})})]}),M&&o.createPortal((0,a.jsx)(_,{onClose:()=>S(!M)}),document.getElementById("cnl-chat-ui"))]})})}},7525:function(e,s,t){"use strict";t.d(s,{u:function(){return a}});let a={accentColor:"#111827",bgColor:"#f9fafb",botMessageBgColor:"#ffffff",botMessageTextColor:"#4b5563",userMessageBgColor:"#dbeafe",userMessageTextColor:"#1e40af",size:"lg",rounded:"sm"}},4456:function(e){e.exports={"no-scrollbar":"noScrollBar_no-scrollbar__genmS"}},3146:function(e){e.exports={"dot-flashing":"typingAnimationBlock_dot-flashing__ZRQVw"}}},function(e){e.O(0,[412,796,38,857,802,554,401,984,459,470,861,744],function(){return e(e.s=7569)}),_N_E=e.O()}]);