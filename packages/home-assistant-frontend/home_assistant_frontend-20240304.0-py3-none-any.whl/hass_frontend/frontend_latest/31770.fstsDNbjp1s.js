export const id=31770;export const ids=[31770];export const modules={72113:(t,e,a)=>{a.a(t,(async(t,s)=>{try{a.d(e,{o:()=>p});var i=a(28945),n=a(30164),o=a(18771),d=a(33246),r=a(56601),c=a(77396),h=a(60441),l=t([c,h]);function u(t,e){let a=new Date(e);return t>2&&0===a.getHours()&&(a=(0,i.A)(a,1)),a.setMinutes(0,0,0),t>35&&a.setDate(1),t>2&&a.setHours(0),a.getTime()}function p(t,e,a,s,i,l,p){const _=(0,n.A)(e,t),k=void 0!==l&&void 0!==p;if(k&&_<=35){const a=(0,o.A)(e,t),s=(0,o.A)(p,l);s>a?e=(0,d.A)(e,s-a):a>s&&(p=(0,d.A)(p,a-s))}const m={parsing:!1,animation:!1,interaction:{mode:"x"},scales:{x:{type:"time",suggestedMin:t.getTime(),max:u(_,e),adapters:{date:{locale:a,config:s}},ticks:{maxRotation:0,sampleSize:5,autoSkipPadding:20,font:t=>t.tick&&t.tick.major?{weight:"bold"}:{}},time:{tooltipFormat:_>35?"monthyear":_>7?"date":_>2?"weekday":_>0?"datetime":"hour",minUnit:_>35?"month":_>2?"day":"hour"}},y:{stacked:!0,type:"linear",title:{display:!0,text:i},ticks:{beginAtZero:!0,callback:t=>(0,r.ZV)(Math.abs(t),a)}}},plugins:{tooltip:{position:"nearest",filter:t=>"0"!==t.formattedValue,itemSort:function(t,e){return e.datasetIndex-t.datasetIndex},callbacks:{title:t=>{if(_>0)return t[0].label;const e=new Date(t[0].parsed.x);return`${k?`${(0,c.sl)(e,a,s)}: `:""}${(0,h.fU)(e,a,s)} â€“ ${(0,h.fU)((0,d.A)(e,1),a,s)}`},label:t=>`${t.dataset.label}: ${(0,r.ZV)(t.parsed.y,a)} ${i}`}},filler:{propagate:!1},legend:{display:!1,labels:{usePointStyle:!0}}},elements:{bar:{borderWidth:1.5,borderRadius:4},point:{hitRadius:50}},locale:(0,r.Yf)(a)};return k&&(m.scales.xAxisCompare={...m.scales.x,suggestedMin:l.getTime(),max:u(_,p),display:!1}),m}[c,h]=l.then?(await l)():l,s()}catch(_){s(_)}}))},31770:(t,e,a)=>{a.a(t,(async(t,s)=>{try{a.r(e),a.d(e,{HuiEnergyDevicesDetailGraphCard:()=>y});var i=a(62659),n=a(65674),o=a(4185),d=a(40924),r=a(18791),c=a(69760),h=a(45081),l=a(76502),u=(a(54373),a(41525)),p=a(74959),_=a(94027),k=a(15821),m=a(72113),f=t([u,m]);[u,m]=f.then?(await f)():f;const v="kWh";let y=(0,i.A)([(0,r.EM)("hui-energy-devices-detail-graph-card")],(function(t,e){return{F:class extends e{constructor(...e){super(...e),t(this)}},d:[{kind:"field",decorators:[(0,r.MZ)({attribute:!1})],key:"hass",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_config",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_chartData",value:()=>({datasets:[]})},{kind:"field",decorators:[(0,r.wk)()],key:"_chartDatasetExtra",value:()=>[]},{kind:"field",decorators:[(0,r.wk)()],key:"_data",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_start",value:()=>(0,n.A)()},{kind:"field",decorators:[(0,r.wk)()],key:"_end",value:()=>(0,o.A)()},{kind:"field",decorators:[(0,r.wk)()],key:"_compareStart",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_compareEnd",value:void 0},{kind:"field",decorators:[(0,r.wk)()],key:"_hiddenStats",value:()=>new Set},{kind:"field",key:"hassSubscribeRequiredHostProps",value:()=>["_config"]},{kind:"method",key:"hassSubscribe",value:function(){var t;return[(0,u.tb)(this.hass,{key:null===(t=this._config)||void 0===t?void 0:t.collection_key}).subscribe((t=>{this._data=t,this._processStatistics()}))]}},{kind:"method",key:"getCardSize",value:function(){return 3}},{kind:"method",key:"setConfig",value:function(t){this._config=t}},{kind:"method",key:"shouldUpdate",value:function(t){return(0,k.xP)(this,t)||t.size>1||!t.has("hass")}},{kind:"method",key:"willUpdate",value:function(t){(t.has("_hiddenStats")||t.has("_config"))&&this._data&&this._processStatistics()}},{kind:"method",key:"render",value:function(){return this.hass&&this._config?d.qy` <ha-card> ${this._config.title?d.qy`<h1 class="card-header">${this._config.title}</h1>`:""} <div class="content ${(0,c.H)({"has-header":!!this._config.title})}"> <ha-chart-base externalHidden .hass="${this.hass}" .data="${this._chartData}" .extraData="${this._chartDatasetExtra}" .options="${this._createOptions(this._start,this._end,this.hass.locale,this.hass.config,v,this._compareStart,this._compareEnd)}" chart-type="bar" @dataset-hidden="${this._datasetHidden}" @dataset-unhidden="${this._datasetUnhidden}"></ha-chart-base> </div> </ha-card> `:d.s6}},{kind:"method",key:"_datasetHidden",value:function(t){t.stopPropagation(),this._hiddenStats.add(this._data.prefs.device_consumption[t.detail.index].stat_consumption),this.requestUpdate("_hiddenStats")}},{kind:"method",key:"_datasetUnhidden",value:function(t){t.stopPropagation(),this._hiddenStats.delete(this._data.prefs.device_consumption[t.detail.index].stat_consumption),this.requestUpdate("_hiddenStats")}},{kind:"field",key:"_createOptions",value:()=>(0,h.A)(((t,e,a,s,i,n,o)=>{const d=(0,m.o)(t,e,a,s,i,n,o);return{...d,interaction:{mode:"nearest"},plugins:{...d.plugins,legend:{display:!0,labels:{usePointStyle:!0}}}}}))},{kind:"method",key:"_processStatistics",value:function(){const t=this._data,e=t.stats,a=t.statsCompare,s={};t.prefs.device_consumption.forEach((t=>{const a=t.stat_consumption in e&&(0,p.$j)(e[t.stat_consumption])||0;s[t.stat_consumption]=a}));const i=t.prefs.device_consumption.map((t=>t.stat_consumption));i.sort(((t,e)=>s[e]-s[t]));const n=[],d=[],{data:r,dataExtras:c}=this._processDataSet(e,t.statsMetadata,t.prefs.device_consumption,i);if(n.push(...r),d.push(...c),a){n.push({order:0,data:[]}),d.push({show_legend:!1}),n.push({order:999,data:[],xAxisID:"xAxisCompare"}),d.push({show_legend:!1});const{data:e,dataExtras:s}=this._processDataSet(a,t.statsMetadata,t.prefs.device_consumption,i,!0);n.push(...e),d.push(...s)}this._start=t.start,this._end=t.end||(0,o.A)(),this._compareStart=t.startCompare,this._compareEnd=t.endCompare,this._chartData={datasets:n},this._chartDatasetExtra=d}},{kind:"method",key:"_processDataSet",value:function(t,e,a,s,i=!1){const n=[],o=[];return a.forEach(((a,d)=>{var r;const c=(0,l.Vy)(d);let h=null;const u=[];if(a.stat_consumption in t){const e=t[a.stat_consumption];let s;for(const t of e){if(null===t.change||void 0===t.change)continue;if(h===t.start)continue;const e=new Date(t.start);u.push({x:e.getTime(),y:t.change}),h=t.start,s=t.end}1===u.length&&u.push({x:s,y:0})}const _=s.indexOf(a.stat_consumption),k=!!(null!==(r=this._config)&&void 0!==r&&r.max_devices&&_>=this._config.max_devices);n.push({label:(0,p.$O)(this.hass,a.stat_consumption,e[a.stat_consumption]),hidden:this._hiddenStats.has(a.stat_consumption)||k,borderColor:i?c+"7F":c,backgroundColor:i?c+"32":c+"7F",data:u,order:1+_,stack:"devices",pointStyle:!i&&"circle",xAxisID:i?"xAxisCompare":void 0}),o.push({show_legend:!i&&!k})})),{data:n,dataExtras:o}}},{kind:"get",static:!0,key:"styles",value:function(){return d.AH`.card-header{padding-bottom:0}.content{padding:16px}.has-header{padding-top:0}`}}]}}),(0,_.E)(d.WF));s()}catch(t){s(t)}}))}};
//# sourceMappingURL=31770.fstsDNbjp1s.js.map