"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[345],{37007:function(e,n,a){var i=a(99277),l=a(82548),s=a(32048),t=a.n(s),r=a(4519),o=a(2556);n.Z=function(e){var n,a=e.values,s=void 0===a?[]:a;return 0===s.length?null:(n=s[0]&&("string"===typeof s[0]||r.isValidElement(s[0]))?s.map((function(e){return{label:e,color:"blue"}})):s,(0,o.jsx)(i.Z,{direction:"row",children:t().map(n,(function(e,a){return(0,o.jsx)(l.Z,{style:t().last(n)===e?void 0:{margin:0,marginRight:-1},color:e.color,children:e.label},a)}))}))}},14001:function(e,n,a){var i=a(1413),l=a(29439),s=a(87760),t=a(4519),r=a(2556),o=function(e,n){var a=e.image,t=e.style,o=void 0===t?{}:t,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",d=(0,s.X6)(),c=(0,l.Z)(d,2)[1].getImageIcon;return(0,r.jsx)("img",{src:c(a),style:(0,i.Z)({width:"1em",height:"1em"},o),alt:u})};n.Z=t.memo(o)},3173:function(e,n,a){a.r(n);var i={argumentDefinitions:[],kind:"Fragment",metadata:null,name:"SessionInfoCellFragment",selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null}],type:"ComputeSession",abstractKey:null,hash:"93f8cd0d4b47d24ea281955be0ad792b"};n.default=i},72428:function(e,n,a){a.r(n);var i=function(){var e={defaultValue:null,kind:"LocalArgument",name:"ak"},n={defaultValue:null,kind:"LocalArgument",name:"group_id"},a={defaultValue:null,kind:"LocalArgument",name:"limit"},i={defaultValue:null,kind:"LocalArgument",name:"offset"},l={defaultValue:null,kind:"LocalArgument",name:"skipClusterSize"},s={defaultValue:null,kind:"LocalArgument",name:"status"},t=[{kind:"Variable",name:"access_key",variableName:"ak"},{kind:"Variable",name:"group_id",variableName:"group_id"},{kind:"Variable",name:"limit",variableName:"limit"},{kind:"Variable",name:"offset",variableName:"offset"},{kind:"Variable",name:"status",variableName:"status"}],r={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},o={alias:null,args:null,kind:"ScalarField",name:"type",storageKey:null},u={alias:null,args:null,kind:"ScalarField",name:"session_id",storageKey:null},d={alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},c={alias:null,args:null,kind:"ScalarField",name:"image",storageKey:null},m={alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},g={alias:null,args:null,kind:"ScalarField",name:"created_at",storageKey:null},f={alias:null,args:null,kind:"ScalarField",name:"terminated_at",storageKey:null},p={alias:null,args:null,kind:"ScalarField",name:"status",storageKey:null},y={alias:null,args:null,kind:"ScalarField",name:"status_info",storageKey:null},x={alias:null,args:null,kind:"ScalarField",name:"service_ports",storageKey:null},h={alias:null,args:null,kind:"ScalarField",name:"mounts",storageKey:null},k={alias:null,args:null,kind:"ScalarField",name:"occupied_slots",storageKey:null},S={alias:null,args:null,kind:"ScalarField",name:"resource_opts",storageKey:null},v={alias:null,args:null,kind:"ScalarField",name:"access_key",storageKey:null},j={alias:null,args:null,kind:"ScalarField",name:"starts_at",storageKey:null},_={alias:null,args:null,kind:"ScalarField",name:"scaling_group",storageKey:null},Z={alias:null,args:null,kind:"ScalarField",name:"agents",storageKey:null},b={alias:null,args:null,kind:"ScalarField",name:"cluster_size",storageKey:null};return{fragment:{argumentDefinitions:[e,n,a,i,l,s],kind:"Fragment",metadata:null,name:"SessionListQuery",selections:[{alias:null,args:t,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,u,d,c,m,g,f,p,y,x,h,k,S,v,j,_,Z,b,{args:null,kind:"FragmentSpread",name:"SessionInfoCellFragment"}],storageKey:null}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[a,i,e,n,s,l],kind:"Operation",name:"SessionListQuery",selections:[{alias:null,args:t,concreteType:"ComputeSessionList",kind:"LinkedField",name:"compute_session_list",plural:!1,selections:[{alias:null,args:null,concreteType:"ComputeSession",kind:"LinkedField",name:"items",plural:!0,selections:[r,o,u,d,c,m,g,f,p,y,x,h,k,S,v,j,_,Z,b,{alias:null,args:null,kind:"ScalarField",name:"user_email",storageKey:null}],storageKey:null}],storageKey:null}]},params:{cacheID:"83e3fabcd47538a643850d50617579a5",id:null,metadata:{},name:"SessionListQuery",operationKind:"query",text:"query SessionListQuery(\n  $limit: Int!\n  $offset: Int!\n  $ak: String\n  $group_id: String\n  $status: String\n  $skipClusterSize: Boolean!\n) {\n  compute_session_list(limit: $limit, offset: $offset, access_key: $ak, group_id: $group_id, status: $status) {\n    items {\n      id\n      type\n      session_id\n      name\n      image\n      architecture\n      created_at\n      terminated_at\n      status\n      status_info\n      service_ports\n      mounts\n      occupied_slots\n      resource_opts\n      access_key\n      starts_at\n      scaling_group\n      agents\n      cluster_size @skipOnClient(if: $skipClusterSize)\n      ...SessionInfoCellFragment\n    }\n  }\n}\n\nfragment SessionInfoCellFragment on ComputeSession {\n  id\n  session_id\n  name\n  status\n  user_email\n  image\n}\n"}}}();i.hash="b0859dbf2946abcb56ec83ac42d76781",n.default=i},76345:function(e,n,a){a.r(n),a.d(n,{default:function(){return U}});var i,l,s=a(93433),t=a(29439),r=a(99277),o=a(1413),u=a(44925),d=a(87760),c=a(37007),m=a(14001),g=a(96732),f=a(50164),p=a(61749),y=a(44036),x=a(57054),h=a(38818),k=a(70389),S=a(92171),v=a(4519),j=a(81748),_=a(16980),Z=a(2556),b=function(e){var n=e.sessionFrgmt,l=e.sessionNameList,s=e.onRename,o=(0,d.Dj)(),u=y.Z.useToken().token,c=(0,_.useFragment)(void 0!==i?i:i=a(3173),n),m=(0,f.Y)({mutationFn:function(e){var n=o.APIMajorVersion<5?c.name:c.session_id;return o.rename(n,e)}}),g=x.Z.useForm(),b=(0,t.Z)(g,1)[0],I=(0,j.$G)().t,F=(0,v.useState)(!1),N=(0,t.Z)(F,2),E=N[0],R=N[1],L=(0,v.useState)(c.name),T=(0,t.Z)(L,2),K=T[0],C=T[1],A=function(){return["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(c.status||void 0)&&!function(){return["RESTARTING","PREPARING","PULLING"].includes(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"")}(c.status||void 0)&&o.email===c.user_email,D=m.isLoading||K!==c.name;return(0,Z.jsx)(x.Z,{form:b,children:E?(0,Z.jsx)(x.Z.Item,{style:{margin:0},name:"name",rules:[{required:!0},{max:64},{pattern:/^(?:[a-zA-Z0-9][-a-zA-Z0-9._]{2,}[a-zA-Z0-9])?$/,message:I("session.Validation.EnterValidSessionName")},function(){return{validator:function(e,n){return l.includes(String(n))?Promise.reject(new Error(I("session.Validation.SessionNameAlreadyExist"))):Promise.resolve()}}}],children:(0,Z.jsx)(h.Z,{autoFocus:!0,onPressEnter:function(){b.validateFields().then((function(e){var n=e.name;R(!1),C(n),m.mutate(n,{onSuccess:function(e){s&&s()},onError:function(e){C(c.name)}})})).catch((function(){}))},onKeyUp:function(e){"Escape"===e.key&&R(!1)}})}):(0,Z.jsxs)(r.Z,{style:{maxWidth:250},children:[(0,Z.jsx)(k.Z.Text,{ellipsis:{tooltip:{overlayInnerStyle:{width:"max-content"}}},style:{opacity:D?.5:1},children:K}),A&&(0,Z.jsx)(S.ZP,{loading:D,type:"text",icon:(0,Z.jsx)(p.Z,{}),style:{color:u.colorLink},onClick:function(){b.setFieldsValue({name:c.name}),R(!0)}})]})})},I=a(14644),F=a(10599),N=a(49248),E=a(82548),R=a(32048),L=a.n(R),T=["status","limit","currentPage","pageSize","projectId","filter","extraFetchKey"],K=function(e){var n,i=e.status,f=void 0===i?[]:i,p=(e.limit,e.currentPage),x=void 0===p?1:p,h=e.pageSize,S=void 0===h?50:h,R=e.projectId,K=e.filter,C=e.extraFetchKey,A=void 0===C?"":C,D=(0,u.Z)(e,T),P=(0,d.Dj)(),G=(0,d.Kr)("initial-fetch"),w=(0,t.Z)(G,2),V=w[0],$=w[1],U=(0,v.useDeferredValue)(V+A),z=(0,j.$G)().t,B=y.Z.useToken().token,O=(0,d.X6)(),M=(0,t.Z)(O,2)[1],q=M.getImageAliasName,H=M.getBaseVersion,Q=M.getBaseImage;!P.supports("avoid-hol-blocking")&&f.includes("SCHEDULED")&&(f=f.filter((function(e){return"SCHEDULED"!==e})));var X=(0,_.useLazyLoadQuery)(void 0!==l?l:l=a(72428),{limit:S,offset:(x-1)*S,status:null===(n=f)||void 0===n?void 0:n.join(","),group_id:R,skipClusterSize:!P.supports("multi-container")},{fetchKey:U,fetchPolicy:"network-only"}).compute_session_list,J={RESTARTING:"blue",PREPARING:"blue",PULLING:"blue",RUNNING:"green",PENDING:"green",SCHEDULED:"green",ERROR:"red"},W={"idle-timeout":"green","user-requested":"green",scheduled:"green","self-terminated":"green","no-available-instances":"red","failed-to-start":"red","creation-failed":"red"},Y={INTERACTIVE:"green",BATCH:"darkgreen",INFERENCE:"blue"};return(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)(N.Z,(0,o.Z)({scroll:{x:"max-content"},columns:[{title:z("session.SessionInfo"),render:function(e,n,a){return(0,Z.jsx)(b,{sessionFrgmt:n,sessionNameList:L().map(((null===X||void 0===X?void 0:X.items)||[]).filter(K)||[],"name"),onRename:function(){$(n.session_id+(new Date).toISOString())}},n.session_id)},fixed:"left"},{title:z("session.Status"),dataIndex:"status",render:function(e,n){return(0,Z.jsx)(Z.Fragment,{children:""!==n.status_info?(0,Z.jsx)(c.Z,{values:[{label:e,color:L().get(J,e)},{label:n.status_info,color:L().get(W,n.status_info)}]}):(0,Z.jsx)(E.Z,{color:L().get(J,e),children:e})})}},{title:z("general.Control")},{title:z("session.Configuration"),dataIndex:"mounts",render:function(e,n){return(0,Z.jsxs)(Z.Fragment,{children:[e.length>0?(0,Z.jsxs)(r.Z,{gap:"xxs",style:{width:200},children:[(0,Z.jsx)(I.Z,{}),(0,Z.jsx)(k.Z.Text,{ellipsis:{tooltip:{overlayInnerStyle:{width:"max-content"},title:L().map(e,(function(e){return(0,Z.jsx)("div",{children:e})}))}},children:e.join(", ")})]}):(0,Z.jsxs)(r.Z,{gap:"xxs",style:{color:B.colorTextDisabled},children:[(0,Z.jsx)(I.Z,{}),"No mount"]}),(0,Z.jsxs)(r.Z,{gap:"xxs",children:[(0,Z.jsx)(F.Z,{}),n.scaling_group]}),(0,Z.jsx)(r.Z,{gap:"xxs",children:n.occupied_slots&&L().map(JSON.parse(n.occupied_slots),(function(e,a){return(0,Z.jsx)(g.ZP,{type:a,value:L().toString(e),opts:{shmem:L().sum(L().map(JSON.parse(n.resource_opts),(function(e){return e.shmem})))}},a)}))})]})}},{title:z("session.Usage")},{title:z("session.Reservation"),dataIndex:"created_at",render:function(e,n){var a=new Date(e).toLocaleString(),i=P.utils.elapsedTime(e,n.terminated_at);return(0,Z.jsxs)(r.Z,{direction:"column",gap:"xs",children:[a,(0,Z.jsx)(c.Z,{values:[z("session.ElapsedTime"),i]})]})}},{title:z("session.EnvironmentInfo"),render:function(e){return(0,Z.jsx)(E.Z,{color:"gold",children:(0,Z.jsxs)(r.Z,{direction:"column",children:[(0,Z.jsxs)(r.Z,{gap:"xxs",children:[(0,Z.jsx)(m.Z,{image:e.image}),(0,Z.jsx)("div",{children:q(e.image)}),H(e.image)]}),(0,Z.jsxs)(r.Z,{gap:"xxs",children:[(0,Z.jsx)("div",{children:Q(e.image)}),e.architecture]})]})})}},{title:z("session.SessionType"),dataIndex:"type",render:function(e){return(0,Z.jsx)(E.Z,{color:L().get(Y,e),children:e})}}].concat((0,s.Z)(P.is_admin||P._config.hideAgents?[{title:z("session.Agent"),dataIndex:"agents",render:function(e){return L().map(e,(function(e){return e}))}}]:[])),dataSource:((null===X||void 0===X?void 0:X.items)||[]).filter(K)},D))})},C=a(79781),A=a(33368),D=a(52176),P=a(15850),G=a(45110),w=a(12674),V=["RUNNING","RESTARTING","TERMINATING","PENDING","SCHEDULED","PREPARING","PULLING"],$={running:V,interactive:V,batch:V,inference:V,finished:["TERMINATED","CANCELLED"],others:["TERMINATING","ERROR"],default:V},U=function(e){var n=e.children,a=(0,j.$G)().t,i=(0,d.Dj)(),l=y.Z.useToken().token,o=(0,d.qh)(),u=(0,w.s0)(),c=(0,v.useState)("running"),m=(0,t.Z)(c,2),g=m[0],f=m[1],p=(0,v.useState)("next"),x=(0,t.Z)(p,2),h=x[0],_=x[1];return(0,Z.jsxs)(Z.Fragment,{children:[(0,Z.jsx)(D.Z,{message:(0,Z.jsxs)(r.Z,{gap:"md",children:[(0,Z.jsxs)(k.Z.Text,{children:["This is"," ","current"===h?"current version":"NEXT generation"," ","of session list. you can switch anytime."]}),(0,Z.jsx)(P.Z,{options:[{label:"Current",value:"current"},{label:(0,Z.jsx)(k.Z.Text,{style:{color:"next"===h?l.colorPrimary:void 0},children:"Next"}),value:"next",icon:(0,Z.jsx)(C.Z,{twoToneColor:l.colorWarning})}],value:h,onChange:function(e){return _(e)}})]}),type:"warning",banner:!0,style:{marginTop:-14,marginLeft:-14,marginRight:-14}}),"next"===h?(0,Z.jsxs)(r.Z,{direction:"column",align:"stretch",style:{padding:l.padding,gap:l.margin},children:[n,(0,Z.jsxs)(r.Z,{direction:"column",align:"stretch",children:[(0,Z.jsx)(r.Z,{style:{flex:1},children:(0,Z.jsx)(G.Z,{activeKey:g,onChange:function(e){return f(e)},tabBarStyle:{marginBottom:0},style:{width:"100%",paddingLeft:l.paddingMD,paddingRight:l.paddingMD,borderTopLeftRadius:l.borderRadius,borderTopRightRadius:l.borderRadius},items:[{key:"running",label:a("session.Running")},{key:"interactive",label:a("session.Interactive")},{key:"batch",label:a("session.Batch")}].concat((0,s.Z)(i.supports("inference-workload")?[{key:"inference",label:a("session.Inference")}]:[]),[{key:"finished",label:a("session.Finished")},{key:"others",label:a("session.Others")}]),tabBarExtraContent:{right:(0,Z.jsx)(r.Z,{direction:"row",gap:"sm",children:(0,Z.jsx)(S.ZP,{type:"primary",icon:(0,Z.jsx)(A.Z,{}),onClick:function(){u("/session/start")},children:"START"})})}})}),(0,Z.jsx)(v.Suspense,{fallback:(0,Z.jsx)("div",{children:"loading.."}),children:(0,Z.jsx)(K,{projectId:o.id,status:$[g]||$.default,filter:function(e){var n;return!["interactive","batch","inference"].includes(g)||(null===e||void 0===e||null===(n=e.type)||void 0===n?void 0:n.toLowerCase())===g},extraFetchKey:g})})]})]}):(0,Z.jsx)(Z.Fragment,{children:(0,Z.jsx)("backend-ai-session-view",{class:"page",name:"job",active:!0})})]})}}}]);
//# sourceMappingURL=345.2457c111.chunk.js.map