"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[525],{38540:function(e,n,t){t.r(n),t.d(n,{passwordPattern:function(){return h}});var r=t(29439),a=t(43255),o=t(87760),s=t(50164),i=t(61502),u=t(99277),l=t(69080),d=t(44036),c=t(57054),m=t(65113),f=t(70389),p=t(38818),w=t(92171),g=t(4519),v=t(81748),P=t(2556),h=/^(?=.*\d)(?=.*[a-zA-Z])(?=.*[_\W]).{8,}$/;n.default=function(){var e,n=(0,i.useWebComponentInfo)(),t=n.value,Z=n.dispatchEvent;try{e=JSON.parse(t||"")}catch(N){e={open:!1,currentPassword:"",username:"",api_endpoint:""}}var b=e,_=b.open,y=b.currentPassword,k=b.username,F=b.api_endpoint,j=d.Z.useToken().token,S=c.Z.useForm(),C=(0,r.Z)(S,1)[0],T=(0,v.$G)().t;(0,g.useEffect)((function(){_&&C.resetFields()}),[_,C]);var x=(0,o.M)({api_endpoint:F}),M=(0,s.Y)({mutationFn:function(e){return(0,a.Lc)({method:"POST",url:"/server/update-password-no-auth",body:e,client:x})}}),E=function(){C.validateFields().then((function(e){M.mutate({username:k,current_password:y,new_password:e.newPassword},{onSuccess:function(e,n,t){Z("ok",null)},onError:function(e,n,t){}})}))};return(0,P.jsx)(m.Z,{open:_,centered:!0,mask:!1,onCancel:function(){Z("cancel",null)},keyboard:!1,maskClosable:!1,footer:null,width:450,destroyOnClose:!0,forceRender:!0,children:(0,P.jsxs)(u.Z,{direction:"column",justify:"start",align:"stretch",gap:"md",style:{alignSelf:"stretch",paddingTop:j.paddingMD,paddingBottom:j.paddingMD},children:[(0,P.jsxs)(f.Z.Title,{level:3,style:{margin:0},children:[(0,P.jsx)(l.Z,{twoToneColor:j.colorWarning})," ",T("webui.menu.PleaseChangeYourPassword")]}),T("webui.menu.YouMushChangeYourPassword"),(0,P.jsxs)(c.Z,{form:C,layout:"vertical",initialValues:{currentPassword:y},disabled:M.isLoading,children:[(0,P.jsx)(c.Z.Item,{name:"newPassword",label:T("webui.menu.NewPassword"),rules:[{required:!0},{pattern:h,message:T("webui.menu.InvalidPasswordMessage").toString()},function(){return{validator:function(e,n){return y===n?Promise.reject(new Error(T("webui.menu.NewPasswordCannotBeSame").toString())):Promise.resolve()}}}],hasFeedback:!0,children:(0,P.jsx)(p.Z.Password,{})}),(0,P.jsx)(c.Z.Item,{name:"confirm",label:T("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],hasFeedback:!0,rules:[{required:!0},function(e){var n=e.getFieldValue;return{validator:function(e,t){return t&&n("newPassword")!==t?Promise.reject(new Error(T("environment.PasswordsDoNotMatch").toString())):Promise.resolve()}}}],children:(0,P.jsx)(p.Z.Password,{onPressEnter:E})})]}),(0,P.jsx)(w.ZP,{type:"primary",onClick:E,loading:M.isLoading,children:T("webui.menu.Update")})]})})}},36525:function(e,n,t){t.r(n);var r,a=t(1413),o=t(29439),s=t(44925),i=t(87760),u=t(1839),l=t(50164),d=t(77758),c=t(38540),m=t(14749),f=t(88724),p=t(63703),w=t(57054),g=t(88464),v=t(65113),P=t(38818),h=t(62708),Z=t(4519),b=t(81748),_=t(16980),y=t(2556),k=["onRequestClose"];n.default=function(e){var n=e.onRequestClose,F=(0,s.Z)(e,k),j=(0,b.$G)().t,S=w.Z.useForm(),C=(0,o.Z)(S,1)[0],T=g.ZP.useMessage(),x=(0,o.Z)(T,2),M=x[0],E=x[1],N=v.Z.useModal(),O=(0,o.Z)(N,2),L=O[0],I=O[1],V=(0,p.Z)(!1),A=(0,o.Z)(V,2),z=A[0],U=A[1].toggle,K=(0,i.Dj)(),q=(0,l.h)("isManagerSupportingTOTP",(function(){return K.isManagerSupportingTOTP()}),{suspense:!0}).data,D=K.supports("2FA")&&q,$=(0,u.jC)(),R=(0,o.Z)($,2),Y=R[0],Q=R[1],B=(0,i.Kr)("initial-fetch"),W=(0,o.Z)(B,2),G=W[0],H=W[1],J=(0,Z.useDeferredValue)(G),X=(0,_.useLazyLoadQuery)(void 0!==r?r:r=t(57555),{email:Y.email,isNotSupportTotp:!D},{fetchPolicy:"network-only",fetchKey:J}).user,ee=(0,l.Y)({mutationFn:function(){return K.remove_totp()}});return(0,y.jsxs)(y.Fragment,{children:[(0,y.jsxs)(d.Z,(0,a.Z)((0,a.Z)({},F),{},{okText:j("webui.menu.Update"),cancelText:j("webui.menu.Cancel"),onCancel:function(){n()},confirmLoading:Y.isPendingMutation,onOk:function(){C.validateFields().then((function(e){Q.updateFullName(e.full_name,{onSuccess:function(t){t!==Y.full_name&&M.open({type:"success",content:j("webui.menu.FullnameUpdated")}),e.newPassword&&e.newPasswordConfirm&&e.originalPassword?Q.updatePassword({new_password:e.newPassword,new_password2:e.newPasswordConfirm,old_password:e.originalPassword},{onSuccess:function(){M.open({type:"success",content:j("webui.menu.PasswordUpdated")}),n(!0)},onError:function(e){M.open({type:"error",content:e.message})}}):n(!0)},onError:function(e){M.open({type:"error",content:e.message})}})})).catch((function(){}))},centered:!0,destroyOnClose:!0,title:j("webui.menu.MyAccountInformation"),children:[(0,y.jsxs)(w.Z,{layout:"horizontal",labelCol:{span:8},form:C,initialValues:{full_name:Y.full_name,totp_activated:(null===X||void 0===X?void 0:X.totp_activated)||!1},preserve:!1,children:[(0,y.jsx)(w.Z.Item,{name:"full_name",label:j("webui.menu.FullName"),rules:[function(){return{validator:function(e,n){return n&&n.length<65?Promise.resolve():Promise.reject(new Error(j("webui.menu.FullNameInvalid")))}}}],children:(0,y.jsx)(P.Z,{})}),(0,y.jsx)(w.Z.Item,{name:"originalPassword",label:j("webui.menu.OriginalPassword"),rules:[function(e){var n=e.getFieldValue;return{validator:function(e,t){return t||!n("newPassword")&&!n("newPasswordConfirm")?Promise.resolve():Promise.reject(new Error(j("webui.menu.InputOriginalPassword")))}}}],dependencies:["newPassword","newPasswordConfirm"],children:(0,y.jsx)(P.Z.Password,{})}),(0,y.jsx)(w.Z.Item,{name:"newPassword",label:j("webui.menu.NewPassword"),rules:[{pattern:c.passwordPattern,message:j("webui.menu.InvalidPasswordMessage")}],children:(0,y.jsx)(P.Z.Password,{})}),(0,y.jsx)(w.Z.Item,{name:"newPasswordConfirm",label:j("webui.menu.NewPasswordAgain"),dependencies:["newPassword"],rules:[function(e){var n=e.getFieldValue;return{validator:function(e,t){return t&&n("newPassword")!==t?Promise.reject(new Error(j("webui.menu.NewPasswordMismatch"))):Promise.resolve()}}}],children:(0,y.jsx)(P.Z.Password,{})}),!!D&&(0,y.jsx)(w.Z.Item,{name:"totp_activated",label:j("webui.menu.TotpActivated"),valuePropName:"checked",children:(0,y.jsx)(h.Z,{onChange:function(e){e?U():null!==X&&void 0!==X&&X.totp_activated&&(C.setFieldValue("totp_activated",!0),L.confirm({title:j("totp.TurnOffTotp"),icon:(0,y.jsx)(f.Z,{}),content:j("totp.ConfirmTotpRemovalBody"),okText:j("button.Yes"),okType:"danger",cancelText:j("button.No"),onOk:function(){ee.mutate(void 0,{onSuccess:function(){g.ZP.success(j("totp.RemoveTotpSetupCompleted")),H(),C.setFieldValue("totp_activated",!1)},onError:function(e){g.ZP.error(e.message)}})},onCancel:function(){C.setFieldValue("totp_activated",!0)}}))}})})]}),!!D&&(0,y.jsx)(m.Z,{userFrgmt:X,open:z,onRequestClose:function(e){e?H():C.setFieldValue("totp_activated",!1),U()}})]})),E,I]})}},57555:function(e,n,t){t.r(n);var r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"email"},{defaultValue:null,kind:"LocalArgument",name:"isNotSupportTotp"}],n=[{kind:"Variable",name:"email",variableName:"email"}],t={alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},r={alias:null,args:null,kind:"ScalarField",name:"totp_activated",storageKey:null};return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"UserProfileSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,r,{args:null,kind:"FragmentSpread",name:"TOTPActivateModalFragment"}],storageKey:null}],type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"UserProfileSettingModalQuery",selections:[{alias:null,args:n,concreteType:"User",kind:"LinkedField",name:"user",plural:!1,selections:[t,r,{alias:null,args:null,kind:"ScalarField",name:"email",storageKey:null}],storageKey:null}]},params:{cacheID:"b0c9773ff4a3e759f0f9822463daa757",id:null,metadata:{},name:"UserProfileSettingModalQuery",operationKind:"query",text:"query UserProfileSettingModalQuery(\n  $email: String!\n  $isNotSupportTotp: Boolean!\n) {\n  user(email: $email) {\n    id\n    totp_activated @skipOnClient(if: $isNotSupportTotp)\n    ...TOTPActivateModalFragment\n  }\n}\n\nfragment TOTPActivateModalFragment on User {\n  email\n  totp_activated @skipOnClient(if: $isNotSupportTotp)\n}\n"}}}();r.hash="c87e74dfaa01d51a1697e67df81e101b",n.default=r},1839:function(e,n,t){t.d(n,{T6:function(){return c},jC:function(){return m}});var r=t(1413),a=t(29439),o=t(87760),s=t(43255),i=t(50164),u=t(32048),l=t.n(u),d=t(4519),c=function(){var e=(0,o.Kr)("first"),n=(0,a.Z)(e,2),t=n[0],r=n[1],s=(0,o.Dj)();return[(0,i.h)({queryKey:["useResourceSlots",t],queryFn:function(){return s.get_resource_slots()},staleTime:0}).data,{refresh:function(){return r()}}]},m=function(){var e=(0,o.Dj)(),n=(0,d.useState)({full_name:e.full_name,email:e.email}),t=(0,a.Z)(n,2),u=t[0],c=t[1];(0,d.useEffect)((function(){var n=function(n){if(e.supports("change-user-name")){var t=n.detail;c((function(e){return(0,r.Z)((0,r.Z)({},e),{},{full_name:t})}))}};return document.addEventListener("current-user-info-changed",n),function(){document.removeEventListener("current-user-info-changed",n)}}),[e]);var m=(0,i.Y)({mutationFn:function(n){return e.update_full_name(n.email,n.full_name)}}),f=(0,i.Y)({mutationFn:function(n){return e.update_password(n.old_password,n.new_password,n.new_password2)}});return[(0,r.Z)((0,r.Z)({},u),{},{username:function(){var n=l().trim(u.full_name).length>0?u.full_name:u.email;if(e._config.maskUserInfo){var t=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(n)?n.split("@")[0].length-2:n.length-2;n=(0,s.Cd)(n,"*",2,t)}return n}(),isPendingMutation:m.isLoading||f.isLoading}),{updateFullName:function(n,t){m.mutate({full_name:n,email:e.email},{onSuccess:function(){(null===t||void 0===t?void 0:t.onSuccess)&&t.onSuccess(n),document.dispatchEvent(new CustomEvent("current-user-info-changed",{detail:n})),c((function(e){return(0,r.Z)((0,r.Z)({},e),{},{full_name:n})}))},onError:function(e){(null===t||void 0===t?void 0:t.onError)&&t.onError(e)}})},updatePassword:function(e,n){f.mutate(e,{onSuccess:function(){(null===n||void 0===n?void 0:n.onSuccess)&&n.onSuccess(void 0)},onError:function(e){(null===n||void 0===n?void 0:n.onError)&&n.onError(e)}})}}]}},69080:function(e,n,t){t.d(n,{Z:function(){return u}});var r=t(87462),a=t(4519),o={icon:function(e,n){return{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M955.7 856l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z",fill:e}},{tag:"path",attrs:{d:"M172.2 828.1h679.6L512 239.9 172.2 828.1zM560 720a48.01 48.01 0 01-96 0 48.01 48.01 0 0196 0zm-16-304v184c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V416c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8z",fill:n}},{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8z",fill:e}}]}},name:"warning",theme:"twotone"},s=t(9491),i=function(e,n){return a.createElement(s.Z,(0,r.Z)({},e,{ref:n,icon:o}))};var u=a.forwardRef(i)}}]);
//# sourceMappingURL=525.b7c38cc1.chunk.js.map