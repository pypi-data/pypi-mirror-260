"use strict";(self.webpackChunkbackend_ai_webui_react=self.webpackChunkbackend_ai_webui_react||[]).push([[262],{37007:function(e,n,i){var r=i(99277),o=i(82548),l=i(32048),t=i.n(l),a=i(4519),u=i(2556);n.Z=function(e){var n,i=e.values,l=void 0===i?[]:i;return 0===l.length?null:(n=l[0]&&("string"===typeof l[0]||a.isValidElement(l[0]))?l.map((function(e){return{label:e,color:"blue"}})):l,(0,u.jsx)(r.Z,{direction:"row",children:t().map(n,(function(e,i){return(0,u.jsx)(o.Z,{style:t().last(n)===e?void 0:{margin:0,marginRight:-1},color:e.color,children:e.label},i)}))}))}},15008:function(e,n,i){i.d(n,{Z:function(){return w}});var r,o=i(84506),l=i(29439),t=i(87760),a=i(21232),u=i(37007),s=i(99277),c=i(14001),d=i(91278),m=i(57054),v=i(44036),p=i(19427),g=i(82548),f=i(83799),h=i(38818),y=i(32048),x=i.n(y),Z=i(4519),b=i(81748),_=i(16980),k=i(2556),j=function(e){return e?"".concat(e.registry,"/").concat(e.name,":").concat(e.tag,"@").concat(e.architecture):void 0};var w=function(e){var n=e.filter,y=e.showPrivate,w=m.Z.useFormInstance(),S=m.Z.useWatch("environments",{form:w,preserve:!0}),P=(0,t.Dj)(),F=(0,Z.useState)(""),N=(0,l.Z)(F,2),E=N[0],C=N[1],I=(0,Z.useState)(""),K=(0,l.Z)(I,2),M=K[0],V=K[1],R=(0,b.$G)().t,q=(0,t.X6)(),D=(0,l.Z)(q,2),T=D[0],A=D[1].getImageMeta,L=v.Z.useToken().token,U=(0,a.r)().isDarkMode,B=(0,Z.useRef)(null),Q=(0,Z.useRef)(null),z=(0,_.useLazyLoadQuery)(void 0!==r?r:r=i(71947),{installed:!0},{fetchPolicy:"store-and-network"}).images;(0,Z.useEffect)((function(){var e,n,i,r;if(x().isEmpty(null===S||void 0===S?void 0:S.manual)){var o,l=(null===(e=w.getFieldValue("environments"))||void 0===e?void 0:e.environment)||(null===(n=G[0])||void 0===n||null===(i=n.environmentGroups[0])||void 0===i?void 0:i.environmentName);if(x().find(G,(function(e){return x().find(e.environmentGroups,(function(e){return e.environmentName===l&&(o=e,!0)}))})),!x().find(null===(r=o)||void 0===r?void 0:r.images,(function(e){var n;return(null===(n=w.getFieldValue("environments"))||void 0===n?void 0:n.version)===j(e)}))){var t,a=null===(t=o)||void 0===t?void 0:t.images[0];a&&w.setFieldsValue({environments:{environment:l,version:j(a),image:a}})}}}),[null===S||void 0===S?void 0:S.environment,null===S||void 0===S?void 0:S.manual]);var G=(0,Z.useMemo)((function(){return x().chain(z).filter((function(e){return(!!y||!function(e){return x().some(null===e||void 0===e?void 0:e.labels,(function(e){var n;return"ai.backend.features"===(null===e||void 0===e?void 0:e.key)&&(null===e||void 0===e||null===(n=e.value)||void 0===n?void 0:n.split(" ").includes("private"))}))}(e))&&(!n||n(e))})).groupBy((function(e){var n;return(null===T||void 0===T||null===(n=T.imageInfo[A(j(e)||"").key])||void 0===n?void 0:n.group)||"Custom Environments"})).map((function(e,n){return{groupName:n,environmentGroups:x().chain(e).groupBy((function(e){return null===e||void 0===e?void 0:e.name})).map((function(e,n){var i,r,o=null===(i=n.split("/"))||void 0===i?void 0:i[1];return{environmentName:n,displayName:o&&(null===T||void 0===T||null===(r=T.imageInfo[o])||void 0===r?void 0:r.name)||x().last(n.split("/")),prefix:x().chain(n).split("/").dropRight(1).join("/").value(),images:e.sort((function(e,n){var i,r,o,l,t,a;return function(e,n){for(var i=e.split(".").map(Number),r=n.split(".").map(Number),o=0;o<Math.max(i.length,r.length);o++){var l=i[o]||0,t=r[o]||0;if(l>t)return 1;if(l<t)return-1}return 0}(null!==(i=null===n||void 0===n||null===(r=n.tag)||void 0===r||null===(o=r.split("-"))||void 0===o?void 0:o[0])&&void 0!==i?i:"",null!==(l=null===e||void 0===e||null===(t=e.tag)||void 0===t||null===(a=t.split("-"))||void 0===a?void 0:a[0])&&void 0!==l?l:"")}))}})).sortBy((function(e){return e.displayName})).value()}})).sortBy((function(e){return e.groupName})).value()}),[z,T,n,y]),O=(0,Z.useMemo)((function(){var e,n;return E.length&&x().chain(G.flatMap((function(e){return e.environmentGroups})).find((function(i){return n=i,!!(e=x().find(i.images,(function(e){return j(e)===E})))}))).value(),{fullNameMatchedImage:e,fullNameMatchedImageGroup:n}}),[E,G]),W=O.fullNameMatchedImage;return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsx)("style",{children:"/* Change the image and tags of the select option when the selection is opened  */\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  img,\ndiv.image-environment-select-form-item\n  div.ant-select-open\n  span.ant-select-selection-item\n  div\n  span.ant-tag {\n  opacity: 0.5;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-light {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  div.ant-select-item-option-content\n  div.tag-wrap-dark {\n  /* flex: 1 !important; */\n  flex-wrap: wrap !important;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark {\n  overflow: hidden;\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-light::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px; /* Width of the transparent gradient area */\n  background: linear-gradient(\n    to right,\n    rgba(255, 255, 255, 0),\n    rgba(255, 255, 255, 1)\n  );\n}\n\ndiv.image-environment-select-form-item\n  span.ant-select-selection-item\n  div.tag-wrap-dark::after {\n  content: '';\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  width: 10px;\n  background: linear-gradient(\n    to right,\n    rgba(20, 20, 20, 0),\n    rgba(20, 20, 20, 1)\n  );\n}\n"}),(0,k.jsx)(m.Z.Item,{className:"image-environment-select-form-item",name:["environments","environment"],label:"".concat(R("session.launcher.Environments")," / ").concat(R("session.launcher.Version")),rules:[{required:x().isEmpty(null===S||void 0===S?void 0:S.manual)}],style:{marginBottom:10},children:(0,k.jsx)(p.Z,{ref:B,showSearch:!0,className:"image-environment-select",searchValue:E,onSearch:C,defaultActiveFirstOption:!0,optionFilterProp:"filterValue",onChange:function(e){W&&w.setFieldsValue({environments:{environment:(null===W||void 0===W?void 0:W.name)||"",version:j(W),image:W}})},disabled:P._config.allow_manual_image_name_for_session&&!x().isEmpty(null===S||void 0===S?void 0:S.manual),children:W?(0,k.jsx)(p.Z.Option,{value:null===W||void 0===W?void 0:W.name,filterValue:j(W),children:(0,k.jsxs)(s.Z,{direction:"row",align:"center",gap:"xs",style:{display:"inline-flex"},children:[(0,k.jsx)(c.Z,{image:j(W)||"",style:{width:15,height:15}}),j(W)]})}):x().map(G,(function(e){return(0,k.jsx)(p.Z.OptGroup,{label:e.groupName,children:x().map(e.environmentGroups,(function(e){var n,i=e.images[0],r=null===T||void 0===T?void 0:T.imageInfo[null===(n=e.environmentName.split("/"))||void 0===n?void 0:n[1]],o=[],l=null;e.prefix&&!["lablup","cloud","stable"].includes(e.prefix)&&(o.push(e.prefix),l=(0,k.jsx)(g.Z,{color:"purple",children:(0,k.jsx)(d.Z,{keyword:E,children:e.prefix})}));var t=x().map(null===r||void 0===r?void 0:r.label,(function(e){return x().isUndefined(e.category)&&e.tag&&e.color?(o.push(e.tag),(0,k.jsx)(g.Z,{color:e.color,children:(0,k.jsx)(d.Z,{keyword:E,children:e.tag},e.tag)},e.tag)):null}));return(0,k.jsx)(p.Z.Option,{value:e.environmentName,filterValue:e.displayName+"\t"+o.join("\t"),children:(0,k.jsxs)(s.Z,{direction:"row",justify:"between",children:[(0,k.jsxs)(s.Z,{direction:"row",align:"center",gap:"xs",children:[(0,k.jsx)(c.Z,{image:j(i)||"",style:{width:15,height:15}}),(0,k.jsx)(d.Z,{keyword:E,children:e.displayName})]}),(0,k.jsxs)(s.Z,{direction:"row",className:U?"tag-wrap-dark":"tag-wrap-light",style:{marginLeft:L.marginXS,flexShrink:1},children:[l,t]})]})},e.environmentName)}))},e.groupName)}))})}),(0,k.jsx)(m.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,r;return(null===(i=e.environments)||void 0===i?void 0:i.environment)!==(null===(r=n.environments)||void 0===r?void 0:r.environment)},children:function(e){var n,i,r=e.getFieldValue;return x().find(G,(function(e){return x().find(e.environmentGroups,(function(e){var n;return e.environmentName===(null===(n=r("environments"))||void 0===n?void 0:n.environment)&&(i=e,!0)}))})),(0,k.jsx)(m.Z.Item,{className:"image-environment-select-form-item",name:["environments","version"],rules:[{required:x().isEmpty(null===S||void 0===S?void 0:S.manual)}],children:(0,k.jsx)(p.Z,{ref:Q,onChange:function(e){var n=x().find(z,(function(n){return j(n)===e}));w.setFieldValue(["environments","image"],n)},showSearch:!0,searchValue:M,onSearch:V,optionFilterProp:"filterValue",dropdownRender:function(e){return(0,k.jsxs)(k.Fragment,{children:[(0,k.jsxs)(s.Z,{style:{fontWeight:L.fontWeightStrong,paddingLeft:L.paddingSM},children:[R("session.launcher.Version"),(0,k.jsx)(f.Z,{type:"vertical"}),R("session.launcher.Base"),(0,k.jsx)(f.Z,{type:"vertical"}),R("session.launcher.Architecture"),(0,k.jsx)(f.Z,{type:"vertical"}),R("session.launcher.Requirements")]}),(0,k.jsx)(f.Z,{style:{margin:"8px 0"}}),e]})},disabled:P._config.allow_manual_image_name_for_session&&!x().isEmpty(null===S||void 0===S?void 0:S.manual),children:x().map(x().uniqBy(null===(n=i)||void 0===n?void 0:n.images,"digest"),(function(e){var n,i=(null===e||void 0===e||null===(n=e.tag)||void 0===n?void 0:n.split("-"))||["","",""],r=(0,o.Z)(i),t=r[0],a=r[1],c=r.slice(2),m=null===T||void 0===T?void 0:T.tagAlias[a];if(!m){for(var v=0,g=Object.entries((null===T||void 0===T?void 0:T.tagReplace)||{});v<g.length;v++){var h=(0,l.Z)(g[v],2),y=h[0],Z=h[1],b=new RegExp(y);b.test(a)&&(m=null===a||void 0===a?void 0:a.replace(b,Z))}m||(m=a)}var _=[],w=c.length>0?x().map(c,(function(e,n){return(0,k.jsx)(u.Z,{values:x().split((null===T||void 0===T?void 0:T.tagAlias[e])||e,":").map((function(e){return _.push(e),(0,k.jsx)(d.Z,{keyword:M,children:e},e)}))},n)})):"-";return(0,k.jsx)(p.Z.Option,{value:j(e),filterValue:[t,m,null===e||void 0===e?void 0:e.architecture].concat(_).join("\t"),children:(0,k.jsxs)(s.Z,{direction:"row",justify:"between",children:[(0,k.jsxs)(s.Z,{direction:"row",children:[(0,k.jsx)(d.Z,{keyword:M,children:t}),(0,k.jsx)(f.Z,{type:"vertical"}),(0,k.jsx)(d.Z,{keyword:M,children:m}),(0,k.jsx)(f.Z,{type:"vertical"}),(0,k.jsx)(d.Z,{keyword:M,children:null===e||void 0===e?void 0:e.architecture})]}),(0,k.jsx)(s.Z,{direction:"row",className:U?"tag-wrap-dark":"tag-wrap-light",style:{marginLeft:L.marginXS,flexShrink:1},children:w})]})},null===e||void 0===e?void 0:e.digest)}))})})}}),(0,k.jsx)(m.Z.Item,{label:R("session.launcher.ManualImageName"),name:["environments","manual"],style:{display:P._config.allow_manual_image_name_for_session?"block":"none"},children:(0,k.jsx)(h.Z,{allowClear:!0,onChange:function(e){x().isEmpty(e)||w.setFieldsValue({environments:{environment:void 0,version:void 0,image:void 0}})}})}),(0,k.jsx)(m.Z.Item,{noStyle:!0,hidden:!0,name:["environments","image"],children:(0,k.jsx)(h.Z,{})})]})}},14001:function(e,n,i){var r=i(1413),o=i(29439),l=i(87760),t=i(4519),a=i(2556),u=function(e,n){var i=e.image,t=e.style,u=void 0===t?{}:t,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",c=(0,l.X6)(),d=(0,o.Z)(c,2)[1].getImageIcon;return(0,a.jsx)("img",{src:d(i),style:(0,r.Z)({width:"1em",height:"1em"},u),alt:s})};n.Z=t.memo(u)},92850:function(e,n,i){i.d(n,{A9:function(){return J},ds:function(){return Y},ZP:function(){return ie}});var r,o,l,t=i(4942),a=i(74165),u=i(15861),s=i(1413),c=i(29439),d=i(43255),m=i(87760),v=i(1839),p=i(4519),g=i(16980),f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{fetchPolicy:"store-and-network"},n=(0,m.Kr)("first"),l=(0,c.Z)(n,2),t=l[0],a=l[1],u=(0,m.Dj)(),d=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{fetchPolicy:"store-and-network"},o=(0,m.Kr)("first"),l=(0,c.Z)(o,2),t=l[0],a=l[1];return[(0,g.useLazyLoadQuery)(void 0!==r?r:r=i(25338),{accessKey:e},(0,s.Z)((0,s.Z)({},n),{},{fetchKey:t+n.fetchKey})).keypair,{refresh:(0,p.useCallback)((function(){a()}),[a])}]}(null===u||void 0===u?void 0:u._config.accessKey),v=(0,c.Z)(d,1)[0];return[{keypairResourcePolicy:(0,g.useLazyLoadQuery)(void 0!==o?o:o=i(94177),{name:(null===v||void 0===v?void 0:v.resource_policy)||""},(0,s.Z)((0,s.Z)({},e),{},{fetchKey:t+e.fetchKey})).keypair_resource_policy||{},keypair:v||{}},{refresh:(0,p.useCallback)((function(){a()}),[a])}]},h=i(50164),y=i(32048),x=i.n(y),Z=function(e){return void 0===e||"Infinity"===e||"NaN"===e?void 0:x().toNumber(e)},b=i(44925),_=i(99821),k=i(67668),j=i(66653),w=i(19427),S=i(70389),P=i(2556),F=["dynamicSteps","units","disableAutoUnit","min","max"],N=function(e){var n=e.dynamicSteps,i=void 0===n?[1,2,4,8,16,32,64,128,256,512]:n,r=e.units,o=void 0===r?["m","g","t","p"]:r,l=e.disableAutoUnit,t=void 0!==l&&l,a=e.min,u=void 0===a?"0m":a,m=e.max,v=void 0===m?"300p":m,g=(0,b.Z)(e,F),f=(0,_.Z)(g,{defaultValue:"0g"}),h=(0,c.Z)(f,2),y=h[0],Z=h[1],N=null===y||void 0===y?[null,null]:(0,d.n2)(y),E=(0,c.Z)(N,2),C=E[0],I=E[1],K=(0,k.Z)(I),M=I||K||o[0],V=(0,d.n2)(u),R=(0,c.Z)(V,2),q=R[0],D=R[1],T=(0,d.n2)(v),A=(0,c.Z)(T,2),L=A[0],U=A[1],B=(0,p.useRef)(null);return(0,p.useEffect)((function(){if(B.current){var e=function(e){var n,i=null===e||void 0===e||null===(n=e.target)||void 0===n?void 0:n.value;/^\d+(g|m)$/.test(i)&&Z(i)},n=B.current;return null===n||void 0===n||n.addEventListener("input",e),function(){null===n||void 0===n||n.removeEventListener("input",e)}}}),[B,C,I,Z]),(0,P.jsx)(j.Z,(0,s.Z)((0,s.Z)({ref:B},g),{},{value:C,onChange:function(e){Z(null===e||void 0===e?e:"".concat(e).concat(M))},max:U===M?L:(0,d.PZ)(v,M).number,min:D===M?q:(0,d.PZ)(u,M).number,addonAfter:(0,P.jsx)(w.Z,{tabIndex:-1,value:M,onChange:function(e){Z("".concat(C).concat(e))},onDropdownVisibleChange:function(e){(e&&null===y||void 0===y)&&Z("0".concat(M))},options:x().map(o,(function(e){return{value:e,label:(0,P.jsx)(S.Z.Text,{style:{fontFamily:"'SFMono-Regular',Consolas,'Liberation Mono',Menlo,Courier,monospace"},children:e.toUpperCase()+"iB"})}})),suffixIcon:o.length>1?void 0:null,open:o.length>1&&void 0,style:{cursor:o.length>1?void 0:"default"}}),step:0,onStep:function(e,n){var r,l=x().isNull(C)||x().isUndefined(C)?0:C,a=x().sortedIndex(x().sortBy(i),l);r="up"===n.type?l===i[a]?a+1:a:a-1;var u=o.indexOf(M);if(!t&&r<0)if(0===u)Z("0".concat(M));else{var s=i[i.length-1],c=o[u-1];Z("".concat(s).concat(c))}else if(!t&&r>i.length-1)if(u===o.length-1)Z("".concat(l+("up"===n.type?1:-1)).concat(U));else{var d=i[0],m=o[u+1];Z("".concat(d).concat(m))}else if(r>=0&&r<i.length){var v=i[r];D===M&&v<q?v=q:U===M&&v>L&&(v=L),Z("".concat(v).concat(M))}}}))},E=i(99277),C=i(44036),I=i(31603),K=["min","max","warn","units","extraMarks","hideSlider"],M=function(e){var n=e.min,i=void 0===n?"0m":n,r=e.max,o=void 0===r?"32g":r,l=e.warn,a=e.units,u=void 0===a?["m","g"]:a,m=e.extraMarks,v=e.hideSlider,g=(0,b.Z)(e,K),f=(0,_.Z)(g,{defaultValue:"0g"}),h=(0,c.Z)(f,2),y=h[0],Z=h[1],k=C.Z.useToken().token,j=(0,p.useMemo)((function(){return(0,d.PZ)(i,"g",2)}),[i]),w=(0,p.useMemo)((function(){return(0,d.PZ)(o,"g",2)}),[o]),S=(0,p.useMemo)((function(){return(0,d.PZ)(y||"0g","g",2)}),[y]);return(0,P.jsxs)(E.Z,{direction:"row",gap:"md",children:[(0,P.jsx)(E.Z,{style:{flex:2,minWidth:190},direction:"column",align:"stretch",children:(0,P.jsx)(N,(0,s.Z)((0,s.Z)({},g),{},{min:i,max:o,units:u,value:y,onChange:function(e){Z(e)},style:{minWidth:130}}))}),(0,P.jsx)(E.Z,{direction:"column",align:"stretch",style:(0,s.Z)({flex:3},v&&{visibility:"hidden",height:0}),children:(0,P.jsx)(E.Z,{direction:"column",align:"stretch",children:(0,P.jsx)(I.Z,{max:null===w||void 0===w?void 0:w.number,trackStyle:l&&{backgroundColor:(0,d.p)(l,y||"0b")<0?k.colorWarning:void 0}||void 0,railStyle:{},step:.125,value:null===S||void 0===S?void 0:S.number,tooltip:{formatter:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return e<1?"".concat((1024*e).toFixed(2)," MiB"):"".concat(e.toFixed(2)," GiB")}},onChange:function(e){null!==j&&void 0!==j&&j.number&&j.number>e?Z(i):Z(e<1?"".concat(1024*e,"m"):"".concat(e,"g"))},marks:(0,s.Z)((0,s.Z)((0,s.Z)({},j&&x().isNumber(null===j||void 0===j?void 0:j.number)&&(0,t.Z)({},j.number,{style:{color:k.colorTextSecondary},label:0===j.number?j.number:j.number>=1?j.number+"g":1024*j.number+"m"})),x().omitBy(m,(function(e,n){return!!x().isNumber(null===w||void 0===w?void 0:w.number)&&x().parseInt(n)>(null===w||void 0===w?void 0:w.number)}))),(null===w||void 0===w?void 0:w.number)&&(0,t.Z)({},w.number,{style:{color:k.colorTextSecondary},label:0===w.number?w.number:w.number>=1?w.number+"g":1024*w.number+"m"}))})})})]})},V=["min","max","step","disabled","inputNumberProps","sliderProps"],R=function(e){var n=e.min,i=e.max,r=e.step,o=e.disabled,l=e.inputNumberProps,t=e.sliderProps,a=(0,b.Z)(e,V),u=(0,_.Z)(a),d=(0,c.Z)(u,2),m=d[0],v=d[1];return(0,p.useEffect)((function(){1===r&&m%1!==0&&v(Math.round(m))}),[r]),(0,P.jsxs)(E.Z,{direction:"row",gap:"md",children:[(0,P.jsx)(E.Z,{style:{flex:2,minWidth:190},align:"stretch",direction:"column",children:(0,P.jsx)(j.Z,(0,s.Z)({max:i,min:n,step:r,disabled:o,value:m,onChange:v},l))}),(0,P.jsx)(E.Z,{direction:"column",align:"stretch",style:{flex:3},children:(0,P.jsx)(I.Z,(0,s.Z)((0,s.Z)({max:i,min:0,step:r,disabled:o,value:m,onChange:function(e){void 0!==n&&e<n||v(e)}},t),{},{marks:x().omitBy(null===t||void 0===t?void 0:t.marks,(function(e,n){return!!x().isNumber(i)&&x().parseInt(n)>i}))}))})]})},q=i(61815),D=i(96732),T=i(36459),A=i(61749),L=i(73519),U=function(e){var n=Object.assign({},((0,T.Z)(e),e)),r=(0,m.Kr)("first"),o=(0,c.Z)(r,2),t=o[0],a=o[1],u=(0,L.Z)(a,{wait:3e3,trailing:!1,leading:!0}).run,d=(0,v.T6)(),f=(0,c.Z)(d,1)[0],h=(0,p.useTransition)(),y=(0,c.Z)(h,2),Z=y[0],b=y[1],_=(0,g.useLazyLoadQuery)(void 0!==l?l:l=i(73340),{},{fetchKey:t,fetchPolicy:"first"===t?"store-and-network":"network-only"}).resource_presets;return(0,P.jsx)(w.Z,(0,s.Z)((0,s.Z)({loading:Z,options:[{value:"custom",label:(0,P.jsxs)(E.Z,{gap:"xs",style:{display:"inline-flex"},children:[(0,P.jsx)(A.Z,{})," Custom"]})},{label:"Preset",options:x().map(_,(function(e,n){var i=JSON.parse(null===e||void 0===e?void 0:e.resource_slots);return{value:null===e||void 0===e?void 0:e.name,label:(0,P.jsxs)(E.Z,{direction:"row",justify:"between",gap:"xs",children:[null===e||void 0===e?void 0:e.name,(0,P.jsx)(E.Z,{direction:"row",gap:"xxs",style:{color:"black",opacity:1===n?.5:1},children:x().map(x().omitBy(i,(function(e,n){return x().isEmpty(f[n])})),(function(e,n){return(0,P.jsx)(D.ZP,{type:n,value:e,hideTooltip:!0},n)}))})]}),preset:e}}))}],showSearch:!0},n),{},{onDropdownVisibleChange:function(e){e&&(console.log(e),b((function(){u()})))}}))},B=i(58021),Q=i(57054),z=i(53066),G=i(62708),O=i(83799),W=i(35492),$=i(2704),X=i(22733),H=i(81748),J="64m",Y={resource:{cpu:0,mem:"0g",shmem:"0g",accelerator:0},num_of_sessions:1,cluster_mode:"single-node",cluster_size:1,enabledAutomaticShmem:!0},ee=function(e){var n=e.enableNumOfSessions,i=e.enableResourcePresets,r=Q.Z.useFormInstance(),o=(0,H.$G)().t,l=C.Z.useToken().token,g=(0,m.Dj)(),y=(0,v.T6)(),b=(0,c.Z)(y,1)[0],_=x().omit(b,["cpu","mem","shmem"]),k=f(),j=(0,c.Z)(k,1)[0],S=j.keypair,F=j.keypairResourcePolicy,N=(0,m.qh)(),I=(0,p.useState)(r.getFieldValue("resourceGroup")),K=(0,c.Z)(I,2),V=K[0],T=K[1],A=(0,p.useTransition)(),L=(0,c.Z)(A,2),B=L[0],Y=L[1],ee=Q.Z.useWatch(["environments","image"],{form:r,preserve:!0}),ie=function(e){var n,i,r,o,l,t,a,u,s,p,g,f,y,b,_,k,j,w,S,P,F,N,E=e.currentImage,C=e.currentResourceGroup,I=e.currentProjectName,K=(0,m.Dj)(),M=(0,v.T6)(),V=(0,c.Z)(M,1)[0],R=x().omit(V,["cpu","mem","shmem"]),q=(0,h.h)({queryKey:["check-resets",I,C],queryFn:function(){return C?K.resourcePreset.check({group:I,scaling_group:C}):void 0},staleTime:0,suspense:!x().isEmpty(C)}),D=q.data,T=q.refetch,A=q.isRefetching,L=(null===(n=x().find(null===E||void 0===E?void 0:E.resource_limits,(function(e){return"mem"===(null===e||void 0===e?void 0:e.key)})))||void 0===n?void 0:n.min)||"0g",U={cpu:x().isEmpty(null===D||void 0===D||null===(i=D.scaling_groups[C])||void 0===i||null===(r=i.using)||void 0===r?void 0:r.cpu)||x().isEmpty(null===D||void 0===D||null===(o=D.scaling_groups[C])||void 0===o||null===(l=o.remaining)||void 0===l?void 0:l.cpu)?void 0:x().toNumber(null===D||void 0===D||null===(t=D.scaling_groups[C])||void 0===t?void 0:t.using.cpu)+x().toNumber(null===D||void 0===D||null===(a=D.scaling_groups[C])||void 0===a?void 0:a.remaining.cpu),mem:x().isEmpty(null===D||void 0===D||null===(u=D.scaling_groups[C])||void 0===u||null===(s=u.using)||void 0===s?void 0:s.mem)||x().isEmpty(null===D||void 0===D||null===(p=D.scaling_groups[C])||void 0===p||null===(g=p.remaining)||void 0===g?void 0:g.mem)?void 0:(null===(f=(0,d.PZ)(x().toNumber(null===D||void 0===D||null===(y=D.scaling_groups[C])||void 0===y?void 0:y.using.mem)+x().toNumber(null===D||void 0===D||null===(b=D.scaling_groups[C])||void 0===b?void 0:b.remaining.mem)+"b","g",2))||void 0===f?void 0:f.numberFixed)+"g",accelerators:x().reduce(R,(function(e,n,i){var r,o,l,t,a,u;return e[i]=x().isEmpty(null===D||void 0===D||null===(r=D.scaling_groups[C])||void 0===r||null===(o=r.using)||void 0===o?void 0:o[i])||x().isEmpty(null===D||void 0===D||null===(l=D.scaling_groups[C])||void 0===l||null===(t=l.remaining)||void 0===t?void 0:t[i])?void 0:x().toNumber(null===D||void 0===D||null===(a=D.scaling_groups[C])||void 0===a?void 0:a.using[i])+x().toNumber(null===D||void 0===D||null===(u=D.scaling_groups[C])||void 0===u?void 0:u.remaining[i]),e}),{})},B={cpu:void 0===(null===V||void 0===V?void 0:V.cpu)?void 0:{min:x().max([x().toNumber((null===(_=x().find(null===E||void 0===E?void 0:E.resource_limits,(function(e){return"cpu"===(null===e||void 0===e?void 0:e.key)})))||void 0===_?void 0:_.min)||"0")]),max:x().min([K._config.maxCPUCoresPerContainer,Z(null===D||void 0===D?void 0:D.keypair_limits.cpu),Z(null===D||void 0===D?void 0:D.group_limits.cpu),null===U||void 0===U?void 0:U.cpu])},mem:void 0===(null===V||void 0===V?void 0:V.mem)?void 0:{min:(0,d.v3)(x().max([null===(k=(0,d.PZ)(L,"b"))||void 0===k?void 0:k.number,null===(j=(0,d.PZ)(J,"b"))||void 0===j?void 0:j.number,0])+"b",J),max:x().min([K._config.maxMemoryPerContainer,Z(null===D||void 0===D?void 0:D.keypair_limits.mem)&&(null===(w=(0,d.PZ)(Z(null===D||void 0===D?void 0:D.keypair_limits.mem)+"","g"))||void 0===w?void 0:w.number),Z(null===D||void 0===D?void 0:D.group_limits.mem)&&(null===(S=(0,d.PZ)(Z(null===D||void 0===D?void 0:D.group_limits.mem)+"","g"))||void 0===S?void 0:S.number),(null===U||void 0===U?void 0:U.mem)&&(null===(P=(0,d.PZ)((null===U||void 0===U?void 0:U.mem)+"","g"))||void 0===P?void 0:P.number)])+"g"},accelerators:x().reduce(R,(function(e,n,i){var r,o,l={"cuda.device":"maxCUDADevicesPerContainer","cuda.shares":"maxCUDASharesPerContainer","rocm.device":"maxROCMDevicesPerContainer","tpu.device":"maxTPUDevicesPerContainer","ipu.device":"maxIPUDevicesPerContainer","atom.device":"maxATOMDevicesPerContainer","warboy.device":"maxWarboyDevicesPerContainer"}[i]||"cuda.device";return e[i]={min:parseInt((null===(r=x().filter(null===E||void 0===E?void 0:E.resource_limits,(function(e){return(null===e||void 0===e?void 0:e.key)===i})))||void 0===r||null===(o=r[0])||void 0===o?void 0:o.min)||"0"),max:x().min([K._config[l]||8,U.accelerators[i]])},e}),{})},Q={accelerators:x().reduce(R,(function(e,n,i){var r;return e[i]=null!==(r=x().min([x().toNumber(null===D||void 0===D?void 0:D.keypair_remaining[i]),x().toNumber(null===D||void 0===D?void 0:D.group_remaining[i]),x().toNumber(null===D||void 0===D?void 0:D.scaling_group_remaining[i])]))&&void 0!==r?r:Number.MAX_SAFE_INTEGER,e}),{}),cpu:null!==(F=x().min([Z(null===D||void 0===D?void 0:D.keypair_remaining.cpu),Z(null===D||void 0===D?void 0:D.group_remaining.cpu),Z(null===D||void 0===D?void 0:D.scaling_group_remaining.cpu)]))&&void 0!==F?F:Number.MAX_SAFE_INTEGER,mem:null!==(N=x().min([Z(null===D||void 0===D?void 0:D.keypair_remaining.mem),Z(null===D||void 0===D?void 0:D.group_remaining.mem),Z(null===D||void 0===D?void 0:D.scaling_group_remaining.mem)]))&&void 0!==N?N:Number.MAX_SAFE_INTEGER};return[{resourceGroupResourceSize:U,resourceLimits:B,remaining:Q,currentImageMinM:L,isRefetching:A},{refetch:T}]}({currentProjectName:N.name,currentResourceGroup:V,currentImage:ee}),re=(0,c.Z)(ie,1)[0],oe=re.currentImageMinM,le=re.remaining,te=re.resourceLimits,ae=x().filter(null===ee||void 0===ee?void 0:ee.resource_limits,(function(e){return!!e&&!x().includes(["cpu","mem","shmem"],e.key)})),ue={min:1,max:x().min([F.max_concurrent_sessions,3]),remaining:(F.max_concurrent_sessions||3)-(S.concurrency_used||0)};(0,p.useEffect)((function(){var e,n,i,o,l,t;if(r.setFieldsValue({resource:{cpu:null===(e=te.cpu)||void 0===e?void 0:e.min,mem:(null===(n=(0,d.PZ)(((null===(i=(0,d.PZ)(null===(o=te.shmem)||void 0===o?void 0:o.min,"m"))||void 0===i?void 0:i.number)||0)+((null===(l=(0,d.PZ)(null===(t=te.mem)||void 0===t?void 0:t.min,"m"))||void 0===l?void 0:l.number)||0)+"m","g"))||void 0===n?void 0:n.number)+"g"}}),ae.length>0)if(x().find(ae,(function(e){return(null===e||void 0===e?void 0:e.key)===r.getFieldValue(["resource","acceleratorType"])}))){var a;r.setFieldValue(["resource","accelerator"],null===(a=te.accelerators[r.getFieldValue(["resource","acceleratorType"])])||void 0===a?void 0:a.min)}else{var u,s,c=null===(u=x().filter(ae,(function(e){return x().keys(b).includes(null===e||void 0===e?void 0:e.key)}))[0])||void 0===u?void 0:u.key;if(c)r.setFieldValue(["resource","accelerator"],null===(s=te.accelerators[c])||void 0===s?void 0:s.min),r.setFieldValue(["resource","acceleratorType"],c)}else r.setFieldValue(["resource","accelerator"],0);r.validateFields([["resource","cpu"],["resource","mem"],["resource","shmem"],["resource","accelerator"],["resource","acceleratorType"]]).catch((function(){}))}),[ee]);var se=function(e){(0,d.p)(e,"4g")>=0&&(0,d.p)(e,(0,d.v3)(oe,"1g")||"0b")>=0&&(0,d.p)("1g",J)>0?r.setFieldValue(["resource","shmem"],"1g"):r.setFieldValue(["resource","shmem"],J)};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(Q.Z.Item,{name:"resourceGroup",label:o("session.ResourceGroup"),rules:[{required:!0}],children:(0,P.jsx)(q.Z,{autoSelectDefault:!0,showSearch:!0,loading:B,onChange:function(e){Y((function(){T(e)}))}})}),i?(0,P.jsx)(Q.Z.Item,{label:o("resourcePreset.ResourcePresets"),name:"allocationPreset",required:!0,style:{marginBottom:l.marginXS},children:(0,P.jsx)(U,{onChange:function(e,n){var i,o,l,t,a=x().pick(JSON.parse((null===n||void 0===n||null===(i=n.preset)||void 0===i?void 0:i.resource_slots)||"{}"),x().keys(b));r.setFieldsValue({resource:(0,s.Z)((0,s.Z)({},a),{},{mem:null===(o=(0,d.PZ)(((null===a||void 0===a?void 0:a.mem)||0)+"b","g",2))||void 0===o?void 0:o.numberUnit,shmem:null===(l=(0,d.PZ)(((null===n||void 0===n||null===(t=n.preset)||void 0===t?void 0:t.shared_memory)||0)+"b","g",2))||void 0===l?void 0:l.numberUnit})})}})}):null,(0,P.jsx)(z.Z,{style:{marginBottom:l.margin},children:(0,P.jsx)(Q.Z.Item,{shouldUpdate:function(e,n){return e.allocationPreset!==n.allocationPreset},noStyle:!0,children:function(e){var n,i,c,m,v,p,f,h,y,Z,k=e.getFieldValue;return(0,P.jsxs)(P.Fragment,{children:[(null===b||void 0===b?void 0:b.cpu)&&(0,P.jsx)(Q.Z.Item,{name:["resource","cpu"],label:o("session.launcher.CPU"),tooltip:{placement:"right",title:(0,P.jsx)(H.cC,{i18nKey:"session.launcher.DescCPU"})},required:!0,rules:[{required:!0},{type:"number",min:null===(n=te.cpu)||void 0===n?void 0:n.min},{warningOnly:null===(i=g._config)||void 0===i?void 0:i.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(x().isNumber(le.cpu)&&i>le.cpu)){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=g._config)&&void 0!==r&&r.always_enqueue_compute_session?o("session.launcher.EnqueueComputeSessionWarning"):o("session.launcher.ErrorCanNotExceedRemaining",{amount:le.cpu})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(R,{inputNumberProps:{addonAfter:o("session.launcher.Core")},sliderProps:{marks:(0,s.Z)((0,s.Z)((0,s.Z)({},le.cpu?(0,t.Z)({},le.cpu,{label:(0,P.jsx)(ne,{})}):{}),null!==(c=te.cpu)&&void 0!==c&&c.min?(0,t.Z)({},null===(m=te.cpu)||void 0===m?void 0:m.min,null===(v=te.cpu)||void 0===v?void 0:v.min):{}),null!==(p=te.cpu)&&void 0!==p&&p.max?(0,t.Z)({},null===(f=te.cpu)||void 0===f?void 0:f.max,{style:{color:l.colorTextSecondary},label:null===(h=te.cpu)||void 0===h?void 0:h.max}):{})},min:null===(y=te.cpu)||void 0===y?void 0:y.min,max:null===(Z=te.cpu)||void 0===Z?void 0:Z.max})}),(null===b||void 0===b?void 0:b.mem)&&(0,P.jsxs)(Q.Z.Item,{label:o("session.launcher.Memory"),tooltip:{placement:"right",props:{onClick:function(e){return e.preventDefault()}},title:(0,P.jsx)(E.Z,{direction:"column",onClick:function(e){return e.preventDefault()},children:(0,P.jsx)(H.cC,{i18nKey:"session.launcher.DescMemory"})})},required:!0,children:[(0,P.jsx)(Q.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.resource.shmem!==n.resource.shmem},children:function(){var e,n,i,l;return(0,P.jsx)(Q.Z.Item,{name:["resource","mem"],noStyle:!0,rules:[{required:!0},{validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r,l,t;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!x().isElement(i)&&null!==(r=te.mem)&&void 0!==r&&r.min&&(0,d.p)(i,(null===(l=te.mem)||void 0===l?void 0:l.min)||"0g")<0)){e.next=4;break}return e.abrupt("return",Promise.reject(o("session.launcher.MinMemory",{size:x().toUpper((null===(t=te.mem)||void 0===t?void 0:t.min)||"0g")})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()},{warningOnly:null===(e=g._config)||void 0===e?void 0:e.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(!x().isElement(i)&&te.mem&&(0,d.p)(i,le.mem+"b")>0)){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=g._config)&&void 0!==r&&r.always_enqueue_compute_session?o("session.launcher.EnqueueComputeSessionWarning"):o("session.launcher.ErrorCanNotExceedRemaining",{amount:(null===(l=(0,d.PZ)(le.mem+"b","g",3))||void 0===l?void 0:l.numberUnit)+"iB"})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(M,{max:null===(n=te.mem)||void 0===n?void 0:n.max,min:null===(i=te.mem)||void 0===i?void 0:i.min,addonBefore:"MEM",extraMarks:(0,s.Z)({},le.mem?(0,t.Z)({},null===(l=(0,d.PZ)(le.mem+"b","g",3))||void 0===l?void 0:l.numberFixed,{label:(0,P.jsx)(ne,{})}):{}),onChange:function(e){e&&r.getFieldValue("enabledAutomaticShmem")&&se(e)}})})}}),(0,P.jsxs)(E.Z,{direction:"column",gap:"xxs",align:"start",children:[(0,P.jsxs)(E.Z,{direction:"row",gap:"xs",children:[o("session.launcher.EnableAutomaticShmem")," ",(0,P.jsx)(Q.Z.Item,{noStyle:!0,name:"enabledAutomaticShmem",valuePropName:"checked",children:(0,P.jsx)(G.Z,{size:"small",onChange:function(e){e&&se(r.getFieldValue(["resource","mem"])||"0g")}})})]}),(0,P.jsx)(Q.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.resource.mem!==n.resource.mem||e.enabledAutomaticShmem!==n.enabledAutomaticShmem},children:function(){var e;return(0,P.jsx)(Q.Z.Item,{noStyle:!0,name:["resource","shmem"],hidden:r.getFieldValue("enabledAutomaticShmem"),tooltip:(0,P.jsx)(H.cC,{i18nKey:"session.launcher.DescSharedMemory"}),dependencies:[["resource","mem"]],rules:[{required:!0},{},{validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(x().isEmpty(null===(r=k("resource"))||void 0===r?void 0:r.mem)||x().isEmpty(i)||(0,d.p)(null===(l=k("resource"))||void 0===l?void 0:l.mem,i)>=0)){e.next=4;break}return e.abrupt("return",Promise.resolve());case 4:throw o("resourcePreset.SHMEMShouldBeSmallerThanMemory");case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(M,{min:null===(e=te.shmem)||void 0===e?void 0:e.min,addonBefore:"SHM",max:r.getFieldValue(["resource","mem"])||"0g",hideSlider:!0})})}})]})]}),(0,P.jsx)(Q.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){var i,r;return(null===(i=e.resource)||void 0===i?void 0:i.acceleratorType)!==(null===(r=n.resource)||void 0===r?void 0:r.acceleratorType)||e.cluster_size!==n.cluster_size},children:function(e){var n,i,l,c,d,m,v=(0,e.getFieldValue)(["resource","acceleratorType"]);return(0,P.jsx)(Q.Z.Item,{name:["resource","accelerator"],label:o("session.launcher.AIAccelerator"),tooltip:{placement:"right",title:(0,P.jsx)(H.cC,{i18nKey:"session.launcher.DescAIAccelerator"})},rules:[{required:ae.length>0},{type:"number",min:(null===(n=te.accelerators[v])||void 0===n?void 0:n.min)||0},{warningOnly:null===(i=g._config)||void 0===i?void 0:i.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(x().isNumber(le.accelerators[v])&&i>le.accelerators[v])){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=g._config)&&void 0!==r&&r.always_enqueue_compute_session?o("session.launcher.EnqueueComputeSessionWarning"):o("session.launcher.ErrorCanNotExceedRemaining",{amount:le.accelerators[v]})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(R,{sliderProps:{marks:(0,s.Z)((0,s.Z)({0:0},le.accelerators[v]?(0,t.Z)({},le.accelerators[v],{label:(0,P.jsx)(ne,{})}):{}),x().isNumber(null===(l=te.accelerators[v])||void 0===l?void 0:l.max)?(0,t.Z)({},null===(c=te.accelerators[v])||void 0===c?void 0:c.max,null===(d=te.accelerators[v])||void 0===d?void 0:d.max):{}),tooltip:{formatter:function(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0," ").concat(D.Ec[v])},open:!(ae.length<=0)&&void 0}},disabled:0===ae.length&&x().isEmpty(r.getFieldValue(["environments","manual"])),min:0,max:null===(m=te.accelerators[v])||void 0===m?void 0:m.max,step:x().endsWith(v,"shares")&&r.getFieldValue("cluster_size")<2?.1:1,inputNumberProps:{addonAfter:(0,P.jsx)(Q.Z.Item,{noStyle:!0,name:["resource","acceleratorType"],initialValue:x().keys(_)[0],children:(0,P.jsx)(w.Z,{tabIndex:-1,disabled:0===ae.length&&x().isEmpty(r.getFieldValue(["environments","manual"])),suffixIcon:x().size(_)>1?void 0:null,popupMatchSelectWidth:!1,options:x().map(_,(function(e,n){return{value:n,label:D.Ec[n]||"UNIT",disabled:ae.length>0&&!x().find(ae,(function(e){return(null===e||void 0===e?void 0:e.key)===n}))}}))})})}})})}})]})}})}),n?(0,P.jsx)(z.Z,{style:{marginBottom:l.margin},children:(0,P.jsx)(Q.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.cluster_size!==n.cluster_size},children:function(){var e;return(0,P.jsx)(Q.Z.Item,{name:["num_of_sessions"],label:o("webui.menu.Sessions"),tooltip:(0,P.jsx)(H.cC,{i18nKey:"session.launcher.DescSession"}),required:!0,rules:[{required:!0},{warningOnly:null===(e=g._config)||void 0===e?void 0:e.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(ue&&i>ue.remaining)){e.next=4;break}return e.abrupt("return",Promise.reject(null!==(r=g._config)&&void 0!==r&&r.always_enqueue_compute_session?o("session.launcher.EnqueueComputeSessionWarning"):o("session.launcher.ErrorCanNotExceedRemaining",{amount:ue.remaining})));case 4:return e.abrupt("return",Promise.resolve());case 5:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(R,{inputNumberProps:{addonAfter:"#"},disabled:r.getFieldValue("cluster_size")>1,sliderProps:{marks:(0,s.Z)((0,s.Z)((0,t.Z)({},null===ue||void 0===ue?void 0:ue.min,null===ue||void 0===ue?void 0:ue.min),null!==ue&&void 0!==ue&&ue.remaining?(0,t.Z)({},null===ue||void 0===ue?void 0:ue.remaining,{label:(0,P.jsx)(ne,{})}):{}),{},(0,t.Z)({},null===ue||void 0===ue?void 0:ue.max,null===ue||void 0===ue?void 0:ue.max))},min:null===ue||void 0===ue?void 0:ue.min,max:null===ue||void 0===ue?void 0:ue.max})})}})}):null,g.supports("multi-container")&&(0,P.jsx)(Q.Z.Item,{label:o("session.launcher.ClusterMode"),tooltip:(0,P.jsxs)(E.Z,{direction:"column",align:"start",children:[o("session.launcher.SingleNode"),(0,P.jsx)(H.cC,{i18nKey:"session.launcher.DescSingleNode"}),(0,P.jsx)(O.Z,{style:{backgroundColor:l.colorBorder}}),o("session.launcher.MultiNode"),(0,P.jsx)(H.cC,{i18nKey:"session.launcher.DescMultiNode"})]}),required:!0,children:(0,P.jsx)(z.Z,{style:{marginBottom:l.margin},children:(0,P.jsxs)(W.Z,{gutter:l.marginMD,children:[(0,P.jsx)($.Z,{xs:24,children:(0,P.jsx)(Q.Z.Item,{name:"cluster_mode",required:!0,children:(0,P.jsxs)(X.ZP.Group,{onChange:function(e){r.validateFields().catch((function(){}))},children:[(0,P.jsx)(X.ZP.Button,{value:"single-node",children:o("session.launcher.SingleNode")}),(0,P.jsx)(X.ZP.Button,{value:"multi-node",children:o("session.launcher.MultiNode")})]})})}),(0,P.jsx)($.Z,{xs:24,children:(0,P.jsx)(Q.Z.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.cluster_mode!==n.cluster_mode},children:function(){var e,n,i=x().min([null===(e=te.cpu)||void 0===e?void 0:e.max,F.max_containers_per_session]),l="single-node"===r.getFieldValue("cluster_mode")?o("session.launcher.Container"):o("session.launcher.Node");return(0,P.jsx)(Q.Z.Item,{name:"cluster_size",label:o("session.launcher.ClusterSize"),required:!0,rules:[{warningOnly:null===(n=g._config)||void 0===n?void 0:n.always_enqueue_compute_session,validator:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(n,i){var r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=x().min([le.cpu,F.max_containers_per_session]),!(x().isNumber(r)&&i>r)){e.next=5;break}return e.abrupt("return",Promise.reject(o("session.launcher.EnqueueComputeSessionWarning")));case 5:return e.abrupt("return",Promise.resolve());case 6:case"end":return e.stop()}}),e)})));return function(n,i){return e.apply(this,arguments)}}()}],children:(0,P.jsx)(R,{min:1,max:x().isNumber(i)?i:void 0,disabled:1===i,sliderProps:{marks:(0,s.Z)((0,s.Z)({1:"1"},le.cpu?(0,t.Z)({},le.cpu,{label:(0,P.jsx)(ne,{})}):{}),x().isNumber(i)?(0,t.Z)({},i,i):{}),tooltip:{formatter:function(){return"".concat(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0," ").concat(l)}}},inputNumberProps:{addonAfter:l},onChange:function(e){e>1&&r.setFieldValue("num_of_sessions",1)}})})}})})]})})})]})},ne=function(){var e=C.Z.useToken().token;return(0,P.jsx)(E.Z,{style:{position:"absolute",top:-24,transform:"translateX(-50%)",color:e.colorSuccess,opacity:.5},children:(0,P.jsx)(B.Z,{})})},ie=p.memo(ee)},71947:function(e,n,i){i.r(n);var r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"installed"}],n={alias:null,args:null,kind:"ScalarField",name:"key",storageKey:null},i=[{alias:null,args:[{kind:"Variable",name:"is_installed",variableName:"installed"}],concreteType:"Image",kind:"LinkedField",name:"images",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"humanized_name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"tag",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"registry",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"architecture",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"digest",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"installed",storageKey:null},{alias:null,args:null,concreteType:"ResourceLimit",kind:"LinkedField",name:"resource_limits",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"min",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max",storageKey:null}],storageKey:null},{alias:null,args:null,concreteType:"KVPair",kind:"LinkedField",name:"labels",plural:!0,selections:[n,{alias:null,args:null,kind:"ScalarField",name:"value",storageKey:null}],storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"ImageEnvironmentSelectFormItemsQuery",selections:i,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"ImageEnvironmentSelectFormItemsQuery",selections:i},params:{cacheID:"ea71f4a3948d4742dd6bb11ef80a8300",id:null,metadata:{},name:"ImageEnvironmentSelectFormItemsQuery",operationKind:"query",text:"query ImageEnvironmentSelectFormItemsQuery(\n  $installed: Boolean\n) {\n  images(is_installed: $installed) {\n    name\n    humanized_name\n    tag\n    registry\n    architecture\n    digest\n    installed\n    resource_limits {\n      key\n      min\n      max\n    }\n    labels {\n      key\n      value\n    }\n  }\n}\n"}}}();r.hash="33367bd6e1532b42b61629ef9d3dc46b",n.default=r},73340:function(e,n,i){i.r(n);var r=function(){var e=[{alias:null,args:null,concreteType:"ResourcePreset",kind:"LinkedField",name:"resource_presets",plural:!0,selections:[{alias:null,args:null,kind:"ScalarField",name:"name",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_slots",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"shared_memory",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:[],kind:"Fragment",metadata:null,name:"ResourcePresetSelectQuery",selections:e,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:[],kind:"Operation",name:"ResourcePresetSelectQuery",selections:e},params:{cacheID:"bd89430b9924d926a1b8e91191746b4f",id:null,metadata:{},name:"ResourcePresetSelectQuery",operationKind:"query",text:"query ResourcePresetSelectQuery {\n  resource_presets {\n    name\n    resource_slots\n    shared_memory\n  }\n}\n"}}}();r.hash="9841642e96d89476c2848bfb093ed9c5",n.default=r},25338:function(e,n,i){i.r(n);var r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"accessKey"}],n=[{alias:null,args:[{kind:"Variable",name:"access_key",variableName:"accessKey"}],concreteType:"KeyPair",kind:"LinkedField",name:"keypair",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"id",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"resource_policy",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"concurrency_used",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairQuery",selections:n},params:{cacheID:"1f8fc324e9907111de581f5cd2dc3640",id:null,metadata:{},name:"hooksUsingRelay_KeyPairQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairQuery(\n  $accessKey: String!\n) {\n  keypair(access_key: $accessKey) {\n    id\n    resource_policy\n    concurrency_used\n  }\n}\n"}}}();r.hash="d8f5c91f0fc46a3366f57566ab688d81",n.default=r},94177:function(e,n,i){i.r(n);var r=function(){var e=[{defaultValue:null,kind:"LocalArgument",name:"name"}],n=[{alias:null,args:[{kind:"Variable",name:"name",variableName:"name"}],concreteType:"KeyPairResourcePolicy",kind:"LinkedField",name:"keypair_resource_policy",plural:!1,selections:[{alias:null,args:null,kind:"ScalarField",name:"max_containers_per_session",storageKey:null},{alias:null,args:null,kind:"ScalarField",name:"max_concurrent_sessions",storageKey:null}],storageKey:null}];return{fragment:{argumentDefinitions:e,kind:"Fragment",metadata:null,name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:n,type:"Queries",abstractKey:null},kind:"Request",operation:{argumentDefinitions:e,kind:"Operation",name:"hooksUsingRelay_KeyPairResourcePolicyQuery",selections:n},params:{cacheID:"ad7039c1935637fe3f3841f0ea8bf347",id:null,metadata:{},name:"hooksUsingRelay_KeyPairResourcePolicyQuery",operationKind:"query",text:"query hooksUsingRelay_KeyPairResourcePolicyQuery(\n  $name: String!\n) {\n  keypair_resource_policy(name: $name) {\n    max_containers_per_session\n    max_concurrent_sessions\n  }\n}\n"}}}();r.hash="f3f7364c63aefe9b03111b584c48c103",n.default=r},1839:function(e,n,i){i.d(n,{T6:function(){return d},jC:function(){return m}});var r=i(1413),o=i(29439),l=i(87760),t=i(43255),a=i(50164),u=i(32048),s=i.n(u),c=i(4519),d=function(){var e=(0,l.Kr)("first"),n=(0,o.Z)(e,2),i=n[0],r=n[1],t=(0,l.Dj)();return[(0,a.h)({queryKey:["useResourceSlots",i],queryFn:function(){return t.get_resource_slots()},staleTime:0}).data,{refresh:function(){return r()}}]},m=function(){var e=(0,l.Dj)(),n=(0,c.useState)({full_name:e.full_name,email:e.email}),i=(0,o.Z)(n,2),u=i[0],d=i[1];(0,c.useEffect)((function(){var n=function(n){if(e.supports("change-user-name")){var i=n.detail;d((function(e){return(0,r.Z)((0,r.Z)({},e),{},{full_name:i})}))}};return document.addEventListener("current-user-info-changed",n),function(){document.removeEventListener("current-user-info-changed",n)}}),[e]);var m=(0,a.Y)({mutationFn:function(n){return e.update_full_name(n.email,n.full_name)}}),v=(0,a.Y)({mutationFn:function(n){return e.update_password(n.old_password,n.new_password,n.new_password2)}});return[(0,r.Z)((0,r.Z)({},u),{},{username:function(){var n=s().trim(u.full_name).length>0?u.full_name:u.email;if(e._config.maskUserInfo){var i=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(n)?n.split("@")[0].length-2:n.length-2;n=(0,t.Cd)(n,"*",2,i)}return n}(),isPendingMutation:m.isLoading||v.isLoading}),{updateFullName:function(n,i){m.mutate({full_name:n,email:e.email},{onSuccess:function(){(null===i||void 0===i?void 0:i.onSuccess)&&i.onSuccess(n),document.dispatchEvent(new CustomEvent("current-user-info-changed",{detail:n})),d((function(e){return(0,r.Z)((0,r.Z)({},e),{},{full_name:n})}))},onError:function(e){(null===i||void 0===i?void 0:i.onError)&&i.onError(e)}})},updatePassword:function(e,n){v.mutate(e,{onSuccess:function(){(null===n||void 0===n?void 0:n.onSuccess)&&n.onSuccess(void 0)},onError:function(e){(null===n||void 0===n?void 0:n.onError)&&n.onError(e)}})}}]}},21232:function(e,n,i){i.d(n,{r:function(){return a}});var r=i(29439),o=i(67873),l=i(4519),t=function(e,n){var i=(0,o.Z)(e,{defaultValue:n}),t=(0,r.Z)(i,2),a=t[0],u=t[1],s="useLocalStorageGlobalState:"+e;return(0,l.useEffect)((function(){var e=function(e){u(e.detail)};return document.addEventListener(s,e),function(){return document.removeEventListener(s,e)}}),[u,s]),[a,function(e){document.dispatchEvent(new CustomEvent(s,{detail:e}))}]},a=function(){var e=t("backendaiwebui.settings.themeMode","system"),n=(0,r.Z)(e,2),i=n[0],o=n[1],a=t("backendaiwebui.settings.isDarkMode",window.matchMedia("(prefers-color-scheme: dark)").matches),u=(0,r.Z)(a,2),s=(u[0],u[1]);return(0,l.useEffect)((function(){if("system"===i){var e=window.matchMedia("(prefers-color-scheme: dark)");s(e.matches);var n=function(e){s(e.matches)};return e.addEventListener("change",n),function(){return e.removeEventListener("change",n)}}s("dark"===i)}),[i,s]),{themeMode:i,isDarkMode:!1,setThemeMode:function(e){o(e)}}}}}]);
//# sourceMappingURL=262.04b634e0.chunk.js.map