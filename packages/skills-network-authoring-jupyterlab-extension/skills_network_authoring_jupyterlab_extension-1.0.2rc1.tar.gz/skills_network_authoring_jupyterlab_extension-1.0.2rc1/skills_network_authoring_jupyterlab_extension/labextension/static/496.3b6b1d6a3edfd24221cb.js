"use strict";(self.webpackChunkskills_network_authoring_jupyterlab_extension=self.webpackChunkskills_network_authoring_jupyterlab_extension||[]).push([[496],{904:(e,t,o)=>{o.a(e,(async(e,n)=>{try{o.d(t,{CS:()=>l,CY:()=>i,Gq:()=>w,Mh:()=>c,U5:()=>d,Y$:()=>u,o7:()=>s,sd:()=>h,xy:()=>r});var a=o(852);const e=e=>{let t=e.baseUrl;return t.endsWith("/")||(t+="/"),t},i=await(async()=>{const t=window.location.href,o=new URL(t).searchParams.get("atlas_base_url");if(console.log(`ATLAS BASE URL from current url ${o}`),null===o){console.log("ATLAS_BASE_URL not found in URL parameters, making server request...");const t={method:"GET"},o=a.ServerConnection.makeSettings(),n=e(o)+"skills_network_authoring_jupyterlab_extension/config",i=await a.ServerConnection.makeRequest(n,t,o);return(await i.json()).ATLAS_BASE_URL}return decodeURIComponent(o)})(),r=await(async()=>{const t=window.location.href,o=new URL(t).searchParams.get("awb_base_url");if(console.log(`AWB BASE URL from current url ${o}`),null===o){const t={method:"GET"},o=a.ServerConnection.makeSettings(),n=e(o)+"skills_network_authoring_jupyterlab_extension/config",i=await a.ServerConnection.makeRequest(n,t,o);return(await i.json()).AWB_BASE_URL}return decodeURIComponent(o)})(),l=await(async()=>{const t=window.location.href,o=new URL(t).searchParams.get("sn_file_library_url");if(null===o){const t={method:"GET"},o=a.ServerConnection.makeSettings(),n=e(o)+"skills_network_authoring_jupyterlab_extension/config",i=await a.ServerConnection.makeRequest(n,t,o);return(await i.json()).SN_V2_FILE_LIBRARY_URL}return decodeURIComponent(o)})(),s=await(async()=>{const t=window.location.href,o=new URL(t).searchParams.get("sn_file_library_url");if(null===o){const t={method:"GET"},o=a.ServerConnection.makeSettings(),n=e(o)+"skills_network_authoring_jupyterlab_extension/config",i=await a.ServerConnection.makeRequest(n,t,o);return(await i.json()).SN_FILE_LIBRARY_URL}return decodeURIComponent(o)})(),c=async()=>{const e=window.location.href,t=new URL(e).searchParams.get("mode");return"learn"===t?t:"author"},d=async()=>{const e=window.location.href,t=new URL(e).searchParams.get("atlas_token");return null!==t?t:"NO_TOKEN"},u=async()=>{const e=window.location.href,t=new URL(e).searchParams.get("awb_token");return null!==t?t:"NO_TOKEN"},h=async()=>{const e=window.location.href;let t=new URL(e).searchParams.get("env_type");return"jupyterlab"!==t&&"jupyterlite"!==t&&(t="local"),console.log("Env type: ",t),"jupyterlab"===t||"local"===t?(w.PY_KERNEL_NAME=await b(),w.DEFAULT_LAB_NAME="lab.ipynb"):"jupyterlite"===t&&(w.PY_KERNEL_NAME="python",w.DEFAULT_LAB_NAME="lab.jupyterlite.ipynb"),t},b=async()=>{const e=await(await a.KernelSpecAPI.getSpecs()).kernelspecs,t=Object.keys(e).filter((function(e){return e.includes("python")})).sort();return t[t.length-1]};class w{}w.TOKENS=new Map,w.SHOW_PUBLISH_BUTTON_FOR=void 0,w.PREV_PUB_HASH="prev_pub_hash",w.BACKUP_EXT=".backup",n()}catch(e){n(e)}}),1)},780:(e,t,o)=>{o.d(t,{E3:()=>r,KQ:()=>d,Sc:()=>l,WA:()=>s,Zm:()=>u,g3:()=>c});var n=o(760),a=o(52);class i extends n.Widget{constructor(){const e=document.createElement("div"),t=new a.Spinner;e.appendChild(t.node),e.style.padding="15px",super({node:e})}}const r=e=>{const t=new i;(0,a.showDialog)({title:e,body:t,buttons:[a.Dialog.cancelButton()]}).then((e=>{"Cancel"===e.button.label&&console.log("Spinner dialog cancelled by user")}))},l=e=>{const t=new i;return(0,a.showDialog)({title:e,body:t,buttons:[]}).then((e=>e))},s=e=>(0,a.showDialog)({title:e,body:"Are you sure you want to publish? This action is not reversible",buttons:[a.Dialog.okButton(),a.Dialog.cancelButton()]}).then((e=>{if(!e.button.accept)throw new Error("Operation cancelled by the user.")})),c=()=>{(0,a.showDialog)({title:"Success!",body:"This lab has been successfully published!",buttons:[a.Dialog.okButton()]}).catch((e=>{console.error("Error closing success dialog:",e)}))},d=()=>{(0,a.showDialog)({title:"Failed to Publish",body:"This lab failed to publish.",buttons:[a.Dialog.okButton()]}).catch((e=>{console.log("Error closing failure dialog:",e)}))},u=()=>{(0,a.showDialog)({title:"Failed to Load Lab",body:"This lab failed to load.",buttons:[a.Dialog.okButton()]}).catch((e=>{console.log("Error closing failure to load lab dialog:",e)}))}},480:(e,t,o)=>{o.a(e,(async(e,n)=>{try{o.d(t,{CU:()=>p,E$:()=>_,I7:()=>m,Yj:()=>y,aK:()=>g,m:()=>f});var a=o(637),i=o.n(a),r=o(780),l=o(52),s=o(904),c=o(96),d=o(119),u=o.n(d),h=o(416),b=o.n(h),w=e([s,c]);[s,c]=w.then?(await w)():w;const g=e=>u().create({baseURL:s.CY,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*",Accept:"application/json"}}),p=e=>u().create({baseURL:s.xy,headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json","Access-Control-Allow-Origin":"*",Accept:"application/json"}}),y=async(e,t)=>{try{const o=b()(t),n=o.version_id,a=o.lab_id;console.log(`Fetching lab model for lab_id: ${a}, version_id: ${n}`);const i=`${o.lab_name}.ipynb`,r=await e.get(`api/v1/labs/${a}/lab_versions/${n}/download`).then((e=>(console.log("Lab model fetched successfully"),e.data)));return l.Dialog.flush(),{labFilename:i,body:r}}catch(e){throw"Failed to fetch notebook"}},m=async(e,t,o,n)=>{if(!await(0,r.WA)("Publishing your lab onto Skills Network...").then((e=>!0)).catch((e=>!1)))return;(0,r.Sc)("Publishing your changes...");const a=b()(n),s=a.version_id,d=a.lab_id;await(0,c.ol)(t,o);const u=await(0,c.gv)(t,o),h=new(i());return h.append("publish","true"),h.append("draft[changelog]","updated notebook"),h.append("file",u),console.log(`Posting lab model to AWB for lab_id: ${d}, version_id: ${s}`),new Promise((async(t,o)=>{await e.post(`api/v1/labs/${d}/lab_versions/${s}/drafts`,h).then((e=>{console.log(`Successfully Pushed Lab Version for lab id: ${d}, ver: ${s}`,e),l.Dialog.flush(),(0,r.g3)(),t()})).catch((e=>{l.Dialog.flush(),(0,r.KQ)(),o(new Error("Failed to post lab model"))}))}))},f=e=>e.get("v1/labs").then((e=>(l.Dialog.flush(),e.data))).catch((e=>{throw"Failed to fetch notebook"})),_=async(e,t,o)=>{if(!await(0,r.WA)("Publishing your lab onto Skills Network...").then((e=>!0)).catch((e=>!1)))return;(0,r.Sc)("Publishing your changes..."),console.log("Updating lab commit ID"),await(0,c.ol)(t,o);const n=await(0,c.gv)(t,o);return console.log("Posting lab model to ATLAS"),new Promise((async(t,o)=>{await e.post("v1/labs",{body:n}).then((e=>{l.Dialog.flush(),(0,r.g3)(),t()})).catch((e=>{l.Dialog.flush(),(0,r.KQ)(),o(new Error("Failed to post lab model to ATLAS"))}))}))};n()}catch(e){n(e)}}))},496:(e,t,o)=>{o.a(e,(async(e,n)=>{try{o.r(t),o.d(t,{default:()=>s});var a=o(964),i=o(808),r=e([a,i]);[a,i]=r.then?(await r)():r,console.log("Initializing JupyterFrontEnd plugins for the extension.");const l=[a.c,i.c];console.log("JupyterFrontEnd plugins defined:",l.map((e=>e.id)));const s=l;n()}catch(e){n(e)}}))},964:(e,t,o)=>{o.a(e,(async(e,n)=>{try{o.d(t,{c:()=>g});var a=o(500),i=o(760),r=o(52),l=o(688),s=o(24),c=o(780),d=o(904),u=o(96),h=o(416),b=o.n(h),w=e([d,u]);[d,u]=w.then?(await w)():w;const g={id:"skills_network_authoring_jupyterlab_extension:menu",autoStart:!0,requires:[a.IMainMenu,r.ICommandPalette,l.INotebookTracker,s.IDocumentManager],activate:async(e,t,o,n,a)=>{if(console.log("skills_network_authoring_jupyterlab_extension:menu extension activated"),"learn"===await(0,d.Mh)())return;const{commands:r}=e,l="mainMenu:editLabFromToken";r.addCommand(l,{label:"Edit a Lab",execute:t=>{p(0,a,e.serviceManager.contents)}}),o.addItem({command:l,category:"skillsNetwork",args:{origin:"from the palette"}});const s=new i.Menu({commands:r});s.title.label="Skills Network",t.addMenu(s,!0,{rank:80}),s.addItem({command:l,args:{}})}};function p(e,t,o){const n=document.createElement("div"),a=document.createElement("label");a.textContent="Enter your authorization token";const l=document.createElement("input");l.className="jp-mod-styled",n.appendChild(a),n.appendChild(l),(0,r.showDialog)({title:"Edit a Lab",body:new i.Widget({node:n}),buttons:[r.Dialog.cancelButton(),r.Dialog.okButton()]}).then((async e=>{if(e.button.accept){console.log("Token dialog accepted, loading lab..."),(0,c.E3)("Loading up your lab...");const e=l.value;"version_id"in b()(e)?(console.log("Token contains version_id, opening independent lab..."),await(0,u.op)(e,t,o)):(console.log("Token does not contain version_id, opening lab..."),await(0,u.UJ)(e,t,o))}})).catch((e=>{r.Dialog.flush(),(0,c.Zm)(),console.error("Error occurred while importing lab:",e)}))}n()}catch(y){n(y)}}))},864:(e,t,o)=>{o.a(e,(async(e,n)=>{try{o.d(t,{q:()=>c});var a=o(904),i=o(416),r=o.n(i),l=e([a]);a=(l.then?(await l)():l)[0];var s;class c{constructor(e){s.set(this,void 0),function(e,t,o,n,a){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!a)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?a.call(e,o):a?a.value=o:t.set(e,o)}(this,s,e,"f")}launch(){const e=a.Gq.TOKENS.get(function(e,t,o,n){if("a"===o&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===o?n:"a"===o?n.call(e):n?n.value:t.get(e)}(this,s,"f").split("/").pop()||""),t=e?r()(e):{},o=document.createElement("a");o.href="project_id"in t?`${a.o7}?atlas_token=${e}`:`${a.CS}?lab_version_id=${t.version_id}`,o.target="_blank",document.body.appendChild(o),o.click(),document.body.removeChild(o)}}s=new WeakMap,n()}catch(e){n(e)}}))},808:(e,t,o)=>{o.a(e,(async(e,n)=>{try{o.d(t,{c:()=>_});var a=o(24),i=o(52),r=o(96),l=o(508),s=o(480),c=o(780),d=o(904),u=o(416),h=o.n(u),b=o(688),w=o(864),g=e([d,s,r,w]);[d,s,r,w]=g.then?(await g)():g;const p={id:"skills_network_authoring_jupyterlab_extension:toolbar",description:"Toolbar plugin for Skills Network Authoring Extension",autoStart:!0,requires:[b.INotebookTracker,a.IDocumentManager],activate:f};async function y(e){e.forEach((e=>{e.dispose()}))}class m{createNew(e,t){if(d.Gq.SHOW_PUBLISH_BUTTON_FOR!==t.path)return new l.DisposableDelegate((()=>{}));{const o=async()=>{const o=t.path.split("/").pop()||"",n=d.Gq.TOKENS.get(o);if(void 0===n)return console.log(`[ButtonExtension] No token found for filename: ${o}`),void await(0,i.showDialog)({title:"Publishing Restricted",body:`Only the lab '${d.Gq.TOKENS.keys().next().value}' can be published during this editing session.`,buttons:[i.Dialog.okButton({label:"Dismiss"})]});"version_id"in h()(n)?await(0,s.I7)((0,s.CU)(n),e,t,n):await(0,s.E$)((0,s.aK)(n),e,t)},n=async()=>{const o=await(0,r.gv)(e,t),n=new Blob([o],{type:"application/x-ipynb+json"}),a=URL.createObjectURL(n),i=document.createElement("a");i.setAttribute("download",t.path),i.setAttribute("href",a),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a)},a=new i.ToolbarButton({className:"download-lab-button",label:"Download Notebook",onClick:n,tooltip:"Download the current notebook ipynb file to your local system"}),c=new i.ToolbarButton({className:"publish-lab-button",label:"Publish on SN",onClick:o,tooltip:"Publish Lab"}),u=new i.ToolbarButton({className:"sn-file-library-button",label:"SN File Library",onClick:()=>new w.q(t.path).launch(),tooltip:"Skills Network File Library"});return e.toolbar.insertItem(8,"download",a),e.toolbar.insertItem(9,"sn-file-library",u),e.toolbar.insertItem(10,"publish",c),new l.DisposableDelegate((()=>{a.dispose(),c.dispose(),u.dispose()}))}}}async function f(e,t,o){if(console.log("Activating skills_network_authoring_jupyterlab_extension button plugin!"),"learn"===await(0,d.Mh)())return;const n=await(0,d.U5)(),a=await(0,d.Y$)(),l=await(0,d.sd)();console.log("Using default kernel: ",d.Gq.PY_KERNEL_NAME),console.log("skills_network_authoring_jupyterlab_extension:toolbar extension activated"),e.docRegistry.addWidgetExtension("Notebook",new m),await e.serviceManager.ready,e.restored.then((async()=>{if(await y(t),"NO_TOKEN"!==n&&"local"!==l)try{await(0,r.UJ)(n,o,e.serviceManager.contents)}catch(e){console.error("Error opening lab with Atlas token:",e),i.Dialog.flush(),(0,c.Zm)()}else if("NO_TOKEN"!==a&&"local"!==l)try{await(0,r.op)(a,o,e.serviceManager.contents)}catch(e){console.error("Error opening lab with AWB token:",e),i.Dialog.flush(),(0,c.Zm)()}}))}const _=p;n()}catch(k){n(k)}}))},96:(e,t,o)=>{o.a(e,(async(e,n)=>{try{o.d(t,{UJ:()=>p,gv:()=>d,ol:()=>u,op:()=>g});var a=o(52),i=o(904),r=o(480),l=e([i,r]);[i,r]=l.then?(await l)():l;const s=e=>{const t=e.model.toJSON().source,o="string"==typeof t?[t]:t;return{cell_type:e.model.type,id:e.model.id,metadata:{},outputs:[],source:o}},c=e=>{const t=e.model.toJSON().source,o="string"==typeof t?[t]:t;return{cell_type:e.model.type,id:"",metadata:{},outputs:[],source:o}},d=(e,t)=>{const o=[];e.content.widgets.forEach((e=>{const t=s(e);o.push(t)}));const n={kernelspec:t.model.getMetadata("kernelspec"),language_info:t.model.getMetadata("language_info"),orig_nbformat:t.model.getMetadata("orig_nbformat"),[i.Gq.PREV_PUB_HASH]:t.model.getMetadata(i.Gq.PREV_PUB_HASH)},a=t.model.nbformat,r=t.model.nbformatMinor,l={cells:o,metadata:n,nbformat:a,nbformat_minor:r};return JSON.stringify(l,null,2)};async function u(e,t){const o=await w(e,t),n=await A(o);await t.ready,t.model.setMetadata(i.Gq.PREV_PUB_HASH,n),t.save().then((()=>{console.log("Notebook saved with updated commit ID.")})).catch((e=>{console.error("Failed to save notebook with updated commit ID:",e)}))}function h(e){var t,o,n,a,r,l,s;return"string"==typeof e&&(e=JSON.parse(e)),"object"!=typeof e||null===e||!("metadata"in e)&&!("content"in e)?(console.error("Lab content is of unknown type: ",typeof e,"\n Value: \n",e),""):null!==(s=null!==(n=null===(o=null===(t=e.metadata)||void 0===t?void 0:t[i.Gq.PREV_PUB_HASH])||void 0===o?void 0:o.toString())&&void 0!==n?n:null===(l=null===(r=null===(a=e.content)||void 0===a?void 0:a.metadata)||void 0===r?void 0:r[i.Gq.PREV_PUB_HASH])||void 0===l?void 0:l.toString())&&void 0!==s?s:""}function b(e){var t;if("string"==typeof e)try{e=JSON.parse(e)}catch(e){return console.error("Error parsing lab content string:",e),!1}if("object"!=typeof e||null===e||!("cells"in e)&&(!e.content||!("cells"in e.content)))return console.error("Lab content is of unknown type or missing 'cells': ",typeof e,"\n Value: \n",e),!1;const o=e.cells||(null===(t=e.content)||void 0===t?void 0:t.cells);return 0===o.length||1===o.length&&0===o[0].source.length}const w=(e,t)=>{const o=[];return e.content.widgets.forEach((e=>{const t=c(e);o.push(t)})),JSON.stringify(o,null,2)},g=async(e,t,o)=>{const{labFilename:n,body:a}=await(0,r.Yj)((0,r.CU)(e),e);let l;if(await m(n,o,t),await y(n,a,o,t),i.Gq.SHOW_PUBLISH_BUTTON_FOR=n,i.Gq.TOKENS.set(n,e),await k(`./${n}`,o))l=t.openOrReveal(n);else{if(l=t.createNew(n,"notebook",{name:i.Gq.PY_KERNEL_NAME}),void 0===l)throw Error("Error loading lab");await f(l,a)}return l},p=async(e,t,o)=>{const{instructions_file_path:n,body:a}=await(0,r.m)((0,r.aK)(e)),l=_(n);let s;if(await m(l,o,t),await y(l,a,o,t),i.Gq.SHOW_PUBLISH_BUTTON_FOR=l,i.Gq.TOKENS.set(l,e),await k(`./${l}`,o))s=t.openOrReveal(l);else{if(s=t.createNew(l,"notebook",{name:i.Gq.PY_KERNEL_NAME}),void 0===s)throw Error("Error loading lab");await f(s,JSON.parse(a))}return s};async function y(e,t,o,n){const r=`./${e}`,l=await k(r,o);if(l&&h(t)!==h(l))try{await S(l,o,n),await(0,a.showDialog)({title:"Your Lab was Updated",body:`The newest published version of "${e}" is loaded. Your previous version has been backed up under "${e}${i.Gq.BACKUP_EXT}.ipynb"`,buttons:[a.Dialog.okButton({label:"Dismiss"})]})}catch(t){console.error("[checkAndBackupSaveFile] Error during file backup",t),await(0,a.showDialog)({title:"Error with Previous File",body:`While trying to load your lab: "${e}", we found that you have another file named "${e}" that already exists in this folder, please delete it or rename it so we can load your published version"`,buttons:[a.Dialog.okButton({label:"Dismiss"})]})}}async function m(e,t,o){const n=`./${e}`,a=await k(n,t);a&&(await E(n,o),b(a)&&await t.delete(n))}const f=async(e,t,o)=>{if(await e.context.ready,"local"!==o){e.context.model.fromJSON(t);try{await e.context.save()}catch(e){console.error("[loadLabContents] Error saving notebook:",e)}}else console.error("[loadLabContents] Notebook model is not initialized or authoring environment is local.")},_=e=>(null!=e?e:i.Gq.DEFAULT_LAB_NAME).replace(/^.*[\\/]/,"");async function k(e,t){try{return await t.get(e)}catch(e){if(e instanceof Error){const t=e;if(t.response&&404!==t.response.status)throw console.error("Error checking for existent backup file: ",e),e;return null}throw console.error("[getFile] Unexpected error type:",e),e}}async function v(e,t){const o=t.findWidget(e);if(o)try{o.context.model.dirty&&await o.context.save(),o.close()}catch(e){console.error("[saveAndCloseOpenFiles] Error saving or closing widget:",e)}}async function E(e,t){const o=t.findWidget(e);if(o)try{const e=t.contextForWidget(o);e&&e.model&&(e.model.dirty=!1),o.close()}catch(e){console.error("[closeWithoutSaving] Error closing widget:",e)}}async function S(e,t,o){const n=e.path,a=n.split(".").pop(),r=`${n.replace(/\.[^/.]+$/,"")}${i.Gq.BACKUP_EXT}.${a}`;if(await k(r,t))try{await t.delete(r)}catch(e){console.error("[convertFileToBackup] Error deleting existing backup file:",e)}try{await v(n,o),await t.rename(n,r)}catch(e){console.error("[convertFileToBackup] Error renaming file to backup:",e)}}async function A(e){const t=(new TextEncoder).encode(e),o=await crypto.subtle.digest("SHA-256",t);return Array.from(new Uint8Array(o)).map((e=>e.toString(16).padStart(2,"0"))).join("")}n()}catch(N){n(N)}}))}}]);