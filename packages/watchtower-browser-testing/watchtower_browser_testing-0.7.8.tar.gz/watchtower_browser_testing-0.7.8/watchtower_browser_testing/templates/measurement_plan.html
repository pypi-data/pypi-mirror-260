<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Mono&family=Open+Sans&display=swap" rel="stylesheet">

<style>
body {
  font-family: 'Open Sans', sans-serif;
  font-size: 0.9rem;
}

pre code {
    font-family: 'DM Mono', monospace;
    display: block;
    background-color: #f3f3f3;
    white-space: pre;
    max-width: 100%;
    min-width: 100px;
    padding: 20px;
    border-radius: 5px;
    padding: 20px;
}

.test {
    margin-top: 2rem;
    border-top: 1px solid gray;
    padding-top: 1rem;
}

.alert_exclamation {
    vertical-align: text-bottom;
    margin-right: 0.5rem;
}

.message_check {
    vertical-align: text-bottom;
    margin-right: 0.5rem;
}

.scenario {
    margin-bottom: 2rem;
}

.validation {
    margin-bottom: 1rem;
}

.event {
    margin-left: 1rem;
}
</style>
</head>
<body>
    <div class="container">
        <div class="{{ content.type }}" id="container_{{ content.id }}" >
            {% if test_results %}
            {% if test_results.n_errors %}
                <div class="alert alert-danger" role="alert" style="margin-top:1rem;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="1.2rem" height="1.2rem" fill="currentColor" class="bi bi-exclamation-triangle alert_exclamation" viewBox="0 0 16 16">
                        <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>
                        <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995z"/>
                    </svg>
                    A test job with id {{ test_results.job_id }} ran from {{ test_results.starttime }} until {{ test_results.endtime }} and there were <strong>{{ test_results.n_errors }} errors</strong> in total.
                </div>
            {% else %}
                <div class="alert alert-success" role="alert" style="margin-top:1rem;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="1.2rem" height="1.2rem" fill="currentColor" class="bi bi-check-circle message_check" viewBox="0 0 16 16">
                        <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                        <path d="M10.97 4.97a.235.235 0 0 0-.02.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-1.071-1.05z"/>
                    </svg>
                    A test job with id {{ test_results.job_id }} ran from {{ test_results.starttime }} until {{ test_results.endtime }} and there were <strong>no errors</strong>.
                </div>
            {% endif %}
            {% endif %}
            {{ content.description }}
            {% for test in content.children %}
                {% if test_results %}
                {% set test_result = test_results.results[test.name] %}
                {% endif %}
                <div class="{{ test.type }}" id="container_{{ test.id }}">
                    {{ test.description }}
                    {% for scenario in test.children %}
                        {% if test_results %}
                        {% set scenario_result = test_result[scenario.name] %}
                        {% endif %}
                        <div class="{{ scenario.type }}" id="container_{{ scenario.id }}">
                            {{ scenario.description }}
                            {% if scenario.children %}
                                {% for validation_group in scenario.children %}
                                    {% if test_results %}
                                    {% set valgroup_result = scenario_result[validation_group.name] %}
                                    {% endif %}
                                    <div class="{{ validation_group.type }}" id="container_{{ validation_group.id }}">
                                    {{ validation_group.description }}
                                    {% for event in validation_group.children %}
                                        {% if test_results %}
                                        {% set event_results = valgroup_result[event.name] %}
                                        {% endif %}
                                        <div class="{{ event.type }}" id="container_{{ event.id }}">
                                            {{ event.description }}
                                            {% if test_results %}
                                                {% set all_ok=True %}
                                                {% for event_result in event_results %}
                                                    {% if not event_result.ok %}
                                                    {% set all_ok=False %}
                                                    <div class="alert alert-danger" role="alert" style="margin-top:1rem;">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="1.2rem" height="1.2rem" fill="currentColor" class="bi bi-exclamation-triangle alert_exclamation" viewBox="0 0 16 16" style="float:left;">
                                                            <path d="M7.938 2.016A.13.13 0 0 1 8.002 2a.13.13 0 0 1 .063.016.146.146 0 0 1 .054.057l6.857 11.667c.036.06.035.124.002.183a.163.163 0 0 1-.054.06.116.116 0 0 1-.066.017H1.146a.115.115 0 0 1-.066-.017.163.163 0 0 1-.054-.06.176.176 0 0 1 .002-.183L7.884 2.073a.147.147 0 0 1 .054-.057zm1.044-.45a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566z"/>
                                                            <path d="M7.002 12a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 5.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995z"/>
                                                        </svg>
                                                        <details>
                                                        <summary style="list-style: none">Test failed for browser <strong>{{ event_result.browser }}</strong></summary>
                                                        {% for error in event_result.errors %}
                                                        <pre>{{ error|pretty_json|safe }}</pre>
                                                        {% endfor %}
                                                        {% if event_result.requests.matched %}
                                                            <details>
                                                            <summary style="list-style: none">Click for matched requests</summary>
                                                            <ul>
                                                                {% for r in event_result.requests.matched %}
                                                                <li>
                                                                    {{r.method}}  {{r.url}}<br>
                                                                    @ {{r.frame_url}}
                                                                    {% if r.body %}
                                                                    <details>
                                                                        <summary style="list-style: none; font-style:italic;">click for request body</summary>
                                                                        <pre style="margin-left:1rem;">{{ r.body|pretty_json|safe }}  </pre>                                         
                                                                    </details>
                                                                    {% endif %}
                                                                </li>
                                                                {% endfor %}
                                                            </ul>                                                       
                                                            </details>
                                                        {% endif %}
                                                        {% if event_result.requests.unmatched %}
                                                            <details>
                                                            <summary style="list-style: none">Click for unmatched requests</summary>
                                                            <ul>
                                                                {% for r in event_result.requests.unmatched %}
                                                                <li>
                                                                    match failed on: {{r.match_fail}}<br>
                                                                    {{r.method}}  {{r.url}}<br>
                                                                    @ {{r.frame_url}}
                                                                    {% if r.body %}
                                                                    <details>
                                                                        <summary style="list-style: none; font-style:italic;">click for request body</summary>
                                                                        <pre style="margin-left:1rem;">{{ r.body|pretty_json|safe }}  </pre>                                         
                                                                    </details>
                                                                    {% endif %}
                                                                </li>
                                                                {% endfor %}
                                                            </ul>                                                       
                                                            </details>
                                                        {% endif %}
                                                        </details>
                                                    </div>
                                                    {% endif %}
                                                    {% if all_ok %}
                                                    <div class="alert alert-success" role="alert" style="margin-top:1rem;">
                                                        <svg xmlns="http://www.w3.org/2000/svg" width="1.2rem" height="1.2rem" fill="currentColor" class="bi bi-check2-circle" viewBox="0 0 16 16" style="float:left;">
                                                            <path d="M2.5 8a5.5 5.5 0 0 1 8.25-4.764.5.5 0 0 0 .5-.866A6.5 6.5 0 1 0 14.5 8a.5.5 0 0 0-1 0 5.5 5.5 0 1 1-11 0"/>
                                                            <path d="M15.354 3.354a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0z"/>
                                                        </svg>
                                                        <span style="margin-left:0.3rem;">Test passed</span>
                                                    </div>
                                                    {% endif %}
                                                {% endfor %}
                                            {% endif %}
                                        </div>
                                    {% endfor %}
                                    </div>
                                {% endfor %}
                            {% endif %}
                        </div>
                    {% endfor %}
                </div>
            {% endfor %}
        </div>
    </div>
</body>
</html>