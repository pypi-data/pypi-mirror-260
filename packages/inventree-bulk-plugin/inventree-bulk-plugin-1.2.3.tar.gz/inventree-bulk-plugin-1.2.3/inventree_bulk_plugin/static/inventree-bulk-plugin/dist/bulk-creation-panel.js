var ye,w,qe,z,Ae,ze,ke,Ye,te={},De=[],ft=/acit|ex(?:s|g|n|p|$)|rph|grid|ows|mnc|ntw|ine[ch]|zoo|^ord|itera/i,je=Array.isArray;function q(e,t){for(var n in t)e[n]=t[n];return e}function Qe(e){var t=e.parentNode;t&&t.removeChild(e)}function mt(e,t,n){var r,s,a,i={};for(a in t)a=="key"?r=t[a]:a=="ref"?s=t[a]:i[a]=t[a];if(arguments.length>2&&(i.children=arguments.length>3?ye.call(arguments,2):n),typeof e=="function"&&e.defaultProps!=null)for(a in e.defaultProps)i[a]===void 0&&(i[a]=e.defaultProps[a]);return ue(e,i,r,s,null)}function ue(e,t,n,r,s){var a={type:e,props:t,key:n,ref:r,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:s??++qe,__i:-1,__u:0};return s==null&&w.vnode!=null&&w.vnode(a),a}function ht(){return{current:null}}function V(e){return e.children}function de(e,t){this.props=e,this.context=t}function X(e,t){if(t==null)return e.__?X(e.__,e.__i+1):null;for(var n;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null)return n.__e;return typeof e.type=="function"?X(e):null}function Xe(e){var t,n;if((e=e.__)!=null&&e.__c!=null){for(e.__e=e.__c.base=null,t=0;t<e.__k.length;t++)if((n=e.__k[t])!=null&&n.__e!=null){e.__e=e.__c.base=n.__e;break}return Xe(e)}}function we(e){(!e.__d&&(e.__d=!0)&&z.push(e)&&!fe.__r++||Ae!==w.debounceRendering)&&((Ae=w.debounceRendering)||ze)(fe)}function fe(){var e,t,n,r,s,a,i,u,d;for(z.sort(ke);e=z.shift();)e.__d&&(t=z.length,r=void 0,a=(s=(n=e).__v).__e,u=[],d=[],(i=n.__P)&&((r=q({},s)).__v=s.__v+1,w.vnode&&w.vnode(r),Ne(i,r,s,n.__n,i.ownerSVGElement!==void 0,32&s.__u?[a]:null,u,a??X(s),!!(32&s.__u),d),r.__.__k[r.__i]=r,tt(u,r,d),r.__e!=a&&Xe(r)),z.length>t&&z.sort(ke));fe.__r=0}function Ze(e,t,n,r,s,a,i,u,d,o,b){var c,f,m,y,h,v=r&&r.__k||De,k=t.length;for(n.__d=d,yt(n,t,v),d=n.__d,c=0;c<k;c++)(m=n.__k[c])!=null&&typeof m!="boolean"&&typeof m!="function"&&(f=m.__i===-1?te:v[m.__i]||te,m.__i=c,Ne(e,m,f,s,a,i,u,d,o,b),y=m.__e,m.ref&&f.ref!=m.ref&&(f.ref&&Se(f.ref,null,m),b.push(m.ref,m.__c||y,m)),h==null&&y!=null&&(h=y),65536&m.__u||f.__k===m.__k?d=et(m,d,e):typeof m.type=="function"&&m.__d!==void 0?d=m.__d:y&&(d=y.nextSibling),m.__d=void 0,m.__u&=-196609);n.__d=d,n.__e=h}function yt(e,t,n){var r,s,a,i,u,d=t.length,o=n.length,b=o,c=0;for(e.__k=[],r=0;r<d;r++)(s=e.__k[r]=(s=t[r])==null||typeof s=="boolean"||typeof s=="function"?null:typeof s=="string"||typeof s=="number"||typeof s=="bigint"||s.constructor==String?ue(null,s,null,null,s):je(s)?ue(V,{children:s},null,null,null):s.constructor===void 0&&s.__b>0?ue(s.type,s.props,s.key,s.ref?s.ref:null,s.__v):s)!=null?(s.__=e,s.__b=e.__b+1,u=bt(s,n,i=r+c,b),s.__i=u,a=null,u!==-1&&(b--,(a=n[u])&&(a.__u|=131072)),a==null||a.__v===null?(u==-1&&c--,typeof s.type!="function"&&(s.__u|=65536)):u!==i&&(u===i+1?c++:u>i?b>d-i?c+=u-i:c--:c=u<i&&u==i-1?u-i:0,u!==r+c&&(s.__u|=65536))):(a=n[r])&&a.key==null&&a.__e&&(a.__e==e.__d&&(e.__d=X(a)),xe(a,a,!1),n[r]=null,b--);if(b)for(r=0;r<o;r++)(a=n[r])!=null&&!(131072&a.__u)&&(a.__e==e.__d&&(e.__d=X(a)),xe(a,a))}function et(e,t,n){var r,s;if(typeof e.type=="function"){for(r=e.__k,s=0;r&&s<r.length;s++)r[s]&&(r[s].__=e,t=et(r[s],t,n));return t}return e.__e!=t&&(n.insertBefore(e.__e,t||null),t=e.__e),t&&t.nextSibling}function bt(e,t,n,r){var s=e.key,a=e.type,i=n-1,u=n+1,d=t[n];if(d===null||d&&s==d.key&&a===d.type)return n;if(r>(d!=null&&!(131072&d.__u)?1:0))for(;i>=0||u<t.length;){if(i>=0){if((d=t[i])&&!(131072&d.__u)&&s==d.key&&a===d.type)return i;i--}if(u<t.length){if((d=t[u])&&!(131072&d.__u)&&s==d.key&&a===d.type)return u;u++}}return-1}function Le(e,t,n){t[0]==="-"?e.setProperty(t,n??""):e[t]=n==null?"":typeof n!="number"||ft.test(t)?n:n+"px"}function ce(e,t,n,r,s){var a;e:if(t==="style")if(typeof n=="string")e.style.cssText=n;else{if(typeof r=="string"&&(e.style.cssText=r=""),r)for(t in r)n&&t in n||Le(e.style,t,"");if(n)for(t in n)r&&n[t]===r[t]||Le(e.style,t,n[t])}else if(t[0]==="o"&&t[1]==="n")a=t!==(t=t.replace(/(PointerCapture)$|Capture$/,"$1")),t=t.toLowerCase()in e?t.toLowerCase().slice(2):t.slice(2),e.l||(e.l={}),e.l[t+a]=n,n?r?n.u=r.u:(n.u=Date.now(),e.addEventListener(t,a?Fe:Ue,a)):e.removeEventListener(t,a?Fe:Ue,a);else{if(s)t=t.replace(/xlink(H|:h)/,"h").replace(/sName$/,"s");else if(t!=="width"&&t!=="height"&&t!=="href"&&t!=="list"&&t!=="form"&&t!=="tabIndex"&&t!=="download"&&t!=="rowSpan"&&t!=="colSpan"&&t!=="role"&&t in e)try{e[t]=n??"";break e}catch{}typeof n=="function"||(n==null||n===!1&&t[4]!=="-"?e.removeAttribute(t):e.setAttribute(t,n))}}function Ue(e){var t=this.l[e.type+!1];if(e.t){if(e.t<=t.u)return}else e.t=Date.now();return t(w.event?w.event(e):e)}function Fe(e){return this.l[e.type+!0](w.event?w.event(e):e)}function Ne(e,t,n,r,s,a,i,u,d,o){var b,c,f,m,y,h,v,k,_,p,g,T,A,O,G,N=t.type;if(t.constructor!==void 0)return null;128&n.__u&&(d=!!(32&n.__u),a=[u=t.__e=n.__e]),(b=w.__b)&&b(t);e:if(typeof N=="function")try{if(k=t.props,_=(b=N.contextType)&&r[b.__c],p=b?_?_.props.value:b.__:r,n.__c?v=(c=t.__c=n.__c).__=c.__E:("prototype"in N&&N.prototype.render?t.__c=c=new N(k,p):(t.__c=c=new de(k,p),c.constructor=N,c.render=vt),_&&_.sub(c),c.props=k,c.state||(c.state={}),c.context=p,c.__n=r,f=c.__d=!0,c.__h=[],c._sb=[]),c.__s==null&&(c.__s=c.state),N.getDerivedStateFromProps!=null&&(c.__s==c.state&&(c.__s=q({},c.__s)),q(c.__s,N.getDerivedStateFromProps(k,c.__s))),m=c.props,y=c.state,c.__v=t,f)N.getDerivedStateFromProps==null&&c.componentWillMount!=null&&c.componentWillMount(),c.componentDidMount!=null&&c.__h.push(c.componentDidMount);else{if(N.getDerivedStateFromProps==null&&k!==m&&c.componentWillReceiveProps!=null&&c.componentWillReceiveProps(k,p),!c.__e&&(c.shouldComponentUpdate!=null&&c.shouldComponentUpdate(k,c.__s,p)===!1||t.__v===n.__v)){for(t.__v!==n.__v&&(c.props=k,c.state=c.__s,c.__d=!1),t.__e=n.__e,t.__k=n.__k,t.__k.forEach(function(F){F&&(F.__=t)}),g=0;g<c._sb.length;g++)c.__h.push(c._sb[g]);c._sb=[],c.__h.length&&i.push(c);break e}c.componentWillUpdate!=null&&c.componentWillUpdate(k,c.__s,p),c.componentDidUpdate!=null&&c.__h.push(function(){c.componentDidUpdate(m,y,h)})}if(c.context=p,c.props=k,c.__P=e,c.__e=!1,T=w.__r,A=0,"prototype"in N&&N.prototype.render){for(c.state=c.__s,c.__d=!1,T&&T(t),b=c.render(c.props,c.state,c.context),O=0;O<c._sb.length;O++)c.__h.push(c._sb[O]);c._sb=[]}else do c.__d=!1,T&&T(t),b=c.render(c.props,c.state,c.context),c.state=c.__s;while(c.__d&&++A<25);c.state=c.__s,c.getChildContext!=null&&(r=q(q({},r),c.getChildContext())),f||c.getSnapshotBeforeUpdate==null||(h=c.getSnapshotBeforeUpdate(m,y)),Ze(e,je(G=b!=null&&b.type===V&&b.key==null?b.props.children:b)?G:[G],t,n,r,s,a,i,u,d,o),c.base=t.__e,t.__u&=-161,c.__h.length&&i.push(c),v&&(c.__E=c.__=null)}catch(F){t.__v=null,d||a!=null?(t.__e=u,t.__u|=d?160:32,a[a.indexOf(u)]=null):(t.__e=n.__e,t.__k=n.__k),w.__e(F,t,n)}else a==null&&t.__v===n.__v?(t.__k=n.__k,t.__e=n.__e):t.__e=gt(n.__e,t,n,r,s,a,i,d,o);(b=w.diffed)&&b(t)}function tt(e,t,n){t.__d=void 0;for(var r=0;r<n.length;r++)Se(n[r],n[++r],n[++r]);w.__c&&w.__c(t,e),e.some(function(s){try{e=s.__h,s.__h=[],e.some(function(a){a.call(s)})}catch(a){w.__e(a,s.__v)}})}function gt(e,t,n,r,s,a,i,u,d){var o,b,c,f,m,y,h,v=n.props,k=t.props,_=t.type;if(_==="svg"&&(s=!0),a!=null){for(o=0;o<a.length;o++)if((m=a[o])&&"setAttribute"in m==!!_&&(_?m.localName===_:m.nodeType===3)){e=m,a[o]=null;break}}if(e==null){if(_===null)return document.createTextNode(k);e=s?document.createElementNS("http://www.w3.org/2000/svg",_):document.createElement(_,k.is&&k),a=null,u=!1}if(_===null)v===k||u&&e.data===k||(e.data=k);else{if(a=a&&ye.call(e.childNodes),v=n.props||te,!u&&a!=null)for(v={},o=0;o<e.attributes.length;o++)v[(m=e.attributes[o]).name]=m.value;for(o in v)m=v[o],o=="children"||(o=="dangerouslySetInnerHTML"?c=m:o==="key"||o in k||ce(e,o,null,m,s));for(o in k)m=k[o],o=="children"?f=m:o=="dangerouslySetInnerHTML"?b=m:o=="value"?y=m:o=="checked"?h=m:o==="key"||u&&typeof m!="function"||v[o]===m||ce(e,o,m,v[o],s);if(b)u||c&&(b.__html===c.__html||b.__html===e.innerHTML)||(e.innerHTML=b.__html),t.__k=[];else if(c&&(e.innerHTML=""),Ze(e,je(f)?f:[f],t,n,r,s&&_!=="foreignObject",a,i,a?a[0]:n.__k&&X(n,0),u,d),a!=null)for(o=a.length;o--;)a[o]!=null&&Qe(a[o]);u||(o="value",y!==void 0&&(y!==e[o]||_==="progress"&&!y||_==="option"&&y!==v[o])&&ce(e,o,y,v[o],!1),o="checked",h!==void 0&&h!==e[o]&&ce(e,o,h,v[o],!1))}return e}function Se(e,t,n){try{typeof e=="function"?e(t):e.current=t}catch(r){w.__e(r,n)}}function xe(e,t,n){var r,s;if(w.unmount&&w.unmount(e),(r=e.ref)&&(r.current&&r.current!==e.__e||Se(r,null,t)),(r=e.__c)!=null){if(r.componentWillUnmount)try{r.componentWillUnmount()}catch(a){w.__e(a,t)}r.base=r.__P=null,e.__c=void 0}if(r=e.__k)for(s=0;s<r.length;s++)r[s]&&xe(r[s],t,n||typeof e.type!="function");n||e.__e==null||Qe(e.__e),e.__=e.__e=e.__d=void 0}function vt(e,t,n){return this.constructor(e,n)}function $t(e,t,n){var r,s,a,i;w.__&&w.__(e,t),s=(r=typeof n=="function")?null:n&&n.__k||t.__k,a=[],i=[],Ne(t,e=(!r&&n||t).__k=mt(V,null,[e]),s||te,te,t.ownerSVGElement!==void 0,!r&&n?[n]:s?null:t.firstChild?ye.call(t.childNodes):null,a,!r&&n?n:s?s.__e:t.firstChild,r,i),tt(a,e,i)}function nt(e,t){var n={__c:t="__cC"+Ye++,__:e,Consumer:function(r,s){return r.children(s)},Provider:function(r){var s,a;return this.getChildContext||(s=[],(a={})[t]=this,this.getChildContext=function(){return a},this.shouldComponentUpdate=function(i){this.props.value!==i.value&&s.some(function(u){u.__e=!0,we(u)})},this.sub=function(i){s.push(i);var u=i.componentWillUnmount;i.componentWillUnmount=function(){s.splice(s.indexOf(i),1),u&&u.call(i)}}),r.children}};return n.Provider.__=n.Consumer.contextType=n}ye=De.slice,w={__e:function(e,t,n,r){for(var s,a,i;t=t.__;)if((s=t.__c)&&!s.__)try{if((a=s.constructor)&&a.getDerivedStateFromError!=null&&(s.setState(a.getDerivedStateFromError(e)),i=s.__d),s.componentDidCatch!=null&&(s.componentDidCatch(e,r||{}),i=s.__d),i)return s.__E=s}catch(u){e=u}throw e}},qe=0,de.prototype.setState=function(e,t){var n;n=this.__s!=null&&this.__s!==this.state?this.__s:this.__s=q({},this.state),typeof e=="function"&&(e=e(q({},n),this.props)),e&&q(n,e),e!=null&&this.__v&&(t&&this._sb.push(t),we(this))},de.prototype.forceUpdate=function(e){this.__v&&(this.__e=!0,e&&this.__h.push(e),we(this))},de.prototype.render=V,z=[],ze=typeof Promise=="function"?Promise.prototype.then.bind(Promise.resolve()):setTimeout,ke=function(e,t){return e.__v.__b-t.__v.__b},fe.__r=0,Ye=0;var D,S,ve,Be,ne=0,rt=[],_e=[],Ge=w.__b,Ve=w.__r,He=w.diffed,Me=w.__c,Re=w.unmount;function re(e,t){w.__h&&w.__h(S,e,ne||t),ne=0;var n=S.__H||(S.__H={__:[],__h:[]});return e>=n.__.length&&n.__.push({__V:_e}),n.__[e]}function j(e){return ne=1,kt(st,e)}function kt(e,t,n){var r=re(D++,2);if(r.t=e,!r.__c&&(r.__=[n?n(t):st(void 0,t),function(u){var d=r.__N?r.__N[0]:r.__[0],o=r.t(d,u);d!==o&&(r.__N=[o,r.__[1]],r.__c.setState({}))}],r.__c=S,!S.u)){var s=function(u,d,o){if(!r.__c.__H)return!0;var b=r.__c.__H.__.filter(function(f){return f.__c});if(b.every(function(f){return!f.__N}))return!a||a.call(this,u,d,o);var c=!1;return b.forEach(function(f){if(f.__N){var m=f.__[0];f.__=f.__N,f.__N=void 0,m!==f.__[0]&&(c=!0)}}),!(!c&&r.__c.props===u)&&(!a||a.call(this,u,d,o))};S.u=!0;var a=S.shouldComponentUpdate,i=S.componentWillUpdate;S.componentWillUpdate=function(u,d,o){if(this.__e){var b=a;a=void 0,s(u,d,o),a=b}i&&i.call(this,u,d,o)},S.shouldComponentUpdate=s}return r.__N||r.__}function P(e,t){var n=re(D++,3);!w.__s&&ot(n.__H,t)&&(n.__=e,n.i=t,S.__H.__h.push(n))}function Y(e){return ne=5,K(function(){return{current:e}},[])}function K(e,t){var n=re(D++,7);return ot(n.__H,t)?(n.__V=e(),n.i=t,n.__h=e,n.__V):n.__}function x(e,t){return ne=8,K(function(){return e},t)}function lt(e){var t=S.context[e.__c],n=re(D++,9);return n.c=e,t?(n.__==null&&(n.__=!0,t.sub(S)),t.props.value):e.__}function Z(){var e=re(D++,11);if(!e.__){for(var t=S.__v;t!==null&&!t.__m&&t.__!==null;)t=t.__;var n=t.__m||(t.__m=[0,0]);e.__="P"+n[0]+"-"+n[1]++}return e.__}function wt(){for(var e;e=rt.shift();)if(e.__P&&e.__H)try{e.__H.__h.forEach(pe),e.__H.__h.forEach(Te),e.__H.__h=[]}catch(t){e.__H.__h=[],w.__e(t,e.__v)}}w.__b=function(e){S=null,Ge&&Ge(e)},w.__r=function(e){Ve&&Ve(e),D=0;var t=(S=e.__c).__H;t&&(ve===S?(t.__h=[],S.__h=[],t.__.forEach(function(n){n.__N&&(n.__=n.__N),n.__V=_e,n.__N=n.i=void 0})):(t.__h.forEach(pe),t.__h.forEach(Te),t.__h=[],D=0)),ve=S},w.diffed=function(e){He&&He(e);var t=e.__c;t&&t.__H&&(t.__H.__h.length&&(rt.push(t)!==1&&Be===w.requestAnimationFrame||((Be=w.requestAnimationFrame)||xt)(wt)),t.__H.__.forEach(function(n){n.i&&(n.__H=n.i),n.__V!==_e&&(n.__=n.__V),n.i=void 0,n.__V=_e})),ve=S=null},w.__c=function(e,t){t.some(function(n){try{n.__h.forEach(pe),n.__h=n.__h.filter(function(r){return!r.__||Te(r)})}catch(r){t.some(function(s){s.__h&&(s.__h=[])}),t=[],w.__e(r,n.__v)}}),Me&&Me(e,t)},w.unmount=function(e){Re&&Re(e);var t,n=e.__c;n&&n.__H&&(n.__H.__.forEach(function(r){try{pe(r)}catch(s){t=s}}),n.__H=void 0,t&&w.__e(t,n.__v))};var We=typeof requestAnimationFrame=="function";function xt(e){var t,n=function(){clearTimeout(r),We&&cancelAnimationFrame(t),setTimeout(e)},r=setTimeout(n,100);We&&(t=requestAnimationFrame(n))}function pe(e){var t=S,n=e.__c;typeof n=="function"&&(e.__c=void 0,n()),S=t}function Te(e){var t=S;e.__c=e.__(),S=t}function ot(e,t){return!e||e.length!==t.length||t.some(function(n,r){return n!==e[r]})}function st(e,t){return typeof t=="function"?t(e):t}var Tt=0;function l(e,t,n,r,s,a){var i,u,d={};for(u in t)u=="ref"?i=t[u]:d[u]=t[u];var o={type:e,props:d,key:n,ref:i,__k:null,__:null,__b:0,__e:null,__d:void 0,__c:null,constructor:void 0,__v:--Tt,__i:-1,__u:0,__source:s,__self:a};if(typeof e=="function"&&(i=e.defaultProps))for(u in i)d[u]===void 0&&(d[u]=i[u]);return w.vnode&&w.vnode(o),o}const ee=({title:e,children:t,show:n,scrollable:r,onClose:s,actions:a=[],size:i})=>{const u=Y(null),d=Y(null);return P(()=>{d.current=bootstrap.Modal.getOrCreateInstance(u.current,{backdrop:"static"})},[]),P(()=>{n?d.current.show():d.current.hide()},[n]),P(()=>{const o=u==null?void 0:u.current;if(!o)return;const b=()=>s==null?void 0:s();return o.addEventListener("hidden.bs.modal",b),()=>o.removeEventListener("hidden.bs.modal",b)},[s]),P(()=>()=>d.current.hide(),[]),l("div",{class:`modal fade ${i?`modal-${i}`:""}`,tabIndex:-1,ref:u,children:l("div",{class:`modal-dialog ${r?"modal-dialog-scrollable":""}`,children:l("div",{class:"modal-content",style:`${r?"":"max-height: 92vh;"}`,children:[l("div",{class:"modal-header",children:[l("h5",{class:"modal-title",children:e}),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})]}),l("div",{class:"modal-body",children:t}),l("div",{class:"modal-footer",children:[s&&l("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal",children:"Close"}),a.map(({label:o,type:b,onClick:c,disabled:f=!1,loading:m})=>l("button",{type:"button",class:`btn btn-${b}`,onClick:c,disabled:f,children:[m&&l("span",{class:"spinner-border spinner-border-sm me-1",role:"status","aria-hidden":"true"}),o]}))]})]})})})};function Q({text:e,children:t,placement:n="auto"}){const r=Z();return P(()=>{const s=document.getElementById(r);if(!s)return;const a=bootstrap.Tooltip.getOrCreateInstance(s,{placement:n});return()=>{a.dispose()}},[r,n]),e?l("div",{id:r,class:"preact-tooltip","data-bs-title":e,"data-bs-toggle":"tooltip",children:t}):l(V,{children:t})}const B={"_part.part_image":{render:e=>{if(!e.pk&&!e.id)return"";e.image||(e.image=e.pk||e.id);let t="";return e.image?t=/^(?:[a-z+]+:)?\/\//.test(e.image)?e.image:`/media/${e.image}`:t=blankImage(),renderModel({image:t,text:e.image||`Not found: ${e.id}`})},mapFunction:e=>({...e,id:e.image||e.id}),getSingle:(e,t)=>{inventreeGet("/api/part/thumbs/",{},{success:n=>{t(n.find(r=>r.image===e)||{image:"",id:e})}})}}};function M(e){const t=Z(),n=l(V,{children:[e.extraButtons,e.onDelete&&l("button",{class:"btn btn-outline-danger btn-sm",onClick:e.onDelete,children:l("i",{class:"fa fa-trash"})})]});return l("div",{class:"form-group row",children:[l("div",{class:"col-sm-2",children:l(Q,{text:e.tooltip,children:l("label",{for:`input-${t}`,class:"col-form-label col-form-label-sm",children:e.label})})}),(()=>{if(e.type==="text"||e.type==="number"||e.type==="email"||e.type==="float"){const{type:r,...s}=e;return l("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[l("input",{type:r==="float"?"number":r,class:"form-control form-control-sm",id:`input-${t}`,...r==="float"?{step:"any"}:{},...s}),n]})}else{if(e.type==="model")return l(Ct,{extraFormGroup:n,id:t,...e});if(e.type==="checkbox"||e.type==="boolean"){const{type:r,value:s,...a}=e;return l("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[l("label",{class:"input-group-text",style:"flex: 1;",for:`input-${t}`,children:l("input",{type:"checkbox",class:"form-check-input form-check-sm",id:`input-${t}`,checked:s,...a,onInput:i=>{var u;return(u=a.onInput)==null?void 0:u.call(a,{currentTarget:{value:i.currentTarget.checked}})}})}),n]})}else{if(e.type==="textarea")return l("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[l("textarea",{class:"form-control form-control-sm",id:`input-${t}`,...e}),n]});if(e.type==="select")return l("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[l("select",{class:"form-select form-select-sm",id:`input-${t}`,...e,children:Object.entries(e.options).map(([r,s])=>l("option",{value:r,children:s}))}),n]});if(e.type==="array"){const{onDelete:r,onAdd:s}=e,a=i=>!e.onAdd&&e.value.length===i+1;return l("div",{class:"col-sm-10",children:l("div",{class:"d-flex flex-row flex-nowrap",style:"gap: 4px",children:[e.value.map((i,u)=>l("div",{class:"input-group",style:`max-width: 350px; ${a(u)?"margin-right: 31px;":""}`,children:[l("input",{type:"text",class:"form-control form-control-sm",id:`input-${t}-${u}`,value:i,onInput:d=>e.onInput(u)(()=>d.currentTarget.value)}),r&&l("button",{class:"btn btn-outline-danger btn-sm",onClick:r(u),children:l("i",{class:"fa fa-trash"})})]})),s&&l("button",{class:"btn btn-outline-primary btn-sm",onClick:()=>s(),children:"+"})]})})}}}return"Not implemented"})()]})}const Ct=({model:e,extraFormGroup:t,id:n,onInput:r,value:s})=>(P(()=>($(`#${n}`).select2({placeholder:"",allowClear:!0,ajax:{url:e.api_url,dataType:"json",delay:250,cache:!0,data:a=>{var i;return{search:(i=a.term)==null?void 0:i.trim(),offset:a.page?(a.page-1)*25:0,limit:25,...e.limit_choices_to}},processResults:a=>{let i=[],u=!1;"count"in a&&"results"in a?(i=a.results,a.next&&(u=!0)):i=a;let d=i.map(o=>({id:o.pk,...o}));return B[e.model]&&(d=d.map(B[e.model].mapFunction)),{results:d,pagination:{more:u}}}},templateResult:a=>{var d;let i=a;if((d=a.element)!=null&&d.instance&&(i=a.element.instance),B[e.model])return $(B[e.model].render(i));if(!i.pk)return $("<span>Searching...</span>");const u=e.model.toLowerCase().split(".").at(-1);return $(`${renderModelData("",u,i,{})} <span>(${i.pk})</span>`)},templateSelection:a=>{var d;let i=a;if((d=a.element)!=null&&d.instance&&(i=a.element.instance),B[e.model])return $(B[e.model].render(i));if(!i.pk)return"";const u=e.model.toLowerCase().split(".").at(-1);return $(`${renderModelData("",u,i,{})} <span>(${i.pk})</span>`)}}),()=>{$(`#${n}`).select2("destroy")}),[n,e.api_url,e.limit_choices_to,e.model]),P(()=>($(`#${n}`).on("select2:select",a=>{r==null||r(a)}),$(`#${n}`).on("select2:clear",()=>{r==null||r({currentTarget:{value:""}})}),()=>{$(`#${n}`).off("select2:select"),$(`#${n}`).off("select2:clear")}),[n,r]),P(()=>{if(s&&s!==$(`#${n}`).val()){const a=`${e.api_url}/${s}/`.replace("//","/"),i=d=>{B[e.model]&&(d=B[e.model].mapFunction(d));const o=new Option("",d.id??d.pk,!0,!0);o.instance=d,$(`#${n}`).append(o).trigger("change"),$(`#${n}`).trigger({type:"select2:select",params:{data:d}})},u=B[e.model];if(u!=null&&u.getSingle)return u.getSingle(s,i);inventreeGet(a,{...e.limit_choices_to},{success:i})}},[n,e.api_url,e.limit_choices_to,e.model,s]),l("div",{class:"col-sm-10 input-group",style:"flex: 1;",children:[l("select",{class:"form-select form-select-sm",id:n}),t]})),at=nt({showNotification:()=>1}),le=()=>{const{showNotification:e}=lt(at);return{showNotification:e}},Et=({children:e})=>{const[t,n]=j([]),r=Y([]);r.current=t.map((a,i)=>r.current[i]??ht());const s=x(a=>{const i=Math.random().toString(36).substring(2),u={id:i,autoHide:!0,...a};n(d=>[...d,u]),setTimeout(()=>{const d=r.current.length-1,o=r.current[d].current;bootstrap.Toast.getOrCreateInstance(o,{autohide:u.autoHide}).show(),o.addEventListener("hidden.bs.toast",()=>{n(c=>c.filter(f=>f.id!==i))})},0)},[]);return l(at.Provider,{value:{showNotification:s},children:l("div",{children:[e,l("div",{style:"position: fixed; bottom: 6px; right: 6px; display: flex; flex-direction: column; gap: 6px; z-index: 999999;",children:t.map(({id:a,type:i,message:u},d)=>l("div",{role:"alert","aria-live":"assertive","aria-atomic":"true",class:"toast",style:"border-radius: 5px;",ref:r.current[d],children:l("div",{class:`alert alert-${i}`,style:"margin-bottom: 0; padding: 8px; opacity: 0.8;",children:l("div",{style:{display:"flex",justifyContent:"space-between"},children:[l("div",{children:u}),l("button",{type:"button",class:"btn-close","data-bs-dismiss":"toast","aria-label":"Close",style:{fontSize:"10px"}})]})})},a))})]})})},Ce=(e,t)=>{if(e===t)return!0;if(e===null&&t!==null||e!==null&&t===null||typeof e!=typeof t)return!1;if(Array.isArray(e)&&Array.isArray(t))return e.length!==t.length?!1:e.every((n,r)=>Ce(e[r],t[r]));if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(typeof e=="object"){const n=Object.keys(e),r=Object.keys(t);return n.length!==r.length?!1:n.every(s=>Ce(e[s],t[s]))}return!1},Ee=e=>{var n;const t={...e};return t.parent_name_match===""&&delete t.parent_name_match,t.extends===""&&delete t.extends,t.count=e.count.map(r=>r||null),t.childs=(n=e.childs)==null?void 0:n.map(Ee),t},me=e=>({...e,templates:e.templates.map(Ee),output:Ee(e.output)}),Ot=e=>{const t=new Set,n=r=>{var s;for(const a of Object.keys(r.generate))t.add(a);(s=r.childs)==null||s.forEach(a=>n(a))};return n(e.output),e.templates.forEach(r=>n(r)),[...t]};function jt(e=1){return()=>e++}const it=(e,t,n=0,r="...")=>e.flatMap(([s,a])=>{const i=t(),u=`${r}/${s.name}`;return[{...s,id:i,pid:n,path:u},...it(a,t,i,u)]}),$e=e=>e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),Nt=(e,t)=>{const n=document.createElement("a");n.setAttribute("href",`data:text/plain;charset=utf-8,${encodeURIComponent(t)}`),n.setAttribute("download",e),n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n)},R=(e,t)=>fetch(e,{headers:{"Content-Type":"application/json",...t==null?void 0:t.headers},...t}),W={bulkcreate:({parentId:e,create:t,templateType:n}={})=>{const r=new URLSearchParams;e&&r.set("parent_id",e),t&&r.set("create",t?"true":"false"),n&&r.set("template_type",n);const s=r.toString();return`/plugin/inventree-bulk-plugin/bulkcreate${s?`?${s}`:""}`},templates:({id:e,templateType:t}={})=>{const n=new URLSearchParams;t&&n.set("template_type",t);const r=n.toString();return`/plugin/inventree-bulk-plugin/templates${e!=null?`/${e}`:""}${r?`?${r}`:""}`}},Ke=10,ct=({template:e,height:t,parentId:n,bulkGenerateInfo:r})=>{const{showNotification:s}=le(),a=Z(),i=K(()=>`preview-table-${a}`,[a]);return P(()=>{(async()=>{const u=await R(W.bulkcreate({parentId:n,create:!1}),{method:"POST",body:JSON.stringify({...e,template:JSON.stringify(me(e.template))})}),d=await u.json();if(!u.ok)return s({type:"danger",message:`An error occurred, ${d.error}`});const o=it(d,jt());s({type:"success",message:`Successfully parsed. This will generate ${o.length} items.`});const b=Ot(e.template),c=$(`#${i}`),f={},m=(y,h,v)=>{if(h===void 0)return"";if(y.field_type==="model"){const k=p=>{const g=(()=>{var G;if(B[y.model.model]&&(p=B[y.model.model].mapFunction(p)),(G=p.element)!=null&&G.instance&&(p=p.element.instance),B[y.model.model])return B[y.model.model].render(p);const A=N=>{if(!N.pk)return"";const F=y.model.model.toLowerCase().split(".").at(-1);return`${renderModelData("",F,N,{})} <span>(${N.pk})</span>`},O=p.count;if(y.allow_multiple&&p.results&&(p=p.results),y.allow_multiple&&Array.isArray(p)){let N=!1,F="";return O===void 0?(N=O>p.length,F=`${O-p.length} more elements`):p.length>=Ke&&(p.pop(),N=!0,F="at least one more element"),`${`<li>${p.map(A).join("</li><li>")}</li>`}${N?`<li>... ${F}</li>`:""}`}return A(p)})(),T=document.getElementById(v);T&&(T.innerHTML=g,T.classList.remove("placeholder","placeholder-glow","col-4"),c.bootstrapTable("resetView"))},_=B[y.model.model];if(_!=null&&_.getSingle){const p=`~get-single-${h}`;f[p]||(f[p]=[],_.getSingle(h,g=>f[p].forEach(T=>T(g)))),f[p].push(k)}else{let p=`${h}/`,g={...y.model.limit_choices_to};Number.isNaN(parseInt(h,10))&&(p="",g={...JSON.parse(h),...g},"name"in g&&(g.search=g.name));const T=`${y.model.api_url}/${p}?limit=${Ke}`.replace("//","/"),A=`~get-api-${T}-${JSON.stringify(h)}`;f[A]||(f[A]=[],inventreeGet(T,{...g},{success:O=>{f[A].forEach(G=>G(O))}})),f[A].push(k)}return`<span id=${v} class="placeholder placeholder-glow col-4">${h}</span>`}return y.field_type==="select"?$e(y.options[h]??`${h}`):y.field_type==="list"&&Array.isArray(h)?`<ul>${h.map((k,_)=>`<li>${m(y.items_type,k,`${v}-${_}`)}</li>`).join("")}</ul>`:y.field_type==="object"&&typeof h=="object"?`<ul>${Object.entries(h).map(([k,_],p)=>`<li>${$e(y.fields[k].name??k)}: ${m(y.fields[k],_,`${v}-${p}`)}</li>`).join("")}</ul>`:$e(`${h}`)};c.bootstrapTable("destroy"),c.bootstrapTable({data:o,idField:"id",height:t,columns:[...Object.entries(r.fields).filter(([y])=>b.includes(y)).map(([y,h])=>({field:y,title:h.name,formatter:(v,k,_,p)=>m(h,v,`table-${a}-field-${_}-${p}`)})),{field:"path",title:"Path"}],treeShowField:"name",parentIdField:"pid",onPostBody(){const y=c.bootstrapTable("getOptions").columns;y&&y[0][1].visible&&c.treegrid({treeColumn:0,onChange(){c.bootstrapTable("resetView")}})},rowStyle:()=>({css:{padding:"2px 0.5rem"}})})})()},[r.fields,t,a,n,s,i,e]),l("div",{class:"mt-3",children:l("table",{id:i,style:{whiteSpace:"nowrap"}})})},Je=(e,t)=>({...e,template:{...e.template,input:Object.fromEntries(t.map(({key:n,value:r})=>[n,r]))}}),St=({template:e,parentId:t,attachPreviewHandler:n,attachCreateHandler:r,handleDoneCreate:s,setIsBulkCreateLoading:a})=>{const[i,u]=j(),[d,o]=j([]),[b,c]=j(!0),[f,m]=j(),{showNotification:y}=le();P(()=>{!(e!=null&&e.template_type)||!t||(async()=>{const p=await R(W.bulkcreate({parentId:t,templateType:e.template_type}));if(!p.ok)return y({type:"danger",message:`Failed to load bulk generate info,
${p.statusText}`});const g=await p.json();m(g)})()},[t,y,e==null?void 0:e.template_type]),P(()=>{o(Object.entries(e.template.input).map(([p,g])=>({key:p,value:g})))},[e.template.input]);const h=x(p=>g=>{o(T=>T.map(({key:A,value:O})=>({key:A,value:p===A?g.currentTarget.value:O})))},[]),v=x(async()=>{a(!0);const p=Je(e,d),g=await R(W.bulkcreate({parentId:t,create:!0}),{method:"POST",body:JSON.stringify({...p,template:JSON.stringify(me(p.template))})}),T=await g.json();if(a(!1),!g.ok)return s==null||s(!1),y({type:"danger",message:`An error occurred, ${T.error}`});y({type:"success",message:`Successfully bulk created ${T.length} ${f==null?void 0:f.name}s.`}),s==null||s(!0)},[f==null?void 0:f.name,s,d,t,a,y,e]),k=x(()=>{const p=structuredClone(Je(e,d));u(p),c(!1)},[d,e]),_=x(()=>{v()},[v]);return P(()=>n==null?void 0:n(k),[n,k]),P(()=>r==null?void 0:r(_),[r,_]),l("div",{children:[l("h5",{children:"Inputs"}),l("div",{children:d.map(({key:p,value:g})=>l(M,{type:"text",label:p,value:g,onInput:h(p)},p))}),i&&f&&l(V,{children:[l("h5",{children:"Preview"}),l("div",{class:b?"mb-4":"",children:l(ct,{template:i,height:350,parentId:t,bulkGenerateInfo:f})})]})]})},he=e=>e.default?e.default:e.field_type==="list"?[he(e.items_type)]:e.field_type==="object"?Object.fromEntries(Object.entries(e.fields).filter(([,t])=>t.required).map(([t,n])=>[t,he(n)])):e.field_type==="boolean"?!1:e.field_type==="float"||e.field_type==="number"?"0":"",ut=({fieldDefinition:e,field:t,setField:n,onDelete:r})=>e.field_type==="object"?l(dt,{fieldsDefinition:e,fields:t,setFields:n,onDelete:r}):e.field_type==="list"?l(It,{fieldsDefinition:e,fields:t,setFields:n,onDelete:r}):l(Lt,{fieldDefinition:e,field:t,setField:n,onDelete:r}),It=({fieldsDefinition:e,fields:t,setFields:n,onDelete:r})=>{const s=e.items_type,a=x(d=>o=>{n(b=>{const c=[...b];return c[d]=typeof o=="function"?o(c[d]):o,c})},[n]),i=x(()=>{const d=he(s);n(o=>[...o,d])},[s,n]),u=x(d=>()=>{n(o=>o.filter((b,c)=>d!==c))},[n]);return l("div",{class:"mb-1 card",children:l("div",{class:"d-flex justify-content-between",children:[l("div",{className:"col p-2",children:[e.name&&l(Q,{text:e.description||"",children:l("h6",{children:e.name})}),l("div",{class:"ms-3",children:[t.map((d,o)=>l(ut,{fieldDefinition:s,field:d,setField:a(o),onDelete:u(o)})),l("div",{style:{display:"flex",justifyContent:"space-between"},children:l("button",{class:"btn btn-sm btn-outline-primary",onClick:i,children:["Add ",e.name]})})]})]}),r&&l("div",{class:"p-1",children:l("button",{onClick:r,class:"btn btn-sm btn-outline-danger",children:l("i",{class:"fa fa-trash"})})})]})})},dt=({fieldsDefinition:e,fields:t,setFields:n,onDelete:r,showCard:s=!0})=>{const a=e.fields,i=x(f=>m=>n(y=>({...y,[f]:typeof m=="function"?m(y[f]):m})),[n]),u=K(()=>{const f=Object.keys(t);return Object.entries(a).filter(([m])=>!f.includes(m))},[t,a]),[d,o]=j(""),b=x(f=>{if(f!==""){const m=a[f],y=he(m);i(f)(y),o("")}},[a,i]),c=x(f=>()=>{n(m=>{const y={...m};return delete y[f],y})},[n]);return l("div",{class:`${s?"card mb-1":""}`,children:l("div",{class:"d-flex justify-content-between",children:[l("div",{class:`col ${s?"p-2":""}`,children:[e.name&&l(Q,{text:e.description||"",children:l("h6",{children:e.name})}),Object.entries(a).filter(([f])=>t[f]!==void 0).map(([f,m])=>{const y=t[f];return l(ut,{fieldDefinition:m,field:y,setField:i(f),onDelete:m.required?void 0:c(f)},f)}),u.length>0&&l("div",{style:"display: flex; max-width: 200px;",children:l("select",{class:"form-select form-select-sm",value:d,onInput:f=>b(f.currentTarget.value),children:[l("option",{selected:!0,value:"",children:"Add key"}),u.map(([f,{name:m}])=>l("option",{value:f,children:m}))]})})]}),r&&l("div",{class:"p-1",children:l("button",{onClick:r,class:"btn btn-sm btn-outline-danger",children:l("i",{class:"fa fa-trash"})})})]})})},Pt=e=>e.field_type==="boolean"?"Use a template that evaluates to something boolean like (e.g. 'true' or 'false').":e.field_type==="number"?"Use a template that evaluates to something number like (e.g. '10').":e.field_type==="float"?"Use a template that evaluates to something float like (e.g. '3.1415').":e.field_type==="model"?`Use a template that evaluates to a valid id for this model (e.g. '42') or a json string containing django model filters (e.g. {"name": "R_10k_0808_10%"} or {"name__startswith": "R_"}), but be aware that the preview table may not work correctly due to API limitations. Bulk create will work correctly then. ${e.allow_multiple?"The filters can also return multiple objects.":"The filters must return only one object."}`:e.field_type==="select"?`Use a template that evaluates to a valid option from the select field. Available options: ${Object.keys(e.options).join(", ")}`:"",At=(e,t)=>{const n=`${t}`;return e.field_type==="number"?!/^\d*$/.test(n):e.field_type==="float"?!/^[\d\\.,]*$/.test(n):e.field_type==="boolean"?!["true","false",""].includes(n):n.includes("{")||n.includes("}")},Lt=({fieldDefinition:e,field:t,setField:n,onDelete:r})=>{const[s,a]=j(()=>At(e,t)),i=K(()=>e.field_type!=="text",[e.field_type]),u=Z(),d=K(()=>s?"text":e.field_type,[e.field_type,s]);return l(V,{children:l(M,{label:e.name,tooltip:e.description||void 0,type:d,...e.field_type==="model"?{model:e.model}:{},...e.field_type==="select"?{options:e.options}:{},value:t,onInput:o=>n(o.currentTarget.value),onDelete:r,extraButtons:i&&l(V,{children:[l("input",{type:"checkbox",class:"btn-check",id:`btn-check-${u}`,checked:s,onInput:()=>a(o=>!o),autoComplete:"off"}),l("label",{class:"btn btn-sm btn-outline-primary",for:`btn-check-${u}`,style:"display: flex; align-items: center;",children:l(Q,{text:Pt(e),children:l("i",{class:"fas fa-code"})})})]})})})},Ut="1.2.3",Ie={version:Ut,input:{},templates:[],output:{parent_name_match:"true",dimensions:[""],count:[""],generate:{}}};function Oe({childSchema:e,setChildSchema:t,bulkGenerateInfo:n,extendsKeys:r}){var k;P(()=>{Object.keys(e.generate).length===0&&Object.keys(n.fields).length>0&&t(_=>({..._,generate:Object.fromEntries(Object.entries(n.fields).filter(([,{required:p}])=>!!p).map(([p])=>[p,""]))}))},[n.fields,e,t]);const s=x(_=>p=>t(g=>({...g,[_]:p.currentTarget.value})),[t]),a=x(_=>t(p=>({...p,generate:typeof _=="function"?_(p.generate):_})),[t]),i=x(_=>p=>g=>t(T=>(T[_][p]=typeof g=="function"?g(T[_][p]):g,{...T,[_]:T[_]})),[t]),u=x(()=>t(_=>(_.dimensions.push(""),_.count.push(""),{..._,dimensions:_.dimensions,count:_.count})),[t]),d=x(_=>()=>t(p=>({...p,dimensions:p.dimensions.filter((g,T)=>T!==_),count:p.count.filter((g,T)=>T!==_)})),[t]),o=x(_=>p=>t(g=>(g.childs||(g.childs=[]),g.childs[_]=typeof p=="function"?p(g.childs[_]):p,{...g,childs:g.childs})),[t]),b=x(()=>t(_=>(_.childs||(_.childs=[]),_.childs.push(structuredClone(Ie.output)),{..._,childs:_.childs})),[t]),c=x(_=>()=>t(p=>p.childs?{...p,childs:p.childs.filter((g,T)=>T!==_)}:p),[t]),m=`bulk-child-schema-editor-${Z()}`,[y,h]=j(!1),v=x(()=>{h(_=>($(`#${m}`).collapse(_?"hide":"show"),!_))},[m]);return l("div",{class:"",children:[l(M,{label:"Dimensions",tooltip:"A childs naming convention could have multiple dimensions where it is counting in",type:"array",onDelete:d,value:e.dimensions.map(_=>_||""),onInput:i("dimensions"),onAdd:u}),l(M,{label:"Count",tooltip:"Limit the amount of generated items for the individual dimension",type:"array",value:e.count.map(_=>_||""),onInput:i("count")}),l("h6",{class:`user-select-none collapsable-heading ${y?"active":""}`,role:"button",onClick:v,children:"Advanced"}),l("div",{class:"collapse",id:m,children:[n.generate_type==="tree"&&l(V,{children:[l(M,{label:"Parent name match",tooltip:"First child that matches the parent name matcher will be chosen for generating the childs for a specific parent. Must evaluate to something that can be casted to a boolean.",type:"text",value:e.parent_name_match||"",onInput:s("parent_name_match")}),r&&l(M,{label:"Extends",tooltip:"Choose to extend from a template",type:"select",options:r,value:e.extends||"",onInput:s("extends")})]}),l(M,{label:"Global context",tooltip:"This template gets imported under the 'global' namespace to all generate fields. Use this to setup variables via the set keyword ('{% set hello = 'world' %}')which can be accessed as 'global.<x>' ('{{ global.hello }}').",type:"textarea",value:e.global_context||"",onInput:s("global_context")})]}),l("div",{class:"mt-3",children:l(Q,{text:"You can use {{dim.x}} as a placeholder for the generated output of the dimension. For more info see the Readme.",children:l("h5",{children:"Generate"})})}),l(dt,{fieldsDefinition:{name:"",description:null,required:!0,field_type:"object",fields:n.fields},fields:e.generate,setFields:a,showCard:!1}),n.generate_type==="tree"&&l(V,{children:[l("h5",{class:"mt-3",children:"Childs"}),l("div",{class:"ms-3",children:(k=e.childs)==null?void 0:k.map((_,p)=>l("div",{class:"card mb-2",children:l("div",{class:"d-flex justify-content-between",children:[l("div",{class:"col p-3",children:l(Oe,{childSchema:_,setChildSchema:o(p),bulkGenerateInfo:n,extendsKeys:r})}),l("div",{class:"p-1",children:l("button",{onClick:c(p),class:"btn btn-sm btn-outline-danger",children:l("i",{class:"fa fa-trash"})})})]})}))}),l("button",{onClick:b,class:"btn btn-outline-primary btn-sm",children:"Add child"})]})]})}function Ft({schema:e,setSchema:t,bulkGenerateInfo:n}){const r=Y(!0),s=x(h=>t(v=>({...v,output:typeof h=="function"?h(v.output):h})),[t]),[a,i]=j([]),u=x((h,v)=>k=>i(_=>(_[h][v]=k.currentTarget.value,[..._])),[i]),d=x(()=>i(h=>[...h,{key:"",value:""}]),[i]),o=x(h=>()=>i(v=>v.filter((k,_)=>_!==h)),[i]);P(()=>{a.length>0&&t(h=>({...h,input:Object.fromEntries(a.map(({key:v,value:k})=>[v,k]))}))},[a,t]),P(()=>{r.current&&(e!=null&&e.input)&&Object.keys(e.input).length!==0&&(i(Object.entries(e.input).map(([h,v])=>({key:h,value:v}))),r.current=!1)},[e==null?void 0:e.input,a,i]);const b=x(h=>v=>t(k=>(k.templates[h]=typeof v=="function"?v(k.templates[h]):v,{...k,templates:k.templates})),[t]),c=x(()=>t(h=>(h.templates.push({name:"",...structuredClone(Ie.output)}),{...h,templates:h.templates})),[t]),f=x(h=>()=>t(v=>({...v,templates:v.templates.filter((k,_)=>_!==h)})),[t]),m=K(()=>({"":"---",...e?Object.fromEntries(e.templates.filter(h=>h&&h.name).map(h=>[h.name,h.name])):{}}),[e]),y=Z();return l("div",{children:[l("div",{class:"card",children:[l("div",{class:"card-header",children:l("h5",{class:"mb-0 user-select-none",role:"button","data-bs-toggle":"collapse","data-bs-target":`#accordion-${y}-input`,children:"Input"})}),l("div",{id:`accordion-${y}-input`,class:"collapse",children:l("div",{class:"card-body",children:[a.map((h,v)=>l("div",{class:"input-group input-group-sm mb-2",children:[l("span",{class:"input-group-text",children:"Key"}),l("input",{type:"text",value:h.key,onInput:u(v,"key")}),l("span",{class:"input-group-text",children:"Value"}),l("input",{type:"text",style:"flex: 1;",value:h.value,onInput:u(v,"value")}),l("button",{class:"btn btn-outline-danger btn-sm",onClick:o(v),children:l("i",{class:"fa fa-trash"})})]})),l("button",{onClick:d,class:"btn btn-outline-primary btn-sm",children:"Add input"})]})})]}),n.generate_type==="tree"&&l(V,{children:l("div",{class:"card mt-2",children:[l("div",{class:"card-header",children:l("h5",{class:"mb-0 user-select-none",role:"button","data-bs-toggle":"collapse","data-bs-target":`#accordion-${y}-templates`,children:"Templates"})}),l("div",{id:`accordion-${y}-templates`,class:"collapse",children:l("div",{class:"card-body",children:[e.templates.map((h,v)=>l("div",{class:"card mb-2",children:l("div",{class:"d-flex justify-content-between",children:[l("div",{class:"col p-3",children:[h!==null&&l(M,{label:"Template name",type:"text",value:h.name,onInput:k=>b(v)(_=>({..._,name:k.currentTarget.value}))}),l(Oe,{childSchema:h,setChildSchema:b(v),bulkGenerateInfo:n,extendsKeys:m})]}),l("div",{class:"p-1",children:l("button",{onClick:f(v),class:"btn btn-sm btn-outline-danger",children:l("i",{class:"fa fa-trash"})})})]})})),l("button",{onClick:c,class:"btn btn-outline-primary btn-sm",children:"Add template"})]})})]})}),l("div",{class:"card mt-2",children:[l("div",{class:"card-header",children:l("h5",{class:"mb-0 user-select-none",role:"button","data-bs-toggle":"collapse","data-bs-target":`#accordion-${y}-output`,children:"Output"})}),l("div",{id:`accordion-${y}-output`,class:"collapse show",children:l("div",{class:"card-body",children:l(Oe,{childSchema:e.output,setChildSchema:s,bulkGenerateInfo:n,extendsKeys:m})})})]})]})}const _t=nt({bulkGenerateInfoDict:{},reload:async()=>{}}),Bt=()=>{const{bulkGenerateInfoDict:e,reload:t}=lt(_t);return{bulkGenerateInfoDict:e,reload:t}},Gt=({children:e})=>{const[t,n]=j({}),{showNotification:r}=le(),s=x(async()=>{const a=await R(W.bulkcreate());if(!a.ok)return r({type:"danger",message:`Could not load bulk generate info, ${a.statusText}`});const i=Object.fromEntries((await a.json()).map(u=>[u.template_type,u]));n(i)},[r]);return P(()=>{s()},[s]),l(_t.Provider,{value:{bulkGenerateInfoDict:t,reload:s},children:e})},Vt=({templateId:e,handleBack:t,templateType:n,parentId:r,initialTemplate:s})=>{var Pe;const[a,i]=j(null),[u,d]=j(null),[o,b]=j(null),c=K(()=>!Ce(o,a),[o,a]),f=x(E=>L=>b(H=>H?{...H,[E]:L.currentTarget.value}:null),[]),m=x(E=>{b(L=>L===null?L:{...L,template:typeof E=="function"?E(L.template):E})},[]),[y,h]=j(!0),[v,k]=j(!0),[_,p]=j(),{showNotification:g}=le(),{bulkGenerateInfoDict:T}=Bt(),A=K(()=>Object.fromEntries(Object.values(T).map(E=>[E.template_type,E.name])),[T]);P(()=>{!(o!=null&&o.template_type)||!r||(k(!0),(async()=>{const E=await R(W.bulkcreate({parentId:r,templateType:o.template_type}));if(!E.ok)return k(!1),g({type:"danger",message:`Failed to load bulk generate info,
${E.statusText}`});const L=await E.json();p(L),k(!1)})())},[r,g,o==null?void 0:o.template_type]);const O=K(()=>!e&&!(o!=null&&o.id),[o==null?void 0:o.id,e]),G=x(async()=>{h(!0);let E=null;if(s)E=structuredClone(s);else if(e){const L=await R(W.templates({id:e}));if(!L.ok)return h(!1),g({type:"danger",message:`Fetching template failed,
${L.statusText}`});const H=await L.json();E={...H,template:JSON.parse(H.template)}}else E={id:null,name:"",template:structuredClone(Ie),template_type:n||"STOCK_LOCATION"};i(structuredClone(E)),b(structuredClone(E)),h(!1)},[s,g,e,n]);P(()=>{G()},[G]);const N=x(async()=>{if(!o)return!1;const E=await R(W.templates({id:O?null:o.id}),{method:O?"POST":"PUT",body:JSON.stringify({...o,template:JSON.stringify(me(o.template))})}),L=await E.json();return E.ok?(O?(o.id=L.id,b({...o}),g({type:"success",message:"Template successfully created."})):g({type:"success",message:"Template successfully updated."}),i(structuredClone(o)),!0):(g({type:"danger",message:`An error occurred. ${Object.entries(L).map(([H,pt])=>`${H}: ${pt.join(", ")}`).join(", ")}`,autoHide:!1}),!1)},[O,g,o]),F=x(()=>b(structuredClone(a)),[a]),C=x(()=>{d(structuredClone(o))},[o]),[I,U]=j(!1),[J,oe]=j(!1),se=x(async()=>{var H;if(o===null)return;oe(!0);const E=await R(W.bulkcreate({parentId:r,create:!0}),{method:"POST",body:JSON.stringify({...o,template:JSON.stringify(me(o.template))})}),L=await E.json();if(oe(!1),U(!1),!E.ok)return g({type:"danger",message:`An error occurred, ${L.error}`});g({type:"success",message:`Successfully bulk created ${L.length} ${(H=T[o.template_type])==null?void 0:H.name}s.`})},[T,r,g,o]),ae=x(()=>{const E=`${Date.now()}_${o==null?void 0:o.name}.json`;Nt(E,JSON.stringify({name:o==null?void 0:o.name,template_type:o==null?void 0:o.template_type,template:o==null?void 0:o.template})),g({type:"success",message:`Successfully downloaded template '${o==null?void 0:o.name}' as '${E}'.`})},[g,o==null?void 0:o.name,o==null?void 0:o.template,o==null?void 0:o.template_type]),ie=x(()=>{navigator.clipboard.writeText(JSON.stringify({name:o==null?void 0:o.name,template_type:o==null?void 0:o.template_type,template:o==null?void 0:o.template})).then(()=>g({type:"success",message:`Successfully copied template '${o==null?void 0:o.name}' to clipboard.`})).catch(E=>g({type:"danger",message:`Error copying template '${o==null?void 0:o.name}' to clipboard. ${E}`}))},[g,o==null?void 0:o.name,o==null?void 0:o.template,o==null?void 0:o.template_type]),[be,ge]=j(!1);return l("div",{children:[l("h5",{children:[O?"Create":"Edit"," ",O?"":`"${o==null?void 0:o.name}" `,"template"]}),y&&l("div",{class:"d-flex justify-content-center",children:l("div",{class:"spinner-border",role:"status",children:l("span",{class:"visually-hidden",children:"Loading..."})})}),!y&&!v&&_&&o&&l("div",{children:[l(M,{label:"Name",type:"text",value:o.name,onInput:f("name")}),!n&&l(M,{label:"Template type",type:"select",value:o.template_type,options:A,onInput:f("template_type")}),l(Ft,{schema:o.template,setSchema:m,bulkGenerateInfo:_})]}),l("div",{class:"d-flex mt-2",style:"gap: 5px",children:[l("button",{class:"btn btn-outline-primary",onClick:()=>c?ge(!0):t(),children:"Back"}),l("button",{class:`btn ${c?"btn-outline-success":"btn-outline-secondary"}`,onClick:N,disabled:!c,children:O?"Create":"Update"}),!O&&l("button",{class:`btn ${c?"btn-outline-danger":"btn-outline-secondary"}`,onClick:F,disabled:!c,children:"Reset"}),l("button",{class:"btn btn-outline-primary",onClick:C,children:"Preview"}),r&&l("button",{class:"btn btn-outline-primary",onClick:()=>U(!0),children:"Bulk create"}),l("div",{class:"btn-group btn-group-sm",children:[l("button",{class:"btn btn-outline-primary px-3",onClick:ie,children:l(Q,{text:"Copy to clipboard",placement:"top",children:l("i",{class:"fas fa-clipboard"})})}),l("button",{class:"btn btn-outline-primary px-3",onClick:ae,alt:"Download as file",children:l(Q,{text:"Download as file",placement:"top",children:l("i",{class:"fas fa-download"})})})]})]}),u&&_&&l(ct,{template:u,parentId:r,bulkGenerateInfo:_}),l(ee,{title:"Bulk create",show:I,onClose:()=>{U(!1)},actions:[{label:"Bulk create",type:"primary",onClick:se,disabled:J,loading:J}],children:["Are you sure you want to bulk generate"," ",((Pe=T[(o==null?void 0:o.template_type)||""])==null?void 0:Pe.name)||(o==null?void 0:o.template_type),"s here?"]}),l(ee,{title:"Save the template",show:be,onClose:()=>ge(!1),actions:[{label:"Don't save",type:"outline-danger",onClick:t},{label:"Save",type:"primary",onClick:()=>{N().then(E=>{ge(!1),E===!0&&t()})}}],children:"Do you want to save the template?"})]})},Ht=({templateType:e,parentId:t})=>{const[n,r]=j([]),[s,a]=j(!0),[i,u]=j(null),[d,o]=j("OVERVIEW"),{showNotification:b}=le(),c=x(async()=>{a(!0);const C=await R(W.templates({templateType:e}));if(!C.ok)return a(!1),b({type:"danger",message:`Fetching templates failed,
${C.statusText}`});const I=await C.json();r(I.map(U=>({...U,template:JSON.parse(U.template)}))),a(!1)},[b,e]);P(()=>{c()},[c]);const f=x((C,I)=>()=>{o(C),u(I)},[]),m=x(()=>{u(null),o("OVERVIEW"),c()},[c]),y=x(async()=>{if(i===null)return;const C=await R(W.templates({id:i.id}),{method:"DELETE"});if(!C.ok)return b({type:"danger",message:`Deleting template failed,
${C.statusText}`});u(null),o("OVERVIEW"),r(I=>[...I.filter(U=>U.id!==i.id)]),b({type:"success",message:"Template successfully deleted."})},[i,b]),h=Y(()=>{}),v=Y(()=>{}),k=x(()=>{T(!1),u(null),o("OVERVIEW")},[]),[_,p]=j(!1),[g,T]=j(!1),A=x(C=>{const I=JSON.parse(C);if(!("template_type"in I)||!("name"in I)||!("template"in I))throw new Error("invalid format");if(e&&e!==I.template_type)throw new Error(`Template type ${I.template_type} cannot be imported as a ${e} template.`);f("EDITING",{id:null,...I})()},[f,e]),O=Y(null),[G,N]=j(!1),F=x(()=>{var C,I;try{const U=(I=(C=O.current)==null?void 0:C.files)==null?void 0:I[0],J=new FileReader;J.onload=oe=>{var se,ae,ie;try{A(((ae=(se=oe.target)==null?void 0:se.result)==null?void 0:ae.toString())||""),(ie=O.current)!=null&&ie.value&&(O.current.value="")}catch(be){b({type:"danger",message:`Cannot import from file. ${be}`})}},J.readAsText(U,"UTF-8")}catch(U){b({type:"danger",message:`Cannot import from file. ${U}`})}},[A,b]);return d==="EDITING"?l("div",{children:l(Vt,{handleBack:m,templateId:i==null?void 0:i.id,templateType:e,parentId:t,initialTemplate:(i==null?void 0:i.id)===null?i:void 0})}):l("div",{children:[l("table",{class:"table table-bordered",style:"max-width: 500px",children:[l("thead",{children:l("tr",{children:[l("th",{children:"Name"}),l("th",{children:"Actions"})]})}),l("tbody",{children:s?l("tr",{children:l("td",{colSpan:2,children:l("div",{class:"d-flex justify-content-center",children:l("div",{class:"spinner-border",role:"status",children:l("span",{class:"visually-hidden",children:"Loading..."})})})})}):n.map(C=>l("tr",{children:[l("td",{children:C.name}),l("td",{children:[l("button",{class:"btn btn-sm btn-outline-danger me-1",onClick:f("DELETING",C),children:"Delete"}),l("button",{class:"btn btn-sm btn-outline-success me-1",onClick:f("EDITING",C),children:"Edit"}),l("button",{class:"btn btn-sm btn-outline-primary",onClick:f("PREVIEWING",C),children:"Preview/Bulk create"})]})]}))})]}),l("div",{class:"btn-group",children:[l("button",{type:"button",class:"btn btn-outline-primary",onClick:f("EDITING",null),children:"New untitled schema"}),l("button",{class:"btn btn-outline-primary dropdown-toggle dropdown-toggle-split","data-bs-toggle":"dropdown","aria-expanded":"false"}),l("ul",{class:"dropdown-menu",children:[l("li",{children:l("button",{class:"dropdown-item",onClick:()=>navigator.clipboard.readText().then(C=>A(C)).catch(C=>b({type:"danger",message:`Error importing from clipboard, ${C}`})),children:"From clipboard"})}),l("li",{children:l("button",{class:"dropdown-item",onClick:()=>f("IMPORT_TEMPLATE",null)(),children:"From file"})})]})]}),l(ee,{title:"Delete template",show:d==="DELETING",onClose:()=>{u(null),o("OVERVIEW")},actions:[{label:"Delete",type:"danger",onClick:y}],children:['Are you sure you want to delete the template "',i==null?void 0:i.name,'"?']}),l(ee,{title:"Preview/bulk create from template",show:d==="PREVIEWING",onClose:k,actions:[{label:"Preview",type:"primary",onClick:()=>{h.current(),T(!0)}},{label:"Bulk create",type:"outline-primary",onClick:()=>v.current(),disabled:_||!g,loading:_}],children:i&&l(V,{children:[l(St,{template:i,parentId:t,attachPreviewHandler:C=>{h.current=C},attachCreateHandler:C=>{v.current=C},handleDoneCreate:C=>{C&&k()},setIsBulkCreateLoading:p}),!g&&l("i",{children:"You need to preview the items first."})]})}),l(ee,{title:"Import template",show:d==="IMPORT_TEMPLATE",onClose:()=>{var C;u(null),o("OVERVIEW"),(C=O.current)!=null&&C.value&&(O.current.value="")},actions:[{label:"Import",type:"outline-primary",onClick:F,disabled:!G}],children:l("input",{type:"file",onInput:C=>{var I,U,J;return N(!((J=(U=(I=C.current)==null?void 0:I.target)==null?void 0:U.files)!=null&&J[0]))},ref:O})})]})},Mt=({children:e})=>l(Et,{children:l(Gt,{children:e})});function Rt({target:e,objectId:t,objectType:n}){$t(l(Mt,{children:l(Ht,{templateType:n,parentId:t})}),e)}export{Rt as render};
