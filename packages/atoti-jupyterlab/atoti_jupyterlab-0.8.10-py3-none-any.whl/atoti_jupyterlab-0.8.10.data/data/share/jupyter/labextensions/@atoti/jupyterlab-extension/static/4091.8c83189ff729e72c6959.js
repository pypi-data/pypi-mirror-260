/*! For license information please see 4091.8c83189ff729e72c6959.js.LICENSE.txt */
(self.webpackChunk_atoti_jupyterlab_extension=self.webpackChunk_atoti_jupyterlab_extension||[]).push([[4091,3388,7458,5737,2368,6520],{4091:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>ln});var i=n(90618),s=n(33196),r=n(90029),o=n(98934),a=n(76966),l=n(84974),d=n(74901),c=n(45789),u=n(16125);const g=[u.toolContentEditor,u.toolStyleEditor].map((e=>{const{shortcut:t,...n}=e;return n})),h="en-US",p={default:"en-US"},m=e=>{if(!e)return h;const t=e.get("locale").composite,n=p[t];return void 0===n?(console.error(`Atoti does not support JupyterLab's ${t} locale, falling back to ${h}.`),h):n},y=async(e,{pluginRegistry:t})=>{const[i,{default:s}]=await Promise.all([(0,u.fetchTranslations)(e),n(59273)(`./${e}.js`)]);return{...i,...(0,u.getPluginsTranslations)(t,e),...(0,u.getToolsTranslations)([...g],e),...(0,c.treeToFlatMap)(s)}};class f{static async create({pluginRegistry:e,settingRegistry:t}){const n=await(t?t.load("@jupyterlab/translation-extension:plugin"):void 0),i=m(n),s=await y(i,{pluginRegistry:e});return new f({initialConfig:{locale:i,messages:s},pluginRegistry:e,translationSettings:n})}_changed=new d.Signal(this);_config;constructor({initialConfig:e,pluginRegistry:t,translationSettings:n}){this._config=e,n&&n.changed.connect((async()=>{const e=m(n),i=await y(e,{pluginRegistry:t});this._config={locale:e,messages:i},this._changed.emit()}))}get changed(){return this._changed}get config(){return this._config}}const v=async e=>{e.theme||(await new Promise((t=>{const n=()=>{e.themeChanged.disconnect(n),t(void 0)};e.themeChanged.connect(n)})),await v(e))};class C{static async create(e){await v(e);const t=()=>!e.theme||e.isLight(e.theme)?u.lightActiveViamTheme:u.darkActiveViamTheme,n=t();return new C({initialTheme:n,syncTheme:t,themeManager:e})}_changed=new d.Signal(this);_theme;constructor({initialTheme:e,syncTheme:t,themeManager:n}){this._theme=e,n.themeChanged.connect((()=>{this._theme=t(),this._changed.emit()}))}get changed(){return this._changed}get theme(){return this._theme}}var w=n(80353),b=n(87717);class S{listeners=new Set;async run(){await Promise.all([...this.listeners].map((async e=>{await e()})))}subscribe(e){return this.listeners.add(e),()=>{this.listeners.delete(e)}}}var k=n(93388),T=n(78520),M=n(9617),x=n(66029),I=n(83794),P=n(56665),Z=n(93481),E=n(51333);const D="Content-Type",_="application/json",W=(e,{requestInit:t={}}={})=>async(n,{body:i,contentType:s=_,method:r,signal:o}={})=>{const a=`${e}${n.startsWith("/")?n:`/${n}`}`,l=await fetch(a,{...t,body:i,headers:{...t.headers,...s?{[D]:s}:void 0},method:r,signal:o});if(!l.ok){const e=await l.json();throw console.error(e),new Error(`Unexpected response status: ${l.status}`)}const d=l.headers.get(D)===_;let c=await(d?l.json():l.text());return d&&"object"==typeof c&&"success"===c.status&&"data"in c&&(c=c.data),c},L=E.PageConfig.getBaseUrl(),R=E.URLExt.join(L,"proxy"),$=async(e,{jupyterServerProxyEnabled:t,signal:n})=>{const{hostname:i}=new URL(L),s="url"in e?e.url:`${e.https?"https":"http"}://${i}:${e.port}`,r=[];if(t&&!s.startsWith(R)){const{hostname:e,pathname:t,port:n,protocol:o}=new URL(s),a=n||("https:"===o?"443":"80"),l=t&&"/"!==t?[t]:[];r.push(E.URLExt.join(R,a,...l)),e!==i&&r.push(E.URLExt.join(R,`${e}:${a}`,...l))}r.push(s),"port"in e&&r.push(`${e.https?"https":"http"}://localhost:${e.port}`);for(const e of r)try{const t=W(e);return{sessionUrl:e,versions:await t("versions/rest",{signal:n})}}catch{}throw new Error("Cannot access the session after trying "+(1===r.length?`this URL: ${r[0]}`:`these URLs: ${r.join(", ")}`))},j=(e,t="")=>{if(""===t){const{pathname:t}=new URL(e);return`${e}${""===t||"/"===t?"":"/"}`}return`${e}/${t}`};var B=n(77026);class O{static async create({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionLocation:i,signal:s}){const r="url"in i;r||(e=>{const t=new Headers(e).get("authorization");if(!t)throw new Error(`Missing Authorization header in ${JSON.stringify(e)}.`);(e=>{(0,l.checkUser)(e);const{username:t}=e;if(t!==l.anonymousUsername)throw new Error(`Expected username to be ${l.anonymousUsername} but was ${t}.`)})((0,u.getUserFromJwt)(t.split(" ",2).pop()))})(t);const{sessionUrl:o,versions:a}=await $(i,{jupyterServerProxyEnabled:e,signal:s}),d=null===t?void 0:{credentials:"include",headers:t,mode:"cors"},[c,g]=["pivot","content"].map((e=>{const t=[`activeviam/${e}`,e];for(const e of t)if(e in a.apis)return a.apis[e].versions[0];throw new Error(`One of ${t} missing in the server services: ${Object.keys(a.apis)}.`)})),h=(0,u.createActivePivotClient)({requestInit:d,serverVersion:a.serverVersion,serviceVersion:c,url:o});await h.loadDataModel({signal:s});const p=(0,u.createContentClient)({requestInit:d,serverVersion:a.serverVersion,serviceVersion:g,url:o}),m=W(o,{requestInit:d});return new O({activePivotClient:h,contentClient:p,fetch:m,id:n,isQuerySession:r,versions:a})}activePivotClient;contentClient;fetch;id;isQuerySession;versions;_disposed=new d.Signal(this);_isDisposed=!1;subscriberCount=0;stopSyncingDataModel;constructor({activePivotClient:e,contentClient:t,fetch:n,id:i,isQuerySession:s,versions:r}){this.activePivotClient=e,this.contentClient=t,this.fetch=n,this.stopSyncingDataModel=s?B.noop:(0,l.syncDataModel)(e),this.id=i,this.isQuerySession=s,this.versions=r}dispose(){this.isDisposed||(this._isDisposed=!0,this._disposed.emit(),this.activePivotClient.disconnect(),this.stopSyncingDataModel(),d.Signal.clearData(this))}get disposed(){return this._disposed}get isDisposed(){return this._isDisposed}subscribe(){this.subscriberCount++}unsubscribe(){this.subscriberCount--,0===this.subscriberCount&&this.dispose()}}const A=({children:e,description:t,icon:n,id:i})=>{const{formatMessage:s}=(0,Z.useIntl)();return(0,k.tZ)("div",{css:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"center"},children:(0,k.tZ)(M.Empty,{description:(0,k.BX)("span",{css:{color:"var(--jp-ui-font-color1)"},children:[(0,k.tZ)("span",{css:{fontSize:"var(--jp-ui-font-size2)"},children:s({id:`${i}.title`})}),(0,k.tZ)("br",{}),(0,k.tZ)("span",{css:{color:"var(--jp-ui-font-color2)",fontSize:"var(--jp-ui-font-size1)"},children:t??s({id:`${i}.description`})})]}),image:n,imageStyle:{fontSize:42,height:60},children:e})})};var U=n(50083);const N=({hasSnapshot:e})=>e?(0,k.tZ)(A,{icon:(0,k.tZ)(U.CameraOutlined,{}),id:"widget.snapshotSelected"}):(0,k.tZ)(A,{icon:(0,k.tZ)(U.ApiOutlined,{}),id:"widget.waitingForConnection"}),F=(e,t)=>{const n=(0,x.useCallback)((t=>e?(e.connect(t),()=>{e.disconnect(t)}):B.noop),[e]);return(0,x.useSyncExternalStore)(n,t)},z=(e,{property:t,sender:n})=>F(e,(()=>{if(n)return n[t]})),K=(0,x.createContext)(void 0),H=()=>{const e=(0,x.useContext)(K);if(!e)throw new Error("Missing session clients.");return e},q=(0,x.createContext)(void 0),X={username:l.anonymousUsername,userRoles:[l.roleAdmin,l.roleUser]},Q=({children:e,sessionId:t})=>{const n=H(),i=F(n.changed,(()=>n.get(t))),s=(0,x.useMemo)((()=>{const e={};return i&&(e[l.defaultServerKey]=i.activePivotClient),e}),[i]),r=(0,x.useMemo)((()=>i?.contentClient),[i]);return i?(0,k.tZ)(u.UserProvider,{value:X,children:(0,k.tZ)(u.ClientsProvider,{value:{activePivot:s,content:r},children:(0,k.tZ)(q.Provider,{value:i,children:e})})}):(0,k.tZ)(N,{})},V=()=>{const e=(0,x.useContext)(q);if(!e)throw new Error("Missing session client.");return e};class Y{_changed=new d.Signal(this);sessionClients={};sessionClientCreations={};get changed(){return this._changed}get(e){return this.sessionClients[e]}async getOrCreate({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionLocation:i,signal:s}){const r=this.get(n);if(r){const{activePivotClient:e}=r;return"disconnected"===e.connectionStatus&&await e.connect(),r}n in this.sessionClientCreations||(this.sessionClientCreations[n]=(async()=>{const r=await O.create({jupyterServerProxyEnabled:e,sessionHeaders:t,sessionId:n,sessionLocation:i,signal:s}),o=()=>{Reflect.deleteProperty(this.sessionClients,n),this._changed.emit(),r.disposed.disconnect(o)};r.disposed.connect(o),this.sessionClients[n]=r,Reflect.deleteProperty(this.sessionClientCreations,n),this._changed.emit()})()),await this.sessionClientCreations[n];const o=this.sessionClients[n];if(!o)throw new Error("Missing session client.");return o}}const J=e=>"mapping"in e;var G=n(35676),ee=n(14618);class te{onChange;index=0;states;constructor(e,t){this.onChange=t,this.states=[e]}get current(){return this.states[this.index]}get canRedo(){return this.index<this.states.length-1}get canUndo(){return this.index>0}set(e){e!==this.current&&(this.index++,this.states.length=this.index,this.states.push(e),this.onChange())}redo(){if(!this.canRedo)throw new Error("Cannot redo");this.index++,this.onChange()}undo(){if(!this.canUndo)throw new Error("Cannot undo");this.index--,this.onChange()}}const ne="atoti",ie="height",se="widget",re=360,oe=e=>e.getMetadata(ne)??void 0,ae=e=>{const t=e[se];return{...e,[se]:t?(0,u.deserializeWidgetState)(t):void 0}},le=e=>{const t=e[se];return{...e,[se]:t?(0,u.serializeWidgetState)(t):void 0}},de=e=>oe(e)?.[ie]??re;class ce{cellModel;_changed=new d.Signal(this);_isDeferredChanged=new d.Signal(this);_isDeferred=!1;_isDisposed=!1;disconnectFromCellMetadataChangedSignal;undoableState;updatingState=!1;widgetPlugins;constructor(e,{widgetPlugins:t}){this.cellModel=e;const n=oe(this.cellModel);this.undoableState=new te(n?ae(n):void 0,(()=>{this.updatingState=!0;try{this.current?this.cellModel.setMetadata(ne,le(this.current)):this.cellModel.deleteMetadata(ne)}finally{this.updatingState=!1}this._changed.emit()}));const i=(e,{key:t,newValue:n})=>{t!==ne||this.updatingState||(this.current=((e,t)=>{if(!t)return;const n=ae(t);return e?(i=e,s=n,(0,ee.produce)(i,(e=>{const t=(0,G.compare)(e,s);(0,G.applyPatch)(e,t)}))):n;var i,s})(this.current,n))};this.cellModel.metadataChanged.connect(i),this.disconnectFromCellMetadataChangedSignal=()=>{this.cellModel.metadataChanged.disconnect(i)},this.widgetPlugins=t}get defaultWidgetState(){return this.widgetPlugins[0].initialState}get canRedo(){return this.undoableState.canRedo}get canUndo(){return this.undoableState.canUndo}get changed(){return this._changed}get current(){return this.undoableState.current}set current(e){this.undoableState.set(e)}dispose(){this.isDisposed||(this._isDisposed=!0,this.disconnectFromCellMetadataChangedSignal(),d.Signal.clearData(this))}get isDeferred(){return this._isDeferred}set isDeferred(e){this._isDeferred=e,this._isDeferredChanged.emit()}get isDeferredChanged(){return this._isDeferredChanged}get isDisposed(){return this._isDisposed}setHeight(e){this.setMetadataProperty(ie,e)}setWidgetState(e){this.setMetadataProperty(se,e)}redo(){this.undoableState.redo()}undo(){this.undoableState.undo()}setMetadataProperty(e,t){const{current:n}=this;this.current={...n,[e]:t}}}const ue=e=>{const t=z(e.isDeferredChanged,{property:"isDeferred",sender:e}),n=(0,x.useCallback)((t=>{e.isDeferred=t}),[e]);return{isDeferred:t,setIsDeferred:n}},ge=e=>{const t=(0,x.useCallback)((t=>{e.setWidgetState(t)}),[e]),{[se]:n}=z(e.changed,{property:"current",sender:e})??{};return{setWidgetState:t,widgetState:n}},he=(0,x.createContext)(void 0),pe=()=>{const e=(0,x.useContext)(he);if(!e)throw new Error("Missing widget state trackers.");return e},me=(0,x.createContext)(void 0),ye=({cellModel:e,children:t,hasSnapshot:n})=>{const i=pe(),s=F(i.created,(()=>i.get(e)));return s?(0,k.tZ)(me.Provider,{value:s,children:t}):(0,k.tZ)(N,{hasSnapshot:n})},fe=()=>{const e=(0,x.useContext)(me);if(!e)throw new Error("Missing widget state tracker.");return e};class ve{_created=new d.Signal(this);widgetPlugins;widgetStateTrackers=new WeakMap;constructor({widgetPlugins:e}){this.widgetPlugins=e}get created(){return this._created}get(e){return this.widgetStateTrackers.get(e)}getOrCreate(e){return this.widgetStateTrackers.has(e)||(this.widgetStateTrackers.set(e,new ce(e,{widgetPlugins:this.widgetPlugins})),this._created.emit()),this.get(e)}}const Ce=(0,x.createContext)(void 0),we=(0,x.createContext)(!1),be=(0,x.createContext)(void 0),Se=({children:e,value:{intlTracker:t,jupyterLab:n,jupyterServerProxyEnabled:i,notebookTracker:s,pluginRegistry:r,popupContainer:o,sessionClients:a,themeTracker:l,widgetStateTrackers:d}})=>{const c=(0,x.useCallback)((()=>o),[o]),{locale:g,messages:h}=z(t.changed,{property:"config",sender:t}),p=z(l.changed,{property:"theme",sender:l});return(0,k.tZ)(M.ConfigProvider,{getPopupContainer:c,children:(0,k.tZ)(I.DndProvider,{backend:P.HTML5Backend,children:(0,k.tZ)(Z.IntlProvider,{locale:g,messages:h,children:(0,k.tZ)(u.ThemeProvider,{css:{height:"100%"},value:p,children:(0,k.tZ)(u.PluginsProvider,{value:r,children:(0,k.tZ)(u.DataModelClickListenersProvider,{children:(0,k.tZ)(Ce.Provider,{value:n,children:(0,k.tZ)(we.Provider,{value:i,children:(0,k.tZ)(be.Provider,{value:s,children:(0,k.tZ)(K.Provider,{value:a,children:(0,k.tZ)(he.Provider,{value:d,children:e})})})})})})})})})})})},ke=()=>{const e=(0,x.useContext)(Ce);if(!e)throw new Error("Missing JupyterLab.");return e},Te=()=>(0,x.useContext)(we),Me=()=>{const e=(0,x.useContext)(be);if(!e)throw new Error("Missing notebook tracker.");return e},xe=(0,x.createContext)(null),Ie=xe.Provider,Pe=()=>{const e=(0,x.useContext)(xe);if(!e)throw new Error("Missing widget environment.");return e},Ze=(e,t)=>{for(let n=0;n<e.length;n++){const i=e.get(n);if(t(i))return i}},Ee="text/html",De=l.version.split(".",1).pop(),_e=`application/vnd.atoti.link.v${De}+json`,We=`application/vnd.atoti.widget.v${De}+json`,Le=`application/vnd.atoti.convert-query-result-to-widget.v${De}+json`,Re=({children:e})=>{const[t,n]=(0,x.useState)(),i=(0,x.useRef)(null);return(0,x.useEffect)((()=>{const e=i.current;e&&void 0===t&&n(null!==e.closest(".jp-LinkedOutputView"))}),[t]),void 0===t?(0,k.tZ)("div",{ref:i}):e(t)};var $e=n(13851),je=n(18093),Be=n(19078);const Oe=e=>{const{formatMessage:t}=(0,Z.useIntl)(),{widgetKey:n}=(0,u.useSwitchedWidgetState)(e);return t({id:`aui.plugins.widget.${n}.defaultName`})};var Ae=n(39015);const Ue="atoti-exclude-from-snapshot",Ne=async({code:e,notebookTracker:t,state:n})=>{const i=t.currentWidget;if(!i)throw new Error("Notebook has no current panel.");const s=i.model;if(!s)throw new Error("Current notebook panel has no model.");const o=i.content;if(s.sharedModel.insertCell(o.activeCellIndex+1,(({code:e,state:t})=>({cell_type:"code",execution_count:null,metadata:{[ne]:le({[se]:t})},outputs:[],source:e}))({code:e,state:n})),o.activeCellIndex++,!o.activeCell||!(0,w.isCodeCellModel)(o.activeCell.model))throw new Error("A code cell has just been inserted and activated, expected the the current active cell to be a code cell.");const a=o.activeCell;return await r.NotebookActions.run(o,i.sessionContext),a},Fe=e=>{const t=z(e.activeCellChanged,{property:"activeCell",sender:e});if(t&&(0,w.isCodeCellModel)(t.model))return t.model},ze=()=>{const e=Me(),t=Fe(e),{cellModel:n}=Pe();return t===n},Ke=({onChange:e,widgetState:t})=>{if(!e)throw new Error("Missing `onChange` prop.");const n=Oe(t),[i,s]=(0,x.useState)(t.name??n);(0,x.useEffect)((()=>{s(t.name??n)}),[n,t.name]);const r=(0,x.useCallback)((()=>{if(i&&i!==n)e({...t,name:i});else{const{name:i,...r}=t;s(n),e(r)}}),[n,e,s,i,t]);return(0,k.tZ)(Be.TitleInput,{css:{height:"100%",padding:2},isPlaceholder:!t.name,isStrictlySized:!1,value:i,onBlur:r,onChange:s})},He=[],qe=({onChange:e,queryId:t,widgetState:n})=>{const{widgetKey:i}=(0,u.useSwitchedWidgetState)(n),[s]=(0,je.useWidgetPlugins)([i]),r=(0,$e.useTitleBarButtonPlugins)(s.titleBarButtons??He);return ze()?(0,k.tZ)("div",{className:Ue,css:{display:"flex",justifySelf:"end"},children:r.map((({Component:i,key:s})=>(0,k.tZ)(i,{css:{marginRight:8},queryId:t,widgetState:n,onWidgetChange:e},s)))}):null},Xe=e=>(0,k.BX)("div",{css:{display:"flex",fontSize:16,height:36,justifyContent:"space-between"},children:[(0,k.tZ)(Ke,{...e}),(0,k.tZ)(qe,{...e})]}),Qe=(0,u.withWidgetLoadingBar)((e=>{const t=(0,x.forwardRef)(((t,n)=>(0,k.BX)("div",{ref:n,css:{height:"100%"},children:[(0,k.tZ)(Xe,{...t}),(0,k.tZ)("div",{css:{height:"calc(100% - 36px)"},children:(0,k.tZ)(e,{...t})})]}))),n=e.displayName??e.name??"Unknown";return t.displayName=`withTitleBar(${n})`,t})(u.Widget));var Ve=n(67317);const Ye=({error:e})=>{const t=fe(),{formatMessage:n}=(0,Z.useIntl)();return(0,k.BX)(A,{description:String(e),icon:(0,k.tZ)(U.MehOutlined,{}),id:"widget.errored",children:[(0,k.BX)(M.Button,{danger:!0,onClick:()=>{t.current=void 0},children:[(0,k.tZ)(U.ClearOutlined,{})," ",n({id:"widget.reset"})]}),t.canUndo?(0,k.BX)(M.Button,{css:{marginLeft:"4px !important",marginTop:"4px !important"},onClick:()=>{t.undo()},children:[(0,k.tZ)(U.UndoOutlined,{})," ",n({id:"aui.plugins.menu-item.undo.key"})]}):null]})},Je=({children:e,widgetLoadingTracker:t})=>{const n=(0,x.useCallback)((async e=>{t&&await t.handleError(e)}),[t]),i=fe(),s=ge(i);return(0,k.tZ)(Ve.ErrorBoundary,{FallbackComponent:Ye,resetKeys:[s],onError:n,children:e})},Ge=({children:e})=>{const{formatMessage:t}=(0,Z.useIntl)(),n=ze(),{[l.defaultServerKey]:i}=(0,u.useConnectionStatuses)(),[s,r]=(0,x.useState)(!1),o=(0,x.useCallback)((()=>{r(!0)}),[]),a="disconnected"===i;return(0,x.useEffect)((()=>{r(!a)}),[a]),(0,k.BX)(x.Fragment,{children:[n&&a&&!s?(0,k.tZ)("div",{css:{padding:4,position:"absolute",width:"100%",zIndex:1},children:(0,k.tZ)(M.Alert,{closable:!0,showIcon:!0,className:Ue,message:t({id:"widget.sessionDisconnected"}),type:"warning",onClose:o})}):null,e]})},et=({children:e,widgetLoadingTracker:t})=>(0,k.tZ)(Ge,{children:(0,k.tZ)(Je,{widgetLoadingTracker:t,children:e})}),tt=()=>{const e=(0,x.useRef)(null),{cellModel:{id:t}}=Pe(),n=fe(),{isDeferred:i}=ue(n),{setWidgetState:s,widgetState:r=n.defaultWidgetState}=ge(n);return(0,x.useEffect)((()=>{const t=e.current;if(!t)throw new Error("Expected div to have been mounted and ref to have been set.");(e=>{let t=e;for(;t;)if(({parentElement:t}=t),t?.classList?.contains("jp-OutputArea-child"))return void(t.style.height="100%");throw new Error("Expected to find right parent element before exhausting them all.")})(t)}),[]),(0,k.tZ)(Qe,{ref:e,isDeferred:i,queryId:t,widgetState:r,onChange:s})},nt=()=>{const{cellModel:e,mimeModel:t,sessionId:n}=Pe();return(0,k.tZ)(ye,{cellModel:e,hasSnapshot:Boolean(t.data[Ee]),children:(0,k.tZ)(Q,{sessionId:n,children:(0,k.tZ)(et,{children:(0,k.tZ)(tt,{})})})})};var it=n(69652);class st{widgetId;sessionClient;toldLoadingDone=!1;constructor({sessionClient:e,widgetId:t}){this.sessionClient=e,this.widgetId=t}async done(){if(this.toldLoadingDone||this.sessionClient.isQuerySession)return;this.toldLoadingDone=!0;const e=`${this.sessionClient.versions.apis.atoti.versions[0].restPath}/widgets/${this.widgetId}/loading`;await this.sessionClient.fetch(e,{method:"DELETE"})}async handleError(e){await this.done()}}class rt{_changed=new d.Signal(this);cellModels;messages=new WeakMap;constructor({cellModels:e}){this.cellModels=e}get changed(){return this._changed}get(e){return this.messages.get(e)}register(e){this._changed.emit(),e.registerCommTarget("atoti-widget",((e,{content:{data:t}})=>{const n=t;try{const{cellId:e}=n,t=[...this.cellModels].find((({id:t})=>e===t));if(!t)throw new Error(`Missing model for cell #${e}`);if(!(0,w.isCodeCellModel)(t))throw new Error(`Expected cell #${e} to be a code cell`);const i=Ze(t.outputs,(e=>void 0!==e.data[We]));if(!i)throw new Error(`Expected cell #${e} to have a widget output`);this.messages.set(i,n),this._changed.emit()}catch(e){console.error(e)}}))}}const ot="atoti-sidebar",at=({jupyterLab:e})=>{e.shell.activateById(ot)};var lt=n(11329),dt=n(34882);const ct=({children:e,collapsedTitle:t,expandedTitle:n,expandedTitleBackgroundColor:i,isDisabled:s,isExpanded:r,onToggled:o})=>{const a=(0,u.useTheme)(),l=(0,x.useCallback)((()=>{o&&o(!r)}),[r,o]);return r?(0,k.BX)(k.HY,{children:[(0,k.BX)("div",{css:{alignItems:"center",backgroundColor:i??a.alternateBackgroundColor,cursor:"pointer",display:"flex",height:20,justifyContent:"space-between",padding:8},onClick:l,children:[(0,k.tZ)("div",{css:{fontSize:"11px",textTransform:"uppercase",width:"100%"},children:n}),(0,k.tZ)("div",{css:{color:a.textColor},children:!s&&(0,k.tZ)(U.DoubleLeftOutlined,{})})]}),(0,k.tZ)("div",{css:{height:"calc(100% - 20px)"},children:e})]}):(0,k.BX)("div",{css:{height:"100%"},onClick:l,children:[(0,k.tZ)("div",{css:{alignItems:"center",backgroundColor:a.alternateBackgroundColor,borderBottom:"1px solid",borderColor:a.cellBorderColor,borderRight:`1px solid ${a.cellBorderColor}`,display:"flex",height:20,justifyContent:"center"},children:(0,k.tZ)("div",{css:{cursor:"pointer"},children:(0,k.tZ)(U.DoubleRightOutlined,{})})}),(0,k.tZ)("div",{css:{backgroundColor:a.alternateBackgroundColor,borderColor:a.cellBorderColor,borderRight:`1px solid ${a.cellBorderColor}`,cursor:"pointer",height:"100%",textAlign:"center",whiteSpace:"nowrap"},children:t})]})};var ut=n(44841);const{OptGroup:gt,Option:ht}=M.Select,pt=({onChange:e,queryId:t,widgetState:n})=>{const{formatMessage:i}=(0,Z.useIntl)(),s=(0,ut.useIsQueryLazyLoaded)({queryId:t,widgetState:n}),r=(e=>{const t=(0,u.useWidgetPlugins)(e),n=(0,x.useMemo)((()=>{const e=[];for(const n of t)(0,ut.isDataVisualizationWidgetPlugin)(n)&&e.push(n);return e}),[t]);return n})((0,u.useWidgetPluginKeys)()),{mapping:o,widgetKey:a}=(0,u.useSwitchedWidgetState)(n),{attributes:l}=r.find((({key:e})=>e===a)),d=(0,x.useMemo)((()=>{const e={};for(const t of Object.values(r)){const r=t.subCategory??"misc";e[r]||(e[r]=[]);const a=t.Icon??U.QuestionOutlined,{maxNumberOfFields:d,status:c}=(0,ut.getSwitchAvailability)(o,l,t);e[r].push((0,k.tZ)(ht,{disabled:"ok"!==c,value:t.key,children:(0,k.BX)(M.Tooltip,{title:(0,k.tZ)(ut.WidgetIconTooltip,{isQueryLazyLoaded:s,selectedWidgetState:n,widgetOption:{...t,disabledType:"tooManyNumeric"===c?"numeric":"ordinal",isSwitchDisabled:"ok"!==c,maxNumberOfFields:d}}),children:[(0,k.tZ)(a,{css:{marginRight:4}})," ",i({id:`aui.plugins.widget.${t.key}.key`})]})},t.key))}return e}),[l,r,i,s,o,n]);return(0,k.tZ)(M.Select,{css:{height:28,marginBottom:"4px !important",width:"100%"},listHeight:30*Object.keys(r).length,value:a,onChange:t=>{e((0,ee.produce)(n,(e=>{t===e.widgetKey?delete e.switchedTo:e.switchedTo=t})))},children:Object.entries(d).map((([e,t])=>(0,k.tZ)(gt,{label:i({id:`aui.dataVisualization.category.${e}`}),children:t},e)))})},mt=()=>{const e=fe(),{isDeferred:t,setIsDeferred:n}=ue(e),{formatMessage:i}=(0,Z.useIntl)();return(0,k.tZ)("div",{css:{alignItems:"center",display:"flex",flexDirection:"row",height:22,justifyContent:"flex-end"},children:(0,k.tZ)(M.Checkbox,{checked:t,onChange:e=>{n(e.target.checked)},children:i({id:"sidebar.deferUpdates"})})})},yt=({activeToolKey:e,onActiveToolKeyChanged:t,tools:n})=>(0,k.tZ)(M.Tabs,{css:{".ant-tabs-nav-operations":{".ant-tabs-nav-more":{alignItems:"center",display:"flex"},margin:"0 !important",padding:"0 !important"},"div.ant-tabs-tab-btn span.tab-item-label":{display:"none"}},activeKey:e,items:n.map((e=>({key:e.key,label:(0,k.tZ)("span",{className:"anticon",css:{marginRight:"0px !important"},children:(0,k.tZ)(e.icon,{})})}))),tabBarStyle:{height:20,marginTop:5,paddingLeft:8},type:"card",onTabClick:t}),ft=({cellId:e})=>{const{formatMessage:t}=(0,Z.useIntl)(),n=fe(),{setWidgetState:i,widgetState:s=n.defaultWidgetState}=ge(n),r=(0,u.useSwitchedWidgetState)(s),[o,a]=(0,x.useState)(240),[d,c]=(0,x.useState)("contentEditor"),{cube:{name:h}}=(0,u.useCube)(r),[p,m]=(0,x.useState)(!0),{component:y}=g.find((({key:e})=>e===d));return(0,k.BX)("div",{css:{display:"flex",flexDirection:"column",height:"100%",justifyContent:"flex-end",overflowY:"scroll"},children:[J(r)?(0,k.tZ)("div",{css:{paddingLeft:4,paddingRight:4,paddingTop:4},children:(0,k.tZ)(pt,{queryId:e,widgetState:r,onChange:i})}):null,(0,k.tZ)("div",{css:{height:`calc(100% - ${22+(J(r)?32:0)}px)`},children:(0,k.BX)(u.Resizable,{minSize:p?100:34,size:p?o??240:34,onResizeEnd:a,children:[(0,k.tZ)(ct,{collapsedTitle:(0,k.tZ)("div",{css:{display:"inline-block",marginTop:70,textTransform:"uppercase",transform:"rotate(-90deg)",width:15},children:t({id:"aui.dataModel"})}),expandedTitle:t({id:"aui.dataModel"}),isExpanded:p,onToggled:m,children:(0,k.tZ)("div",{css:{height:"100%",paddingTop:4},children:(0,k.tZ)(u.DataModelTree,{cubeName:h,serverKey:l.defaultServerKey})})}),(0,k.BX)("div",{css:{height:"100%"},children:[(0,k.tZ)(yt,{activeToolKey:d,tools:g,onActiveToolKeyChanged:c}),(0,k.tZ)("div",{css:{height:"calc(100% - 20px)",padding:"0px 8px"},children:(0,k.tZ)(y,{widgetState:r,queryId:e,onWidgetChange:i})})]})]})}),(0,k.tZ)(mt,{})]})},vt=()=>{const e=Me(),t=Fe(e),n=(e=>{z(e?.outputs.changed,{property:"length",sender:e?.outputs});const t=e?Ze(e.outputs,(e=>void 0!==e.data[We])):void 0;if(!t)return;const{data:n}=t;return{hasSnapshot:Ee in n,widgetOutput:n[We]}})(t);if(!t||!n)return(0,k.tZ)(A,{icon:(0,k.tZ)(u.IconPuzzle,{}),id:"sidebar.noWidgetSelected"});const{hasSnapshot:i,widgetOutput:s}=n;return(0,k.tZ)(ye,{cellModel:t,hasSnapshot:i,children:(0,k.tZ)(Q,{sessionId:s.sessionId,children:(0,k.tZ)(Je,{children:(0,k.tZ)(ft,{cellId:t.id})})})})},Ct="atoti-icon",wt="jp-SideBar-tabIcon",bt=`.${Ct}.${wt}`;class St extends dt.Widget{constructor(e){super(),this.id=ot,this.title.caption="Atoti",this.title.iconClass=`${wt} ${Ct}`;const t=s.ReactWidget.create((0,k.BX)(x.Fragment,{children:[(0,k.tZ)(lt.Global,{styles:{[bt]:{backgroundColor:"var(--md-grey-700)",backgroundImage:"none",maskImage:"url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 256 256'%3E%3Cpath fill='%23fff' d='M165.883 208.19h-75.8l-7.342 25.99H30.456l72.467-213.997h49.82l72.759 213.996h-52.267Zm-10.991-38.818-27.21-94.467-26.904 94.467Z'/%3E%3C/svg%3E%0A\");",maskPosition:"center",maskRepeat:"no-repeat",maskSize:"contain"},[`[data-jp-theme-light="false"] ${bt}`]:{backgroundColor:"var(--md-grey-300)"}}}),(0,k.tZ)(Se,{value:e,children:(0,k.tZ)(vt,{})})]})),{style:n}=t.node;n.height="100%",n.padding="0";const i=new dt.PanelLayout;i.addWidget(t),this.layout=i}}const kt=({widgetLoadingTracker:e,widgetRef:t})=>{const{cellModel:{id:n}}=Pe(),i=fe(),{isDeferred:s,setIsDeferred:r}=ue(i),{setWidgetState:o,widgetState:a}=ge(i),d=a??i.defaultWidgetState,c=(p=e,(0,x.useEffect)((()=>()=>{(async()=>{await p.done()})()}),[p]),(0,x.useCallback)((async()=>{await p.done()}),[p])),g=(e=>{const{cellModel:{id:t},mimeModel:n,preSaveSubscribe:i}=Pe(),s=(0,x.useRef)(!1),r=fe(),{widgetState:{name:o}={}}=ge(r),a=(0,x.useCallback)((e=>{const{[Ee]:t,...i}=n.data;n.setData({data:e?{...i,[Ee]:`<img height="${e.height}" width="${e.width}" src="${e.src}" />`}:i})}),[n]),{error:d}=(0,u.useQueryResult)({queryId:t,serverKey:l.defaultServerKey});return(0,x.useEffect)((()=>{let t=!1;const n=i((async()=>{let n;if(s.current&&!d&&e.current)try{const t=Date.now(),{clientHeight:i,clientWidth:s}=e.current;n={height:i,src:await(async e=>await(0,Ae.domToPng)(e,{filter:e=>!(e=>e.nodeType===e.ELEMENT_NODE)(e)||!e.classList.contains(Ue),scale:window.devicePixelRatio??1}))(e.current),width:s};const r=Date.now();console.debug(`Snapshotted widget "${o}" in ${(r-t)/1e3} seconds.`)}catch(e){throw new Error("Failed to snapshot widget",{cause:e})}t||a(n)}));return()=>{t=!0,n()}}),[d,o,i,a,e]),(0,x.useCallback)((()=>{s.current=!0}),[])})(t),h=(0,x.useCallback)((()=>{c(),g()}),[c,g]);var p;return(e=>{const t=ke();(0,x.useEffect)((()=>{e&&at({jupyterLab:t})}),[e,t])})(void 0===a),(e=>{(0,x.useEffect)((()=>()=>{e(!1)}),[e])})(r),(()=>{const e=V();(0,x.useEffect)((()=>(e.subscribe(),()=>{e.unsubscribe()})),[e])})(),(0,k.tZ)(Qe,{isDeferred:s,queryId:n,widgetState:d,onLoaded:h,onChange:o})};var Tt=n(88627);const Mt=":",xt=`atoti${Mt}`,It=e=>void 0!==e,Pt=(...e)=>{if(!window.__UNSTABLE_DATA_TEST_IDS_ENABLED__)return;const t=e.at(-1);if((0,B.isPlainObject)(t)){const n=t["data-testid"],i=e.slice(0,-1).filter(It);if(n){const e=n.replace(xt,"");return`${xt}${[...i.filter(It),e].join(Mt)}`}return`${xt}${i.join(Mt)}`}return`${xt}${e.filter(It).join(Mt)}`},Zt="atoti-resize-handle",Et=(0,x.forwardRef)((({children:e},t)=>{const n=fe(),{height:i,setHeight:s}=(e=>{const t=(0,x.useCallback)((t=>{e.setHeight(t)}),[e]),{height:n=re}=z(e.changed,{property:"current",sender:e})??{};return{height:n,setHeight:t}})(n),{widgetState:{name:r}={}}=ge(n),o=(0,u.useTheme)();return(0,k.tZ)(lt.ClassNames,{children:({css:n})=>(0,k.tZ)(Tt.Resizable,{handleClasses:{bottom:`${Zt} ${n({backgroundColor:o.grayScale[6],borderRadius:2,borderTop:"unset",height:"4px !important",marginBottom:6,marginLeft:"calc(50% - 16px)",opacity:.4,width:"32px !important"})}`},size:{height:i,width:"100%"},enable:{bottom:!0,bottomLeft:!1,bottomRight:!1,left:!1,right:!1,top:!1,topLeft:!1,topRight:!1},css:{[`&:hover .${Zt}`]:{display:"inherit"},overflow:"hidden",paddingBottom:8},onResizeStop:(e,t,n,r)=>{s(i+r.height)},children:(0,k.tZ)("div",{ref:t,css:{height:"100%"},"data-testid":Pt("Widget",r),children:e})})})})),Dt=({html:e})=>{const t=(0,Z.useIntl)(),{cellModel:n}=Pe(),i=(e=>oe(e)?.[se]?.name??void 0)(n);return(0,k.tZ)("div",{dangerouslySetInnerHTML:{__html:e},css:{cursor:"help"},"data-testid":Pt("WidgetSnapshot",i),title:t.formatMessage({id:"widget.snapshotSelected.description"})})},_t=()=>{const e=(0,x.useRef)(null),{cellModel:t,mimeModel:n,sessionId:i}=Pe(),s=(()=>{const e=Te(),t=H(),{cellModel:n,mimeModel:i,sessionId:s,sessionLocation:r,widgetComm:o}=Pe(),a=pe(),l=((e,t)=>F(e.changed,(()=>e.get(t))))(o,i),{error:d,result:c}=(0,it.useAsyncAbortable)((async i=>{if(!l)return;const{sessionHeaders:o,widgetId:d}=l,c=await t.getOrCreate({jupyterServerProxyEnabled:e,sessionHeaders:o,sessionId:s,sessionLocation:r,signal:i});return a.getOrCreate(n),new st({sessionClient:c,widgetId:d})}),[n,e,t,s,r,l,a]);return d??c})(),r=pe().get(t);return s instanceof Error?(0,k.tZ)("div",{css:{height:de(t)},children:(0,k.tZ)(A,{description:s.message,icon:(0,k.tZ)(U.DisconnectOutlined,{}),id:"widget.connectionFailed"})}):s&&r?(0,k.tZ)(ye,{cellModel:t,children:(0,k.tZ)(Et,{ref:e,children:(0,k.tZ)(Q,{sessionId:i,children:(0,k.tZ)(et,{widgetLoadingTracker:s,children:(0,k.tZ)(kt,{widgetLoadingTracker:s,widgetRef:e})})})})}):n.data[Ee]?(0,k.tZ)(Dt,{html:n.data[Ee]}):(0,k.tZ)("div",{css:{height:de(t)},children:(0,k.tZ)(N,{})})},Wt=()=>(0,k.tZ)(Re,{children:e=>e?(0,k.tZ)(nt,{}):(0,k.tZ)(_t,{})});class Lt extends r.NotebookTools{cellModels;cleanUpFunctions=[];preSaveSubscribe;root;sharedContext;widgetComm;constructor({cellModels:e,preSaveSubscribe:t,sharedContext:n,widgetComm:i}){super({tracker:n.notebookTracker}),this.cellModels=e,this.preSaveSubscribe=t,this.root=(0,T.s)(this.node),this.sharedContext=n,this.widgetComm=i}async renderModel(e){const t=((e,{cellModels:t})=>{for(const n of t)if((0,w.isCodeCellModel)(n)&&Ze(n.outputs,(t=>t===e)))return n;throw new Error(`Could not find matching cell for model: ${JSON.stringify(e)}`)})(e,{cellModels:this.cellModels}),n=e.data[We],{sessionId:i,sessionLocation:s}=n;this.root.render((0,k.tZ)(Se,{value:this.sharedContext,children:(0,k.tZ)(Ie,{value:{cellModel:t,mimeModel:e,preSaveSubscribe:this.preSaveSubscribe,sessionId:i,sessionLocation:s,widgetComm:this.widgetComm},children:(0,k.tZ)(Wt,{})})})),this.cleanUpFunctions.push((()=>{this.root.unmount()}))}handleEvent(e){if(e instanceof MouseEvent&&!e.shiftKey&&e.target){const t=new MouseEvent("contextmenu",{bubbles:!0,clientX:e.clientX,clientY:e.clientY,shiftKey:!0});e.stopPropagation(),e.preventDefault(),t.initEvent(t.type,!0,!0),e.target.dispatchEvent(t)}}onAfterAttach(){const e={capture:!0};this.node.addEventListener("contextmenu",this,e),this.cleanUpFunctions.push((()=>{this.node.removeEventListener("contextmenu",this,e)}))}onBeforeDetach(){for(const e of this.cleanUpFunctions)e()}}class Rt{sharedContext;constructor(e){this.sharedContext=e}createNew(e,t){const n=(e=>{let{save:t}=e;t=t.bind(e);const n=new S;return e.save=async()=>{try{await n.run()}catch(e){console.error("Pre save hook failed to run",e)}await t()},n.subscribe.bind(n)})(t),{content:i,model:s}=e;if(null===s)throw new Error("Session model should not be null at this time");const{cells:r}=s,o=new rt({cellModels:r});i.rendermime.addFactory({createRenderer:()=>new Lt({cellModels:r,preSaveSubscribe:n,sharedContext:this.sharedContext,widgetComm:o}),defaultRank:0,mimeTypes:[We],safe:!1});const{sessionContext:a}=t,l=(e,{newValue:t})=>{t&&o.register(t)};a.kernelChanged.connect(l);const d=((e,{cellModels:t})=>(n,i)=>{if("idle"===i)for(const n of[...t].filter((t=>{const n=e.get(t);return n?.current&&(0,w.isCodeCellModel)(t)&&t.outputs.length>0&&!Ze(t.outputs,(e=>"error"===e.type||void 0!==e.data[We]))})))e.get(n).current=void 0})(this.sharedContext.widgetStateTrackers,{cellModels:r});return a.statusChanged.connect(d),new b.DisposableDelegate((()=>{a.kernelChanged.disconnect(l),a.statusChanged.disconnect(d)}))}}const $t="convert-query-result-to-widget",jt=`atoti:${$t}`,Bt=".jp-Notebook .jp-CodeCell .dataframe",Ot=e=>{const{activeCell:t}=e,n=t&&(0,w.isCodeCellModel)(t.model)&&Ze(t.model.outputs,(e=>void 0!==e.data[Le]));return n?n.data[Le]:void 0},At=E.URLExt.join(E.PageConfig.getBaseUrl(),"server-proxy","servers-info"),Ut=async()=>{try{if((await fetch(At)).ok)return!0}catch{}return!1},Nt=({output:{path:e,sessionLocation:t}})=>{const n=Te(),{error:i,result:s}=(0,it.useAsyncAbortable)((async e=>{const{sessionUrl:i}=await $(t,{jupyterServerProxyEnabled:n,signal:e});return i}),[n,t]);if(void 0!==i)return(0,k.tZ)("div",{css:{paddingLeft:"var(--jp-code-padding)"},children:i.message});if(void 0===s)return null;const r=j(s,e);return(0,k.tZ)("div",{css:{paddingLeft:"var(--jp-code-padding)"},children:(0,k.tZ)("pre",{children:(0,k.tZ)("a",{css:{":hover":{color:"var(--jp-content-link-color)",textDecoration:"underline"},color:"var(--jp-content-link-color)"},"data-testid":Pt("Link"),href:r,target:"_blank",rel:"noopener noreferrer",children:r})})})};class Ft extends r.NotebookTools{root;sharedContext;constructor(e){super({tracker:e.notebookTracker}),this.root=(0,T.s)(this.node),this.sharedContext=e}async renderModel(e){this.root.render((0,k.tZ)(Se,{value:this.sharedContext,children:(0,k.tZ)(Nt,{output:e.data[_e]})}))}onBeforeDetach(){this.root.unmount()}}class zt{sharedContext;constructor(e){this.sharedContext=e}createNew(e,t){return e.content.rendermime.addFactory({createRenderer:()=>new Ft(this.sharedContext),defaultRank:0,mimeTypes:[_e],safe:!1}),new b.DisposableSet}}var Kt=n(14690),Ht=n(28269);const qt="open-drillthrough",Xt={key:qt,translations:{"en-US":{openDrillthrough:"Drillthrough {member, select,\n           undefined {}\n           other {on {member}}\n          }"}},useMenuItem:e=>{const{selection:t,widgetState:n}=e,{cube:i}=(0,u.useCube)(n),{formatMessage:s}=(0,Z.useIntl)(),r=ke(),o=Me(),{mimeModel:a}=Pe(),{widgetCreationCode:d}=a.data[We],c=(0,x.useMemo)((()=>{if((0,Ht.canOpenDrillthroughOnSelection)(t))return t.cells[0].tuple.filter((e=>"Measures"===e.dimensionName||!(0,Kt.isTotal)((0,u.getHierarchy)(e,i),e)))}),[i,t]),g=(0,x.useMemo)((()=>{if(!c)return;const e=c.filter((e=>"Measures"!==e.dimensionName));return s({id:`aui.plugins.menu-item.${qt}.openDrillthrough`},{member:e.length>0?(0,Kt.getTupleCaption)(e,{captionForTotals:s({id:"aui.total"}),cube:i,hasOnlyCaptionForLeafLevels:!0,separator:", "}):void 0})}),[s,c,i]),{execute:h,loading:p}=(0,it.useAsyncCallback)((async()=>{if(g&&c&&n.query.mdx){const e=(0,Ht.getDrillthroughWidgetFilters)({cube:i,sourceWidgetFilters:n.filters,tuple:c}),t={...u.pluginWidgetDrillthroughTable.initialState,filters:e,initialCubeName:i.name,query:{...u.pluginWidgetDrillthroughTable.initialState.query,mdx:(0,ut.getDefaultMdxDrillthrough)(i.name)},serverKey:l.defaultServerKey};at({jupyterLab:r}),await Ne({code:d,notebookTracker:o,state:t})}}));if(c&&n.query.mdx)return{disabled:p,icon:(0,k.tZ)(u.IconDrillthrough,{css:{marginRight:8}}),label:g,onClick:h}}},{Link:Qt,Text:Vt}=M.Typography,Yt="save-widget-in-app",Jt={key:Yt,translations:{"en-US":{errorMessage:"Widget could not be saved in app",querySessionWidgetsCannotBeSavedInApp:"Query session widgets cannot be saved in app",saveWidgetInApp:"Save widget in app",successDescription:"Go to <a>the app</a>, create or open a dashboard, open the <b>Insert > <i>icon</i> Widgets</b> menu, and switch to the <b>Saved widgets</b> tab to find your widget.",successMessage:"Widget saved in app"}},useMenuItem:e=>{const{notification:t}=M.App.useApp(),{formatMessage:n,locale:i,messages:s}=(0,Z.useIntl)(),{activePivotClient:{url:r},contentClient:o,isQuerySession:a}=V(),{widgetState:d}=e,c=Oe(d),{execute:g,loading:h}=(0,it.useAsyncCallback)((async()=>{if(!o)throw new Error("Missing content client on local sessions.");const{name:e,widgetKey:a,...g}=(0,u.serializeWidgetState)(d),h=[l.roleAdmin];try{await o.createFile({content:g,metaData:{name:e??c,version:0,widgetKey:a},owners:h,pathToParentFolder:[],readers:h,type:"widget"});const l=j(r);t.success({description:(0,k.tZ)(Z.IntlProvider,{locale:i,messages:s,children:(0,k.tZ)(Z.FormattedMessage,{id:`aui.plugins.menu-item.${Yt}.successDescription`,values:{a:e=>(0,k.tZ)(Qt,{href:l,target:"_blank",rel:"noopener noreferrer",children:e}),b:e=>(0,k.tZ)(Vt,{strong:!0,children:e}),i:()=>(0,k.tZ)(u.IconPuzzle,{})}})}),message:n({id:`aui.plugins.menu-item.${Yt}.successMessage`})})}catch(e){console.error(e),t.error({description:String(e),message:n({id:`aui.plugins.menu-item.${Yt}.errorMessage`})})}})),p=a||h,m=a?n({id:`aui.plugins.menu-item.${Yt}.querySessionWidgetsCannotBeSavedInApp`}):void 0;return{disabled:p,icon:(0,k.tZ)(U.DeliveredProcedureOutlined,{}),label:n({id:`aui.plugins.menu-item.${Yt}.saveWidgetInApp`}),onClick:g,title:m}}},Gt=e=>(0,B.keyBy)(e,"key"),en=["undo","redo"],tn=(e,{notebookTracker:t,widgetStateTrackers:n})=>()=>{const{disabledTextColor:i}=(0,u.useTheme)(),s=Fe(t),r=F(n.created,(()=>s&&n.get(s))),{formatMessage:o}=(0,Z.useIntl)();z(r?.changed,{property:"current",sender:r});let a=!1;r&&(a="undo"===e?r.canUndo:r.canRedo);const l=(0,x.useCallback)((()=>{a&&r&&("undo"===e?r.undo():r.redo())}),[a,r]),[d,c]=(0,x.useState)(!1),g=(0,x.useCallback)((()=>{c(!0)}),[]),h=(0,x.useCallback)((()=>{c(!1)}),[]),p=o(a?{id:`aui.plugins.titlebar-button.${e}.title`}:{id:`aui.plugins.titlebar-button.${e}.nothingToUndoRedo`}),m="undo"===e?U.UndoOutlined:U.RedoOutlined;return(0,k.tZ)(M.Tooltip,{placement:"bottom",title:p,open:d,children:(0,k.tZ)(m,{css:{color:a?void 0:i,cursor:a?void 0:"not-allowed !important",padding:"0px 4px"},onClick:l,onMouseEnter:g,onMouseLeave:h})})},nn=[u.pluginWidgetPivotTable,u.pluginWidgetTreeTable,u.pluginWidgetTable,u.pluginWidgetKpi,u.pluginWidgetPlotlyLineChart,u.pluginWidgetPlotlyAreaChart,u.pluginWidgetPlotlyStackedAreaChart,u.pluginWidgetPlotly100StackedAreaChart,u.pluginWidgetPlotlyStackedColumnChart,u.pluginWidgetPlotlyClusteredColumnChart,u.pluginWidgetPlotly100StackedColumnChart,u.pluginWidgetPlotlyColumnsAndLinesChart,u.pluginWidgetPlotlyStackedBarChart,u.pluginWidgetPlotlyClusteredBarChart,u.pluginWidgetPlotly100StackedBarChart,u.pluginWidgetPlotlyPieChart,u.pluginWidgetPlotlyDonutChart,u.pluginWidgetPlotlyScatterPlot,u.pluginWidgetPlotlyRadarChart,u.pluginWidgetPlotlyWaterfallChart,u.pluginWidgetPlotlyBulletChart,u.pluginWidgetPlotlyGaugeChart,u.pluginWidgetPlotlyTreeMap,u.pluginWidgetDrillthroughTable];u.pluginWidgetDrillthroughTable.cellStyle=u.pluginCellStyleDrillthroughTable.key,u.pluginWidgetDrillthroughTable.contextMenuItems=[u.pluginMenuItemSortDrillthroughTableAscendingly.key,u.pluginMenuItemSortDrillthroughTableDescendingly.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemExportDrillthroughToCsv.key];const sn=nn.filter((({key:e})=>e.startsWith("plotly"))),rn=new Set(["bar","column","line"]);for(const e of sn)e.contextMenuItems=[u.pluginMenuItemFilterOnSelection.key,Xt.key,u.pluginMenuItemSortChartAscendingly.key,u.pluginMenuItemSortChartDescendingly.key,u.pluginMenuItemRemoveSort.key,...e.subCategory&&rn.has(e.subCategory)?[u.pluginMenuItemShowHideChartTotals.key]:[],u.pluginMenuItemCopyQuery.key,u.pluginMenuItemExportToCsv.key];u.pluginWidgetPivotTable.cell=u.pluginCellPivotTable.key,u.pluginWidgetPivotTable.cellStyle=u.pluginCellStylePivotTable.key,u.pluginWidgetTable.cell=u.pluginCellTable.key,u.pluginWidgetTable.cellStyle=u.pluginCellStyleTable.key,u.pluginWidgetTreeTable.cell=u.pluginCellTreeTable.key,u.pluginWidgetTreeTable.cellStyle=u.pluginCellStylePivotTable.key;const on=[u.pluginMenuItemFilterOnSelection.key,Xt.key,u.pluginMenuItemRemoveSort.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemHideColumns.key,u.pluginMenuItemShowHideTotals.key,u.pluginMenuItemExportToCsv.key];for(const e of[u.pluginWidgetPivotTable,u.pluginWidgetTreeTable])e.contextMenuItems=[u.pluginMenuItemSortPivotTableAscendingly.key,u.pluginMenuItemSortPivotTableDescendingly.key,...on];u.pluginWidgetTable.contextMenuItems=[u.pluginMenuItemSortTableAscendingly.key,u.pluginMenuItemSortTableDescendingly.key,...on],u.pluginWidgetKpi.contextMenuItems=[u.pluginMenuItemFilterOnSelection.key,Xt.key,u.pluginMenuItemCopyQuery.key,u.pluginMenuItemShowHideTotals.key,u.pluginMenuItemExportToCsv.key];for(const e of nn)e.contextMenuItems.push(Jt.key),e.titleBarButtons=[...en];const an={async activate(e,t,n,i,s,r){window.localStorage.getItem("_atotiEnableTestIds")===JSON.stringify(!0)&&(window.__UNSTABLE_DATA_TEST_IDS_ENABLED__=!0);const o=e,{docRegistry:d,shell:c}=o;console.debug(`Activating Atoti Python API extension ${l.version} (relying on Atoti UI ${a.activeuiVersion})`);const g=new ve({widgetPlugins:nn}),h=(({notebookTracker:e,widgetStateTrackers:t})=>en.map((n=>({Component:tn(n,{notebookTracker:e,widgetStateTrackers:t}),key:n,translations:{"en-US":{nothingToUndoRedo:"Nothing to "+("undo"===n?"undo":"redo"),title:"undo"===n?"Undo":"Redo"}}}))))({notebookTracker:t,widgetStateTrackers:g}),p=(({undoRedoTitleBarButtonPlugins:e,widgetPlugins:t})=>({cell:Gt([u.pluginCellPivotTable,u.pluginCellTable,u.pluginCellTreeTable]),"cell-style":Gt([u.pluginCellStyleDrillthroughTable,u.pluginCellStylePivotTable,u.pluginCellStyleTable]),"menu-item":Gt([u.pluginMenuItemCopyQuery,u.pluginMenuItemExportDrillthroughToCsv,u.pluginMenuItemExportToCsv,u.pluginMenuItemFilterOnSelection,Xt,Jt,u.pluginMenuItemRemoveSort,u.pluginMenuItemHideColumns,u.pluginMenuItemShowHideChartTotals,u.pluginMenuItemShowHideTotals,u.pluginMenuItemSortDrillthroughTableAscendingly,u.pluginMenuItemSortDrillthroughTableDescendingly,u.pluginMenuItemSortChartAscendingly,u.pluginMenuItemSortChartDescendingly,u.pluginMenuItemSortPivotTableAscendingly,u.pluginMenuItemSortPivotTableDescendingly,u.pluginMenuItemSortTableAscendingly,u.pluginMenuItemSortTableDescendingly]),"titlebar-button":Gt(e),widget:Gt(t)}))({undoRedoTitleBarButtonPlugins:h,widgetPlugins:nn}),[m,y,v]=await Promise.all([f.create({pluginRegistry:p,settingRegistry:r}),Ut(),C.create(n)]),w=(()=>{const e=document.createElement("div");return document.body.append(e),e})(),b=new Y,S={intlTracker:m,jupyterLab:o,jupyterServerProxyEnabled:y,notebookTracker:t,pluginRegistry:p,popupContainer:w,sessionClients:b,themeTracker:v,widgetStateTrackers:g},k=new St(S);c.add(k,"left",{rank:700}),s&&s.add(k,"atoti-sidebar"),d.addWidgetExtension("Notebook",new Rt(S)),d.addWidgetExtension("Notebook",new zt(S)),(({commandPalette:e,intlTracker:t,jupyterLab:n,notebookTracker:i,sessionClients:s,widgetStateTrackers:r})=>{n.commands.addCommand(jt,{async execute(){const{mdx:e,sessionId:t,widgetCreationCode:o}=Ot(i),a={...u.pluginWidgetPivotTable.initialState,serverKey:l.defaultServerKey},d=await Ne({code:o,notebookTracker:i,state:a}),c=s.get(t);if(!c)throw new Error("The execution of the created cell should have created the corresponding SessionClient.");const g=r.get(d.model);if(!g)throw new Error("The execution of the created cell should have created the corresponding WidgetStateTracker.");const h=await(async e=>e.dataModel?e.dataModel:new Promise((t=>{const n=e.subscribeToDataModel((()=>{const{dataModel:i}=e;i&&(n(),t(i))}))})))(c.activePivotClient),{widgetStateDerivedFromMdx:p}=(0,ut.deriveStateFromMdx)({dataModels:{[l.defaultServerKey]:h},mdx:(0,u.parse)(e),widgetPlugin:u.pluginWidgetPivotTable,widgetState:a});g.setWidgetState(p),at({jupyterLab:n})},isVisible:()=>void 0!==Ot(i),label:()=>(0,Z.createIntl)(t.config).formatMessage({id:`commands.${$t}.caption`})}),n.contextMenu.addItem({command:jt,selector:Bt}),n.contextMenu.addItem({selector:Bt,type:"separator"}),e&&e.addItem({category:"Notebook Cell Operations",command:jt})})({commandPalette:i,intlTracker:m,jupyterLab:o,notebookTracker:t,sessionClients:b,widgetStateTrackers:g})},autoStart:!0,id:"atoti",optional:[s.ICommandPalette,i.ILayoutRestorer,o.ISettingRegistry],requires:[r.INotebookTracker,s.IThemeManager]},ln=an},59273:(e,t,n)=>{var i={"./en-US.js":[80761,761]};function s(e){if(!n.o(i,e))return Promise.resolve().then((()=>{var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=i[e],s=t[0];return n.e(t[1]).then((()=>n(s)))}s.keys=()=>Object.keys(i),s.id=59273,e.exports=s},8640:(e,t,n)=>{"use strict";n.d(t,{C:()=>y,E:()=>I,T:()=>C,_:()=>f,a:()=>S,b:()=>k,c:()=>M,h:()=>p,i:()=>h,u:()=>w,w:()=>v});var i=n(66029),s=n(21759),r=n(77587),o=n(72609),a=n(10063),l=n.n(a),d=function(e,t){return l()(e,t)},c=n(68116),u=n(93232),g=n(78070),h=!0,p={}.hasOwnProperty,m=i.createContext("undefined"!=typeof HTMLElement?(0,s.Z)({key:"css"}):null),y=m.Provider,f=function(){return(0,i.useContext)(m)},v=function(e){return(0,i.forwardRef)((function(t,n){var s=(0,i.useContext)(m);return e(t,s,n)}))};h||(v=function(e){return function(t){var n=(0,i.useContext)(m);return null===n?(n=(0,s.Z)({key:"css"}),i.createElement(m.Provider,{value:n},e(t,n))):e(t,n)}});var C=i.createContext({}),w=function(){return i.useContext(C)},b=(0,o.Z)((function(e){return(0,o.Z)((function(t){return function(e,t){return"function"==typeof t?t(e):(0,r.Z)({},e,t)}(e,t)}))})),S=function(e){var t=i.useContext(C);return e.theme!==t&&(t=b(t)(e.theme)),i.createElement(C.Provider,{value:t},e.children)};function k(e){var t=e.displayName||e.name||"Component",n=function(t,n){var s=i.useContext(C);return i.createElement(e,(0,r.Z)({theme:s,ref:n},t))},s=i.forwardRef(n);return s.displayName="WithTheme("+t+")",d(s,e)}var T="__EMOTION_TYPE_PLEASE_DO_NOT_USE__",M=function(e,t){var n={};for(var i in t)p.call(t,i)&&(n[i]=t[i]);return n[T]=e,n},x=function(e){var t=e.cache,n=e.serialized,i=e.isStringTag;return(0,c.hC)(t,n,i),(0,g.L)((function(){return(0,c.My)(t,n,i)})),null},I=v((function(e,t,n){var s=e.css;"string"==typeof s&&void 0!==t.registered[s]&&(s=t.registered[s]);var r=e[T],o=[s],a="";"string"==typeof e.className?a=(0,c.fp)(t.registered,o,e.className):null!=e.className&&(a=e.className+" ");var l=(0,u.O)(o,void 0,i.useContext(C));a+=t.key+"-"+l.name;var d={};for(var g in e)p.call(e,g)&&"css"!==g&&g!==T&&(d[g]=e[g]);return d.ref=n,d.className=a,i.createElement(i.Fragment,null,i.createElement(x,{cache:t,serialized:l,isStringTag:"string"==typeof r}),i.createElement(r,d))}))},93388:(e,t,n)=>{"use strict";n.d(t,{BX:()=>a,HY:()=>r,tZ:()=>o});var i=n(97458),s=n(8640),r=(n(66029),n(21759),n(10063),n(93232),n(78070),i.Fragment);function o(e,t,n){return s.h.call(t,"css")?i.jsx(s.E,(0,s.c)(e,t),n):i.jsx(e,t,n)}function a(e,t,n){return s.h.call(t,"css")?i.jsxs(s.E,(0,s.c)(e,t),n):i.jsxs(e,t,n)}},78520:(e,t,n)=>{"use strict";var i=n(37704);t.s=i.createRoot,i.hydrateRoot},56053:(e,t,n)=>{"use strict";var i=n(66029),s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function d(e,t,n){var i,r={},d=null,c=null;for(i in void 0!==n&&(d=""+n),void 0!==t.key&&(d=""+t.key),void 0!==t.ref&&(c=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(r[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===r[i]&&(r[i]=t[i]);return{$$typeof:s,type:e,key:d,ref:c,props:r,_owner:a.current}}t.Fragment=r,t.jsx=d,t.jsxs=d},97458:(e,t,n)=>{"use strict";e.exports=n(56053)}}]);